<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Iteration | Reproducible Research Data and Project Management in R</title>
  <meta name="description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Iteration | Reproducible Research Data and Project Management in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://annakrystalli.me/rrresearchACCE20" />
  
  <meta property="og:description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  <meta name="github-repo" content="https://github.com/annakrystalli/rrresearchACCE20" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Iteration | Reproducible Research Data and Project Management in R" />
  
  <meta name="twitter:description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  

<meta name="author" content="Course Instructor: Dr Anna Krystalli" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="process.html"/>
<link rel="next" href="data-merge.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/jsoneditor-5.25.6/jsoneditor.min.css" rel="stylesheet" />
<script src="libs/jsoneditor-5.25.6/jsoneditor.min.js"></script>
<script src="libs/jsonedit-binding-3.0.0/jsonedit.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Reproducible Research Data & Project Management in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course description</a></li>
<li class="chapter" data-level="" data-path="welcome-slides.html"><a href="welcome-slides.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Basics</b></span></li>
<li class="chapter" data-level="" data-path="rstudio-basics.html"><a href="rstudio-basics.html"><i class="fa fa-check"></i>Intro to R &amp; Rstudio</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i>R Basics</a></li>
<li class="chapter" data-level="" data-path="data-types-structures-and-classes.html"><a href="data-types-structures-and-classes.html"><i class="fa fa-check"></i>Data types, structures and classes</a></li>
<li class="chapter" data-level="" data-path="indexing-and-subsetting.html"><a href="indexing-and-subsetting.html"><i class="fa fa-check"></i>Indexing and subsetting</a></li>
<li class="chapter" data-level="" data-path="the-tidyverse-way.html"><a href="the-tidyverse-way.html"><i class="fa fa-check"></i>The tidyverse way</a></li>
<li class="chapter" data-level="" data-path="rdm-intro-view.html"><a href="rdm-intro-view.html"><i class="fa fa-check"></i>Data management Basics</a></li>
<li class="part"><span><b>II Project Management</b></span></li>
<li class="chapter" data-level="" data-path="projects-in-rstudio.html"><a href="projects-in-rstudio.html"><i class="fa fa-check"></i>Projects in Rstudio</a></li>
<li class="chapter" data-level="" data-path="filenaming-view.html"><a href="filenaming-view.html"><i class="fa fa-check"></i>Good File Naming</a></li>
<li class="chapter" data-level="" data-path="path-proj-str.html"><a href="path-proj-str.html"><i class="fa fa-check"></i>Paths and Project structure</a></li>
<li class="part"><span><b>III Data Munging</b></span></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i>Iteration</a></li>
<li class="chapter" data-level="" data-path="data-merge.html"><a href="data-merge.html"><i class="fa fa-check"></i>Merging data</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i>Functions</a></li>
<li class="part"><span><b>IV Working with metadata</b></span></li>
<li class="chapter" data-level="" data-path="metadata-slides.html"><a href="metadata-slides.html"><i class="fa fa-check"></i>Metadata</a></li>
<li><a href="dataspice.html#dataspice">Creating metadata with <code>dataspice</code></a></li>
<li class="part"><span><b>V Analysing and presenting analyses</b></span></li>
<li class="chapter" data-level="" data-path="plotting-with-ggplot2.html"><a href="plotting-with-ggplot2.html"><i class="fa fa-check"></i>Plotting with ggplot2</a></li>
<li class="chapter" data-level="" data-path="literate-programming-in-rmarkdown.html"><a href="literate-programming-in-rmarkdown.html"><i class="fa fa-check"></i>Literate Programming in rmarkdown</a></li>
<li class="part"><span><b>VI Version Control</b></span></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html"><i class="fa fa-check"></i>Version Control with Git</a></li>
<li class="chapter" data-level="" data-path="collaborative-github.html"><a href="collaborative-github.html"><i class="fa fa-check"></i>Collaborative GitHub</a></li>
<li><a href="practical-github-rstudio-for-collaborative-coding.html#practical-github-rstudio-for-collaborative-coding">Practical: <code>GitHub</code> &amp; <code>Rstudio</code> for collaborative coding</a></li>
<li class="part"><span><b>VII Closing</b></span></li>
<li class="chapter" data-level="" data-path="closing-remarks.html"><a href="closing-remarks.html"><i class="fa fa-check"></i>Closing Remarks</a></li>
<li class="part"><span><b>VIII Additonal materials</b></span></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html"><i class="fa fa-check"></i>Packaging functionality</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html"><i class="fa fa-check"></i>Creating a research compendium with rrtools</a></li>
<li class="part"><span><b>IX APPENDIX</b></span></li>
<li><a href="geolocate-r.html#geolocate.r"><code>geolocate.R</code></a></li>
<li><a href="analysis-r-1.html#analysis.r-1"><code>analysis.R</code></a></li>
<li><a href="index-rmd.html#index.rmd"><code>index.Rmd</code></a></li>
<li><a href="gitignore.html#gitignore"><code>.gitignore</code></a></li>
<li><a href="mypackage-hello-r.html#mypackage-hello.r"><code>mypackage</code> <code>hello.R</code></a></li>
<li><a href="mypackage-readme-rmd.html#mypackage-readme.rmd"><code>mypackage</code> <code>README.Rmd</code></a></li>
<li><a href="mypackage-description.html#mypackage-description"><code>mypackage</code> <code>DESCRIPTION</code></a></li>
<li><a href="rrcompendium-description.html#rrcompendium-description"><code>rrcompendium</code> <code>DESCRIPTION</code></a></li>
<li><a href="rrcompendium-readme-rmd.html#rrcompendium-readme.rmd"><code>rrcompendium</code> <code>README.Rmd</code></a></li>
<li><a href="rrcompendium-paper-rmd-yaml-header.html#rrcompendium-paper.rmd-yaml-header"><code>rrcompendium</code> <code>paper.Rmd</code> YAML header</a></li>
<li><a href="rrcompendium-paper-rmd.html#rrcompendium-paper.rmd"><code>rrcompendium</code> <code>paper.Rmd</code></a></li>
<li class="chapter" data-level="" data-path="about.html"><a href="about.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i>Software Setup</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i>Solutions</a></li>
<li class="divider"></li>
<li><a href="https://annakrystalli.me/rrreasearchACCE2020" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Research Data and Project Management in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="iteration" class="section level1">
<h1>Iteration</h1>
<p>Let’s say we want to repeat a process multiple times, iterating over a number of inputs. In this case we want to load every file in <code>/data-raw/wood-survey-data-master/individual/</code>.</p>
<p>We have a few options for how to approach this problem. In R there are two paradigms for iteration:</p>
<ul>
<li><strong>imperative iterations</strong>: (for and while loops)
<ul>
<li>great place to start because they make iteration very explicit.</li>
<li>quite verbose, and require quite a bit of bookkeeping code that is duplicated for every <code>for</code> loop.</li>
</ul></li>
<li><strong>functional programming</strong>: using functions to iterate over other functions.
<ul>
<li>focus is on the operation being performed rather than the bookkeeping.</li>
<li>can be more elegant and succinct.</li>
</ul></li>
</ul>
<div id="iterating-using-loops" class="section level2">
<h2>Iterating using loops</h2>
<div id="simple-loop" class="section level3">
<h3>Simple loop</h3>
<p>Here’s an example of a simple loop. During each iteration, it prints a message to the console, reporting the value of <code>i</code>.</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="iteration.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>){</span>
<span id="cb276-2"><a href="iteration.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">&quot;i is &quot;</span>, i))</span>
<span id="cb276-3"><a href="iteration.html#cb276-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;i is 1&quot;
## [1] &quot;i is 2&quot;
## [1] &quot;i is 3&quot;
## [1] &quot;i is 4&quot;
## [1] &quot;i is 5&quot;
## [1] &quot;i is 6&quot;
## [1] &quot;i is 7&quot;
## [1] &quot;i is 8&quot;
## [1] &quot;i is 9&quot;
## [1] &quot;i is 10&quot;</code></pre>
<p>The loop iterates over the vector of values supplied in <code>1:10</code>, sequentially assigning a new value to variable <code>i</code> each iteration. <code>i</code> is therefore the varying input and everything else in the code stays the same during each iteration.</p>
</div>
<div id="loops-in-practice" class="section level3">
<h3>Loops in practice</h3>
</div>
<div id="reading-in-multiple-files" class="section level3">
<h3>Reading in multiple files</h3>
<p>Let’s now apply a loop to read in all 67 files at once.</p>
<p>We have the file paths in our <code>individual_paths</code> vector. This is the input we want to iterate over. We can use a <strong><code>for</code> loop</strong> to supply each path as the <code>file</code> argument in <code>readr::read_csv()</code>.</p>
<div id="storing-loop-outputs" class="section level4">
<h4>Storing loop outputs</h4>
<p>The previous loop we saw didn’t generate any new objects, it just printed output to the console. We, however, need to store the output of each iteration (the tibble we’ve just read in).</p>
<p>It’s important for efficiency to allocate sufficient space for the output before starting a <code>for</code> loop. Growing the <code>for</code> loop at each iteration, using <code>c()</code> for example, will be very slow.</p>
<p>Let’s create an output vector to store the tibbles containing the read in data. We want it to be a list because we’ll be storing heterogeneous objects (tibbles) in each element.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="iteration.html#cb278-1" aria-hidden="true" tabindex="-1"></a>indiv_df_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="fu">length</span>(individual_paths))</span>
<span id="cb278-2"><a href="iteration.html#cb278-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb278-3"><a href="iteration.html#cb278-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(indiv_df_list)</span></code></pre></div>
<pre><code>## [[1]]
## NULL
## 
## [[2]]
## NULL
## 
## [[3]]
## NULL
## 
## [[4]]
## NULL
## 
## [[5]]
## NULL
## 
## [[6]]
## NULL</code></pre>
<p>We’ve used the <code>length()</code> of the input to specify the size of our output list so each path gets an output element.</p>
</div>
<div id="looping-over-indices" class="section level4">
<h4>Looping over indices</h4>
<p>Next, we need a sequence of indices as long as the input vector (<code>individual_paths</code>). We can use <code>seq_along()</code> to create our index vector:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="iteration.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="fu">seq_along</span>(individual_paths)</span></code></pre></div>
<pre><code>##  [1]  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25
## [26] 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50
## [51] 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67</code></pre>
<p>Now we’re ready to write our <code>for</code> loop.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="iteration.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq_along</span>(individual_paths)){</span>
<span id="cb282-2"><a href="iteration.html#cb282-2" aria-hidden="true" tabindex="-1"></a>  indiv_df_list[[i]] <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(individual_paths[[i]])</span>
<span id="cb282-3"><a href="iteration.html#cb282-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>At each step of the iteration, the file specified in the <code>i</code>th element of <code>individual_paths</code> is read in and assigned to th <code>i</code>th element of our output list.</p>
<p>We can extract individual tibbles using <code>[[</code> sub-setting to inspect:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="iteration.html#cb283-1" aria-hidden="true" tabindex="-1"></a>indiv_df_list[[<span class="dv">1</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 376 x 12
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7a… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951a… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348e… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 2a4478… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 e48520… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 280c90… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 0e5060… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 4918ca… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16cb… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 366 more rows, and 4 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="iteration.html#cb285-1" aria-hidden="true" tabindex="-1"></a>indiv_df_list[[<span class="dv">2</span>]]</span></code></pre></div>
<pre><code>## # A tibble: 714 x 12
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 fb75a8… BART_036.base… 2015-09-01 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 30a7c7… BART_046.base… 2015-09-01 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 789d03… BART_072.base… 2015-09-01 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 0e4fb3… BART_072.base… 2015-09-01 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 cb0e45… BART_036.base… 2015-09-01 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 5fc5cf… BART_072.base… 2015-09-01 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 5d15fa… BART_046.base… 2015-09-01 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 d27a1b… BART_036.base… 2015-09-01 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 d5f9ab… BART_036.base… 2015-09-01 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 e52c3b… BART_036.base… 2015-09-01 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 704 more rows, and 4 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;</code></pre>
<p>We can also inspect the contents of our output list interactively using <code>View()</code></p>
<p><img src="assets/view_indiv_list.png" /><!-- --></p>
<div id="looping-over-objects" class="section level5">
<h5>Looping over objects</h5>
<p>We can also loop over objects instead of indices.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="iteration.html#cb287-1" aria-hidden="true" tabindex="-1"></a>indiv_df_list <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">&quot;list&quot;</span>, <span class="fu">length</span>(individual_paths))</span>
<span id="cb287-2"><a href="iteration.html#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(indiv_df_list) <span class="ot">&lt;-</span> <span class="fu">basename</span>(individual_paths)</span>
<span id="cb287-3"><a href="iteration.html#cb287-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-4"><a href="iteration.html#cb287-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(path <span class="cf">in</span> individual_paths){</span>
<span id="cb287-5"><a href="iteration.html#cb287-5" aria-hidden="true" tabindex="-1"></a>  indiv_df_list[[<span class="fu">basename</span>(path)]] <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(path)</span>
<span id="cb287-6"><a href="iteration.html#cb287-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In this case, we supply the paths themselves as the input to our loop and these are passed as-is to <code>read_csv()</code>.</p>
<p>This time we don’t have our element indices to index the elements of the output list each tibble should be stored in. To get around this we assign names to each element and index the output list by name.</p>
<p>I’ve chosen to use the <code>basename</code> (actual file name) of each path as a name, which I can get through <code>basename()</code>.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="iteration.html#cb288-1" aria-hidden="true" tabindex="-1"></a>individual_paths[<span class="dv">1</span>]</span>
<span id="cb288-2"><a href="iteration.html#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">basename</span>(individual_paths[<span class="dv">1</span>])</span></code></pre></div>
<pre><code>## /cloud/project/data-raw/wood-survey-data-master/individual/NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2015-08.basic.20190806T172340Z.csv</code></pre>
<pre><code>## [1] &quot;NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2015-08.basic.20190806T172340Z.csv&quot;</code></pre>
</div>
</div>
<div id="collapsing-our-output-list-into-a-single-tibble." class="section level4">
<h4>Collapsing our output list into a single tibble.</h4>
<p>Now we’ve got our list of tibbles, we want to collapse or “reduce” our output list into a single tibble. There are a number of ways to do this in R.</p>
<div id="base-r" class="section level5">
<h5>Base R</h5>
<p>One first approach we might think of is to use base function <code>rbind()</code>. This takes any number of tibbles as arguments and binds them all together.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="iteration.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rbind</span>(indiv_df_list) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##               NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2015-08.basic.20190806T172340Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2015-09.basic.20190806T144119Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2016-08.basic.20190806T143255Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2016-09.basic.20190806T143433Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2016-10.basic.20190806T144133Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2017-07.basic.20190806T144111Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2017-08.basic.20190806T143426Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2017-09.basic.20190806T143740Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2018-08.basic.20190806T143026Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.BART.DP1.10098.001.vst_apparentindividual.2018-09.basic.20190806T144743Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2015-08.basic.20190806T155155Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2015-09.basic.20190806T155228Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2015-10.basic.20190806T160029Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2015-11.basic.20190806T155340Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2016-07.basic.20190806T154424Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2016-08.basic.20190806T155619Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2016-09.basic.20190806T155751Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2016-10.basic.20190806T154902Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2017-07.basic.20190806T161731Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2017-08.basic.20190806T155239Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2017-09.basic.20190806T154054Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2017-10.basic.20190806T154917Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2018-09.basic.20190806T154756Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D01.HARV.DP1.10098.001.vst_apparentindividual.2018-10.basic.20190904T080421Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D02.BLAN.DP1.10098.001.vst_apparentindividual.2015-09.basic.20190806T180623Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D02.BLAN.DP1.10098.001.vst_apparentindividual.2015-10.basic.20190806T180501Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D02.BLAN.DP1.10098.001.vst_apparentindividual.2016-09.basic.20190806T180452Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D02.BLAN.DP1.10098.001.vst_apparentindividual.2016-11.basic.20190806T162810Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D02.BLAN.DP1.10098.001.vst_apparentindividual.2017-09.basic.20190806T180226Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D02.BLAN.DP1.10098.001.vst_apparentindividual.2017-10.basic.20190806T162804Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D02.BLAN.DP1.10098.001.vst_apparentindividual.2018-09.basic.20190806T162758Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D02.BLAN.DP1.10098.001.vst_apparentindividual.2018-11.basic.20190930T153245Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D03.DSNY.DP1.10098.001.vst_apparentindividual.2018-01.basic.20190806T170456Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D03.DSNY.DP1.10098.001.vst_apparentindividual.2018-05.basic.20190806T165614Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2015-08.basic.20190806T155333Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2016-02.basic.20190806T151351Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2016-03.basic.20190806T151416Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2016-04.basic.20190806T151437Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2016-05.basic.20190806T154733Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2016-06.basic.20190806T155301Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2016-07.basic.20190806T155324Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2016-08.basic.20190806T153300Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2016-09.basic.20190806T151857Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2016-10.basic.20190806T154351Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2016-11.basic.20190806T152215Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2017-03.basic.20190806T152514Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2017-04.basic.20190806T154915Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2017-12.basic.20190806T164409Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2018-01.basic.20190806T150606Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D04.GUAN.DP1.10098.001.vst_apparentindividual.2018-02.basic.20190806T150635Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D07.GRSM.DP1.10098.001.vst_apparentindividual.2015-05.basic.20190806T151458Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D07.GRSM.DP1.10098.001.vst_apparentindividual.2015-06.basic.20190806T151516Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D07.GRSM.DP1.10098.001.vst_apparentindividual.2016-10.basic.20190806T154811Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D07.GRSM.DP1.10098.001.vst_apparentindividual.2016-11.basic.20190806T154932Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D07.GRSM.DP1.10098.001.vst_apparentindividual.2017-10.basic.20190806T155315Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D07.GRSM.DP1.10098.001.vst_apparentindividual.2017-11.basic.20190806T164155Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D07.GRSM.DP1.10098.001.vst_apparentindividual.2018-11.basic.20190930T154643Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D08.DELA.DP1.10098.001.vst_apparentindividual.2015-06.basic.20190806T173627Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D08.DELA.DP1.10098.001.vst_apparentindividual.2015-07.basic.20190806T165116Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D08.DELA.DP1.10098.001.vst_apparentindividual.2015-09.basic.20190806T160924Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D08.DELA.DP1.10098.001.vst_apparentindividual.2016-09.basic.20190806T161107Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D08.DELA.DP1.10098.001.vst_apparentindividual.2016-10.basic.20190806T155600Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D08.DELA.DP1.10098.001.vst_apparentindividual.2017-10.basic.20190806T161504Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D08.DELA.DP1.10098.001.vst_apparentindividual.2017-11.basic.20190806T165044Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D08.DELA.DP1.10098.001.vst_apparentindividual.2018-10.basic.20190904T074322Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D08.DELA.DP1.10098.001.vst_apparentindividual.2018-11.basic.20190930T162311Z.csv
## indiv_df_list List,12                                                                              
##               NEON.D09.DCFS.DP1.10098.001.vst_apparentindividual.2015-09.basic.20190806T161704Z.csv
## indiv_df_list List,12</code></pre>
<p>Hmm, that doesn’t seem to have done what we want. That’s because <code>rbind</code> expects multiple tibbles as inputs and we’re giving it a single list. We somehow want to extract the contents of each element of <code>indiv_df_list</code> and pass them all to <code>rbind</code>.</p>
<p>For this we can use <code>do.call</code>.<code>do.call</code> takes a function or the name of a function we want to execute as it’s first argument, <code>what</code>. The second argument of <code>do.call</code>, <code>args</code> is a <strong>list</strong> of arguments we want to pass to the function specified in <code>what</code>. When <code>do.call</code> is executed, it extracts the elements of <code>args</code> and passes them as arguments to <code>what</code>.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="iteration.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">do.call</span>(<span class="at">what =</span> <span class="st">&quot;rbind&quot;</span>, <span class="at">args =</span> indiv_df_list)</span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 12
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##  * &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7a… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951a… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348e… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 2a4478… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 e48520… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 280c90… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 0e5060… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 4918ca… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16cb… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 14,951 more rows, and 4 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;</code></pre>
<p>Success!</p>
</div>
<div id="tidyverse" class="section level5">
<h5>Tidyverse</h5>
<p>There are also ways to do this using the tidyverse.</p>
<p><strong><code>purrr::reduce</code></strong></p>
<p><code>reduce</code> from package <code>purrr</code> combines the elements of a vector or list into a single object according to the function supplied to <code>.f</code>.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="iteration.html#cb295-1" aria-hidden="true" tabindex="-1"></a>purrr<span class="sc">::</span><span class="fu">reduce</span>(indiv_df_list, <span class="at">.f =</span> rbind)</span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 12
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7a… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951a… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348e… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 2a4478… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 e48520… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 280c90… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 0e5060… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 4918ca… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16cb… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 14,951 more rows, and 4 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;</code></pre>
<p><strong><code>dplyr::bind_rows</code></strong></p>
<p><code>bind_rows</code> offers a shortcut to reducing a list of tibbles.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="iteration.html#cb297-1" aria-hidden="true" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(indiv_df_list)</span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 12
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7a… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951a… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348e… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 2a4478… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 e48520… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 280c90… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 0e5060… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 4918ca… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16cb… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 14,951 more rows, and 4 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;</code></pre>
</div>
</div>
</div>
</div>
<div id="functional-programming" class="section level2">
<h2>Functional programming</h2>
<p>Loops are an important basic concept in programming. However another approach available in R is functional programming which vectorises a function or pipe of functions over given input(s). We’ve actually just been using functional programming with <code>do.call</code> and <code>reduce</code>.</p>
<p>This idea of passing a function to another function is one of the behaviours that makes R a functional programming language and is extremely powerful.</p>
<p>It allows us to:</p>
<ol style="list-style-type: decimal">
<li>use functions rather than <code>for</code> loops to perform iteration over other functions.</li>
<li>wrap the code we want to iterate over in custom functions.</li>
</ol>
<p>This iin turn allows us to replace many <code>for</code> loops with code that is both more succinct and easier to read.</p>
<p>In base R there is a family of apply functions (<code>lapply</code>, <code>vapply</code>, <code>sapply</code>, <code>apply</code>, <code>mapply</code>). These are handy to know if want to write workflows or software that are low on dependencies. However, I prefer using the functions in tidyverse package <code>purrr</code>.</p>
<div id="iterating-using-purrr" class="section level3">
<h3>Iterating using <code>purrr</code></h3>
<p>In the tidyverse such functionality is provided by package <a href="https://purrr.tidyverse.org/"><code>purrr</code></a>, which provides a complete and consistent set of tools for working with functions and vectors of inputs.</p>
<iframe src="assets/cheatsheets/purrr.pdf" width="672" height="400px">
</iframe>
<p>The first thing we might try is to replace our <code>for</code> loop with a function.</p>
<div id="map" class="section level4">
<h4><code>map</code></h4>
<p>The basic <code>purrr</code> function is <code>map()</code> and it allows us to pass the elements of an input vector or list to a single argument of a function we want to repeat. It also has a handy shortcut for specifying the argument to pass the input object to.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="iteration.html#cb299-1" aria-hidden="true" tabindex="-1"></a>indiv_df_list <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map</span>(individual_paths,</span>
<span id="cb299-2"><a href="iteration.html#cb299-2" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span>readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> .x))</span></code></pre></div>
<p>The first argument to <code>map</code> is the input vector of paths we want to iterate over. The next argument is a formula specifying the function we want to repeat as well as which argument the input is passed to.</p>
<p>Here we’re saying that we want to repeatedly run <code>read_csv</code> and we indicate the argument we want the input passed to (<code>file</code>) by <code>.x</code>. Note as well the <code>~</code> notation before the function definition which is shorthand for <code>.f =</code>.</p>
</div>
<div id="map_df" class="section level4">
<h4><code>map_df</code></h4>
<p>Just like our loop, <code>map</code> returns an output list.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="iteration.html#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(indiv_df_list)</span></code></pre></div>
<pre><code>## [1] &quot;list&quot;</code></pre>
<p>We would therefore need to combine them together in another step.</p>
<p>However, one of the great things about <code>purrr</code> functions is that you can specify what you expect the output of the mapped function to be. THere are functions that take advantage of that knowledge and bind or format the outputs appropriately.</p>
<p>Because we know the output of <code>read_csv()</code> is a tibble, we can use <code>map_df()</code> instead of <code>map()</code>.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="iteration.html#cb302-1" aria-hidden="true" tabindex="-1"></a>individual <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(individual_paths,</span>
<span id="cb302-2"><a href="iteration.html#cb302-2" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span>readr<span class="sc">::</span><span class="fu">read_csv</span>(.x))</span>
<span id="cb302-3"><a href="iteration.html#cb302-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb302-4"><a href="iteration.html#cb302-4" aria-hidden="true" tabindex="-1"></a>individual</span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 12
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7a… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951a… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348e… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 2a4478… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 e48520… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 280c90… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 0e5060… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 4918ca… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16cb… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 14,951 more rows, and 4 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;</code></pre>
<p>Success! We now have all our data in a single tibble is just two concise lines of code!! 🎉 👏</p>
</div>
<div id="some-tips-on-efficiency" class="section level4">
<h4>Some tips on efficiency</h4>
<p>While the above code is elegant, it might not be the most efficient. <code>read_csv</code> calls <code>readr</code> function <code>type_convert()</code> to determine the data type for each column when it reads a file in, which is relatively expensive.</p>
<p>The elegant code above mean that <code>type_convert()</code> is for every file that is loaded, ie 67 times.</p>
<p>A more efficent way of implementing this to set all columns as character on-read and then run <code>type_convert</code> ourselves, only once, and only after our data have been combined into a single tibble.</p>
<p>We can set all columns to character by default by providing column formating function <code>readr::cols(.default = "c"))</code> as the <code>read_csv</code> <code>col_types</code> argument.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="iteration.html#cb304-1" aria-hidden="true" tabindex="-1"></a>individual <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(individual_paths,</span>
<span id="cb304-2"><a href="iteration.html#cb304-2" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span>readr<span class="sc">::</span><span class="fu">read_csv</span>(.x, <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">&quot;c&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb304-3"><a href="iteration.html#cb304-3" aria-hidden="true" tabindex="-1"></a>            readr<span class="sc">::</span><span class="fu">type_convert</span>()</span>
<span id="cb304-4"><a href="iteration.html#cb304-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb304-5"><a href="iteration.html#cb304-5" aria-hidden="true" tabindex="-1"></a>individual  </span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 12
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7a… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951a… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348e… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 2a4478… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 e48520… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 280c90… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 0e5060… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 4918ca… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16cb… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 14,951 more rows, and 4 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;</code></pre>
<p>This might come in handy if you are dealing with a huge number of data files.</p>
<p>Other packages to be aware of, especially if you are dealing with very large tables, are <code>data.table</code> and <code>vroom</code>.</p>
<iframe src="assets/cheatsheets/datatable.pdf" width="672" height="400px">
</iframe>
<p>Learn more about <a href="http://adv-r.had.co.nz/Performance.html">perfomance and efficency</a> in general.</p>
<div id="simple-benchmark" class="section level5">
<h5>simple benchmark</h5>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="iteration.html#cb306-1" aria-hidden="true" tabindex="-1"></a>microbenchmark<span class="sc">::</span><span class="fu">microbenchmark</span>({</span>
<span id="cb306-2"><a href="iteration.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tidyverse</span></span>
<span id="cb306-3"><a href="iteration.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_df</span>(individual_paths,</span>
<span id="cb306-4"><a href="iteration.html#cb306-4" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span>readr<span class="sc">::</span><span class="fu">read_csv</span>(.x))},</span>
<span id="cb306-5"><a href="iteration.html#cb306-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># tidyverse + read in as character</span></span>
<span id="cb306-6"><a href="iteration.html#cb306-6" aria-hidden="true" tabindex="-1"></a>  {purrr<span class="sc">::</span><span class="fu">map_df</span>(individual_paths,</span>
<span id="cb306-7"><a href="iteration.html#cb306-7" aria-hidden="true" tabindex="-1"></a>           <span class="sc">~</span>readr<span class="sc">::</span><span class="fu">read_csv</span>(.x, <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">&quot;c&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb306-8"><a href="iteration.html#cb306-8" aria-hidden="true" tabindex="-1"></a>            readr<span class="sc">::</span><span class="fu">type_convert</span>()},</span>
<span id="cb306-9"><a href="iteration.html#cb306-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># vroom package</span></span>
<span id="cb306-10"><a href="iteration.html#cb306-10" aria-hidden="true" tabindex="-1"></a>  {vroom<span class="sc">::</span><span class="fu">vroom</span>(individual_paths)},</span>
<span id="cb306-11"><a href="iteration.html#cb306-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># data.table</span></span>
<span id="cb306-12"><a href="iteration.html#cb306-12" aria-hidden="true" tabindex="-1"></a>  {<span class="fu">lapply</span>(individual_paths, data.table<span class="sc">::</span>fread, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb306-13"><a href="iteration.html#cb306-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, .)},</span>
<span id="cb306-14"><a href="iteration.html#cb306-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># purrr + data.table</span></span>
<span id="cb306-15"><a href="iteration.html#cb306-15" aria-hidden="true" tabindex="-1"></a>  {purrr<span class="sc">::</span><span class="fu">map_df</span>(individual_paths, data.table<span class="sc">::</span>fread, <span class="at">sep=</span><span class="st">&quot;,&quot;</span>)},</span>
<span id="cb306-16"><a href="iteration.html#cb306-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="dv">20</span>)</span></code></pre></div>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="iteration.html#cb307-1" aria-hidden="true" tabindex="-1"></a>       min        lq      mean    median        uq       max neval</span>
<span id="cb307-2"><a href="iteration.html#cb307-2" aria-hidden="true" tabindex="-1"></a> <span class="fl">372.77828</span> <span class="fl">389.98348</span> <span class="fl">416.70189</span> <span class="fl">395.01877</span> <span class="fl">437.90033</span> <span class="fl">512.19128</span>    <span class="dv">20</span></span>
<span id="cb307-3"><a href="iteration.html#cb307-3" aria-hidden="true" tabindex="-1"></a> <span class="fl">150.52621</span> <span class="fl">164.60759</span> <span class="fl">190.92799</span> <span class="fl">175.99858</span> <span class="fl">192.44910</span> <span class="fl">322.73216</span>    <span class="dv">20</span></span>
<span id="cb307-4"><a href="iteration.html#cb307-4" aria-hidden="true" tabindex="-1"></a> <span class="fl">265.06628</span> <span class="fl">272.09506</span> <span class="fl">307.39295</span> <span class="fl">285.53955</span> <span class="fl">320.84952</span> <span class="fl">518.55182</span>    <span class="dv">20</span></span>
<span id="cb307-5"><a href="iteration.html#cb307-5" aria-hidden="true" tabindex="-1"></a>  <span class="fl">50.09148</span>  <span class="fl">53.22408</span>  <span class="fl">72.28593</span>  <span class="fl">58.26753</span>  <span class="fl">63.00565</span> <span class="fl">182.50278</span>    <span class="dv">20</span></span>
<span id="cb307-6"><a href="iteration.html#cb307-6" aria-hidden="true" tabindex="-1"></a>  <span class="fl">57.48761</span>  <span class="fl">58.76176</span>  <span class="fl">63.39054</span>  <span class="fl">63.31130</span>  <span class="fl">66.08371</span>  <span class="fl">75.92438</span>    <span class="dv">20</span></span></code></pre></div>
</div>
</div>
</div>
</div>
<div id="writing-out-our-tibble-to-disk" class="section level2">
<h2>Writing out our tibble to disk</h2>
<p>Remember the other two files included in our raw data, <code>vst_mappingandtagging.csv</code>, and <code>vst_perplotperyear.csv</code>? Well the truth is they also came in multiple files which I put together in pretty much the same way as you just did!</p>
<p>So for posterity, let’s save this file out too. This isn’t our finished analytic data set, we still have some processing to do. So let’s just save it at <code>raw_data_path</code>, along with the other files.</p>
<p>To write out a csv file we use <code>readr::write_csv()</code></p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="iteration.html#cb308-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb308-2"><a href="iteration.html#cb308-2" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">write_csv</span>(<span class="fu">file.path</span>(raw_data_path, <span class="st">&quot;vst_individual.csv&quot;</span>))</span></code></pre></div>
<hr />
<p>Learn more about iteration and the family of <code>purrr</code> functions in the <a href="https://r4ds.had.co.nz/iteration.html">iteration chapter</a> in R for data science</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="process.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-merge.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["rrresearchACCE20.pdf", "rrresearchACCE20.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
