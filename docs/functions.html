<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Functions | Reproducible Research Data &amp; Project Management in R</title>
  <meta name="description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="Functions | Reproducible Research Data &amp; Project Management in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://annakrystalli.me/rrresearchACCE20" />
  
  <meta property="og:description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  <meta name="github-repo" content="annakrystalli/rrresearchACCE20" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Functions | Reproducible Research Data &amp; Project Management in R" />
  
  <meta name="twitter:description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  

<meta name="author" content="Course Instructor: Anna Krystalli" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="combining-tables.html"/>
<link rel="next" href="metadata.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/jsoneditor-5.25.6/jsoneditor.min.css" rel="stylesheet" />
<script src="libs/jsoneditor-5.25.6/jsoneditor.min.js"></script>
<script src="libs/jsonedit-binding-3.0.0/jsonedit.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.12/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Reproducible Research Data & Project Management in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course description</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#learning-outcomes"><i class="fa fa-check"></i>Learning Outcomes</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#course-outline"><i class="fa fa-check"></i>Course Outline</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#optional"><i class="fa fa-check"></i>Optional</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="welcome-1.html"><a href="welcome-1.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Basics</b></span></li>
<li class="chapter" data-level="" data-path="rstudio-basics.html"><a href="rstudio-basics.html"><i class="fa fa-check"></i>Intro to R &amp; Rstudio</a><ul>
<li class="chapter" data-level="" data-path="rstudio-basics.html"><a href="rstudio-basics.html#r"><i class="fa fa-check"></i>R</a></li>
<li class="chapter" data-level="" data-path="rstudio-basics.html"><a href="rstudio-basics.html#rstudio"><i class="fa fa-check"></i>Rstudio</a></li>
<li class="chapter" data-level="" data-path="rstudio-basics.html"><a href="rstudio-basics.html#working-with-r-in-rstudio-cloud"><i class="fa fa-check"></i>Working with R in Rstudio cloud</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i>R Basics</a><ul>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html#using-r-in-the-console"><i class="fa fa-check"></i>Using R in the console</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html#working-in-scripts"><i class="fa fa-check"></i>Working in scripts</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html#using-r-as-a-calculator"><i class="fa fa-check"></i>Using R as a calculator</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html#mathematical-functions"><i class="fa fa-check"></i>Mathematical functions</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html#variables-and-assignment"><i class="fa fa-check"></i>Variables and assignment</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html#comparing-things"><i class="fa fa-check"></i>Comparing things</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-types-structures-and-classes.html"><a href="data-types-structures-and-classes.html"><i class="fa fa-check"></i>Data types, structures and classes</a><ul>
<li class="chapter" data-level="" data-path="data-types-structures-and-classes.html"><a href="data-types-structures-and-classes.html#base-types"><i class="fa fa-check"></i>Base types</a></li>
<li class="chapter" data-level="" data-path="data-types-structures-and-classes.html"><a href="data-types-structures-and-classes.html#base-data-types"><i class="fa fa-check"></i>Base data types</a></li>
<li class="chapter" data-level="" data-path="data-types-structures-and-classes.html"><a href="data-types-structures-and-classes.html#data-structures"><i class="fa fa-check"></i>Data Structures</a></li>
<li class="chapter" data-level="" data-path="data-types-structures-and-classes.html"><a href="data-types-structures-and-classes.html#lists"><i class="fa fa-check"></i>Lists</a></li>
<li class="chapter" data-level="" data-path="data-types-structures-and-classes.html"><a href="data-types-structures-and-classes.html#data.frames"><i class="fa fa-check"></i>Data.frames</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="indexing-and-subsetting.html"><a href="indexing-and-subsetting.html"><i class="fa fa-check"></i>Indexing and subsetting</a><ul>
<li class="chapter" data-level="" data-path="indexing-and-subsetting.html"><a href="indexing-and-subsetting.html#subsetting-vectors"><i class="fa fa-check"></i>Subsetting vectors</a></li>
<li class="chapter" data-level="" data-path="indexing-and-subsetting.html"><a href="indexing-and-subsetting.html#matrix-subsetting"><i class="fa fa-check"></i>Matrix subsetting</a></li>
<li class="chapter" data-level="" data-path="indexing-and-subsetting.html"><a href="indexing-and-subsetting.html#subsetting-lists"><i class="fa fa-check"></i>Subsetting lists</a></li>
<li class="chapter" data-level="" data-path="indexing-and-subsetting.html"><a href="indexing-and-subsetting.html#subsetting-data.frames"><i class="fa fa-check"></i>Subsetting data.frames</a></li>
<li class="chapter" data-level="" data-path="indexing-and-subsetting.html"><a href="indexing-and-subsetting.html#advanced-r-cheat-sheet"><i class="fa fa-check"></i>Advanced R Cheat Sheet</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="the-tidyverse-way.html"><a href="the-tidyverse-way.html"><i class="fa fa-check"></i>The tidyverse way</a><ul>
<li class="chapter" data-level="" data-path="the-tidyverse-way.html"><a href="the-tidyverse-way.html#intro-to-the-tidyverse"><i class="fa fa-check"></i>Intro to the tidyverse</a></li>
<li><a href="the-tidyverse-way.html#tibbles"><code>tibbles</code></a></li>
<li class="chapter" data-level="" data-path="the-tidyverse-way.html"><a href="the-tidyverse-way.html#subsetting-tibbles"><i class="fa fa-check"></i>Subsetting tibbles</a></li>
<li><a href="the-tidyverse-way.html#the-pipe-operator">The pipe operator <code>%&gt;%</code></a></li>
<li class="chapter" data-level="" data-path="the-tidyverse-way.html"><a href="the-tidyverse-way.html#advanced-r-cheat-sheet-1"><i class="fa fa-check"></i>Advanced R Cheat Sheet</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="data-management-basics.html"><a href="data-management-basics.html"><i class="fa fa-check"></i>Data management Basics</a></li>
<li class="part"><span><b>II Project Management</b></span></li>
<li class="chapter" data-level="" data-path="projects-in-rstudio.html"><a href="projects-in-rstudio.html"><i class="fa fa-check"></i>Projects in Rstudio</a><ul>
<li class="chapter" data-level="" data-path="projects-in-rstudio.html"><a href="projects-in-rstudio.html#general-project-organisation"><i class="fa fa-check"></i>General Project Organisation</a></li>
<li class="chapter" data-level="" data-path="projects-in-rstudio.html"><a href="projects-in-rstudio.html#rstudio-projects"><i class="fa fa-check"></i>Rstudio Projects</a></li>
<li class="chapter" data-level="" data-path="projects-in-rstudio.html"><a href="projects-in-rstudio.html#rstudio-cloud-projects"><i class="fa fa-check"></i>Rstudio Cloud projects</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="good-file-naming.html"><a href="good-file-naming.html"><i class="fa fa-check"></i>Good File Naming</a></li>
<li class="chapter" data-level="" data-path="paths-and-project-structure.html"><a href="paths-and-project-structure.html"><i class="fa fa-check"></i>Paths and Project structure</a><ul>
<li class="chapter" data-level="" data-path="paths-and-project-structure.html"><a href="paths-and-project-structure.html#project-data"><i class="fa fa-check"></i>Project Data</a></li>
<li><a href="paths-and-project-structure.html#setting-up-a-data-raw-directory">Setting up a <code>data-raw/</code> directory</a></li>
<li class="chapter" data-level="" data-path="paths-and-project-structure.html"><a href="paths-and-project-structure.html#neon-data"><i class="fa fa-check"></i>NEON Data</a></li>
<li class="chapter" data-level="" data-path="paths-and-project-structure.html"><a href="paths-and-project-structure.html#paths"><i class="fa fa-check"></i>Paths</a></li>
<li class="chapter" data-level="" data-path="paths-and-project-structure.html"><a href="paths-and-project-structure.html#basic-checks"><i class="fa fa-check"></i>Basic checks</a></li>
</ul></li>
<li class="part"><span><b>III Data Munging</b></span></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i>Iteration</a><ul>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#iterating-using-loops"><i class="fa fa-check"></i>Iterating using loops</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#functional-programming"><i class="fa fa-check"></i>Functional programming</a></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html#writing-out-our-tibble-to-disk"><i class="fa fa-check"></i>Writing out our tibble to disk</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="combining-tables.html"><a href="combining-tables.html"><i class="fa fa-check"></i>Combining tables</a><ul>
<li class="chapter" data-level="" data-path="combining-tables.html"><a href="combining-tables.html#join-basics"><i class="fa fa-check"></i>Join Basics</a></li>
<li><a href="combining-tables.html#joining-our-tables-with-dplyr">Joining our tables with <code>dplyr</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i>Functions</a><ul>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#elements-of-a-function"><i class="fa fa-check"></i>Elements of a function</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#creating-our-user-built-functions"><i class="fa fa-check"></i>Creating our user-built functions</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#experimenting"><i class="fa fa-check"></i>Experimenting</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#developing-our-function"><i class="fa fa-check"></i>Developing our function</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#saving-analytical-data"><i class="fa fa-check"></i>Saving analytical data</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#final-processing-script"><i class="fa fa-check"></i>Final processing script:</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html#final-function"><i class="fa fa-check"></i>Final function</a></li>
</ul></li>
<li class="part"><span><b>IV Working with metadata</b></span></li>
<li class="chapter" data-level="" data-path="metadata-slides.html"><a href="metadata-slides.html"><i class="fa fa-check"></i>Metadata</a></li>
<li><a href="dataspice.html#dataspice">Creating metadata with <code>dataspice</code></a><ul>
<li><a href="dataspice.html#dataspice-workflow"><code>dataspice</code> workflow</a></li>
<li class="chapter" data-level="" data-path="dataspice.html"><a href="dataspice.html"><i class="fa fa-check"></i>Create the metadata folder</a></li>
<li class="chapter" data-level="" data-path="dataspice.html"><a href="dataspice.html#record-metadata"><i class="fa fa-check"></i>Record metadata</a></li>
<li class="chapter" data-level="" data-path="dataspice.html"><a href="dataspice.html#create-metadata-json-ld-file"><i class="fa fa-check"></i>Create metadata json-ld file</a></li>
<li class="chapter" data-level="" data-path="dataspice.html"><a href="dataspice.html#build-readme-site"><i class="fa fa-check"></i>Build README site</a></li>
</ul></li>
<li class="part"><span><b>V Analysing and presenting analyses</b></span></li>
<li class="chapter" data-level="" data-path="plotting-with-ggplot2.html"><a href="plotting-with-ggplot2.html"><i class="fa fa-check"></i>Plotting with ggplot2</a><ul>
<li class="chapter" data-level="" data-path="plotting-with-ggplot2.html"><a href="plotting-with-ggplot2.html#data-visualisation-and-analysis-basics"><i class="fa fa-check"></i>Data visualisation and analysis basics</a></li>
<li class="chapter" data-level="" data-path="plotting-with-ggplot2.html"><a href="plotting-with-ggplot2.html#graphics-in-r"><i class="fa fa-check"></i>Graphics in R</a></li>
<li><a href="plotting-with-ggplot2.html#data-visualisation-in-practice-exploring-individual-with-ggplot2">Data visualisation in practice: Exploring <code>individual</code> with <code>ggplot2</code></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="literate-programming-in-rmarkdown.html"><a href="literate-programming-in-rmarkdown.html"><i class="fa fa-check"></i>Literate programming in rmarkdown</a><ul>
<li class="chapter" data-level="" data-path="literate-programming-in-rmarkdown.html"><a href="literate-programming-in-rmarkdown.html#literate-programming"><i class="fa fa-check"></i>Literate programming</a></li>
<li><a href="literate-programming-in-rmarkdown.html#literate-programming-in-r"><strong>Literate programming in R</strong></a></li>
<li class="chapter" data-level="" data-path="literate-programming-in-rmarkdown.html"><a href="literate-programming-in-rmarkdown.html#applications-of-rmd-in-research"><i class="fa fa-check"></i>Applications of Rmd in research</a></li>
<li><a href="literate-programming-in-rmarkdown.html#rmd-in-practice"><code>Rmd</code> in Practice</a></li>
<li><a href="literate-programming-in-rmarkdown.html#advanced-.rmd">Advanced <code>.Rmd</code></a></li>
<li class="chapter" data-level="" data-path="literate-programming-in-rmarkdown.html"><a href="literate-programming-in-rmarkdown.html#parting-words"><i class="fa fa-check"></i>Parting words</a></li>
<li class="chapter" data-level="" data-path="literate-programming-in-rmarkdown.html"><a href="literate-programming-in-rmarkdown.html#getting-help-with-markdown"><i class="fa fa-check"></i>Getting help with markdown</a></li>
<li><a href="literate-programming-in-rmarkdown.html#resources-1"><strong>Resources</strong></a></li>
</ul></li>
<li class="part"><span><b>VI Version Control</b></span></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html"><i class="fa fa-check"></i>Version Control with Git</a><ul>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#what-is-version-control"><i class="fa fa-check"></i>What is Version control? ü§î</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#what-is-git"><i class="fa fa-check"></i>What is git? ü§î</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#what-is-github"><i class="fa fa-check"></i>What is GitHub ü§î</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#git-github-rstudio"><i class="fa fa-check"></i>Git, Github &amp; Rstudio</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#demo"><i class="fa fa-check"></i>Demo</a></li>
<li><a href="version-control-with-git.html#how-does-git-work">How does <code>Git</code> work?</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#configure-git-github"><i class="fa fa-check"></i>üíª Configure git &amp; GitHub</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#version-controlling-projects"><i class="fa fa-check"></i>Version Controlling projects</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#create-a-readme"><i class="fa fa-check"></i>Create a README</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#edit-readme"><i class="fa fa-check"></i>Edit README</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#create-repository-on-github"><i class="fa fa-check"></i>üö¶ Create repository on GitHub</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#create-repository"><i class="fa fa-check"></i>Create repository</a></li>
<li><a href="version-control-with-git.html#go-to-repo-settings">Go to repo <strong>Settings</strong></a></li>
<li><a href="version-control-with-git.html#enable-gh-pages">Enable <code>gh-pages</code></a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#pushing-files"><i class="fa fa-check"></i>pushing files</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#commit-your-changes"><i class="fa fa-check"></i>Commit your changes</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#deleting-files"><i class="fa fa-check"></i>üö¶ Deleting files</a></li>
<li><a href="version-control-with-git.html#gitignore"><code>.gitignore</code></a></li>
<li><a href="version-control-with-git.html#gitignore-regex"><code>gitignore</code> regex</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#further-resources"><i class="fa fa-check"></i>Further Resources</a></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html#never-forget"><i class="fa fa-check"></i>Never forget</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="collaborative-github.html"><a href="collaborative-github.html"><i class="fa fa-check"></i>Collaborative GitHub</a></li>
<li><a href="practical-github-rstudio-for-collaborative-coding.html#practical-github-rstudio-for-collaborative-coding">Practical: <code>GitHub</code> &amp; <code>Rstudio</code> for collaborative coding</a><ul>
<li><a href="practical-github-rstudio-for-collaborative-coding.html#evolottery"><strong>EvoLottery</strong></a></li>
<li class="chapter" data-level="" data-path="practical-github-rstudio-for-collaborative-coding.html"><a href="practical-github-rstudio-for-collaborative-coding.html"><i class="fa fa-check"></i>Clone Github repo</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html"><i class="fa fa-check"></i>Packaging functionality</a><ul>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#r-package-structure"><i class="fa fa-check"></i>R Package Structure</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#r-package-conventions"><i class="fa fa-check"></i>R Package conventions:</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#software-engineering-approach"><i class="fa fa-check"></i>Software Engineering approach</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#anatomy-of-an-r-package"><i class="fa fa-check"></i>Anatomy of an R package</a></li>
<li><a href="packaging-functionality.html#description-file"><code>DESCRIPTION</code> file</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#dependency-management"><i class="fa fa-check"></i>Dependency management</a></li>
<li><a href="packaging-functionality.html#r-1"><code>R/</code></a></li>
<li><a href="packaging-functionality.html#document-functions-with-roxygen">Document functions with <code>Roxygen</code></a></li>
<li><a href="packaging-functionality.html#tests"><code>tests/</code></a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#create-your-first-package"><i class="fa fa-check"></i>üíªCreate your first package</a></li>
<li><a href="packaging-functionality.html#functions-in-the-r-dir">üö¶ Functions in the <strong><code>R/</code></strong> dir</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#roxygen-documentation"><i class="fa fa-check"></i>üö¶ Roxygen documentation</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#personalise-function"><i class="fa fa-check"></i>üö¶ Personalise function</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#add-some-fun"><i class="fa fa-check"></i>Add some fun!</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#check-package-integrity"><i class="fa fa-check"></i>üö¶ Check package integrity</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#add-dependencies"><i class="fa fa-check"></i>üö¶ Add dependencies</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#add-license"><i class="fa fa-check"></i>Add License</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#add-test"><i class="fa fa-check"></i>üö¶ Add Test</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#create-test-file"><i class="fa fa-check"></i>create test file</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#write-test"><i class="fa fa-check"></i>Write test</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#complete-package-metadata"><i class="fa fa-check"></i>üö¶ Complete package metadata</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#authors"><i class="fa fa-check"></i>Authors</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#add-a-title-and-description"><i class="fa fa-check"></i>Add a title and description</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#add-a-date"><i class="fa fa-check"></i>Add a date</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#create-readme"><i class="fa fa-check"></i>üö¶ Create README</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#commit-and-push-to-github"><i class="fa fa-check"></i>Commit and push to GitHub</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html#create-documentation-site"><i class="fa fa-check"></i>üö¶ Create documentation site</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html"><i class="fa fa-check"></i>Creating a research compendium with rrtools</a><ul>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#background"><i class="fa fa-check"></i>Background</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#enter-the-research-compendium"><i class="fa fa-check"></i>Enter the Research Compendium</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#r-community-response"><i class="fa fa-check"></i>R community response</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#general-project-organisation-1"><i class="fa fa-check"></i>General Project Organisation</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#from-raw-to-analytical-data"><i class="fa fa-check"></i>From raw to analytical data</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#separate-function-definition-and-application"><i class="fa fa-check"></i>Separate function definition and application</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#use-rstudio-projects"><i class="fa fa-check"></i>Use Rstudio projects</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#follow-convention"><i class="fa fa-check"></i>Follow convention</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#r-developer-tools"><i class="fa fa-check"></i>R Developer Tools</a></li>
<li><a href="creating-a-research-compendium-with-rrtools.html#rrtools-research-compendia-in-r"><code>rrtools</code>: Research Compendia in R</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#workshop-materials"><i class="fa fa-check"></i>üíª Workshop materials</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#data"><i class="fa fa-check"></i>Data</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#workshop-aims-and-objectives"><i class="fa fa-check"></i>Workshop aims and objectives</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#rrtools-setup"><i class="fa fa-check"></i>Setup</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#create-compendium"><i class="fa fa-check"></i>üö¶ Create compendium</a></li>
<li><a href="creating-a-research-compendium-with-rrtools.html#update-description-file">üö¶ Update <code>DESCRIPTION</code> file</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#sharing-a-compendium-on-github"><i class="fa fa-check"></i>üö¶Sharing a compendium on GitHub</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#create-readme-1"><i class="fa fa-check"></i>Create README</a></li>
<li><a href="creating-a-research-compendium-with-rrtools.html#update-readme">update <code>README</code></a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#create-github-repository"><i class="fa fa-check"></i>üö¶ Create GitHub repository</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#setting-up-the-analysis-folder"><i class="fa fa-check"></i>üö¶ Setting up the analysis folder</a></li>
<li><a href="creating-a-research-compendium-with-rrtools.html#create-analysis">Create <code>analysis</code></a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#reproduce-a-paper-in-rmd"><i class="fa fa-check"></i>üö¶ Reproduce a paper in Rmd</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#setup-data"><i class="fa fa-check"></i>Setup data</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#inspect-analysis.r-file"><i class="fa fa-check"></i>Inspect analysis.R file</a></li>
<li><a href="creating-a-research-compendium-with-rrtools.html#create-journal-article-template-using-rticles">üö¶ Create journal article template using <code>rticles</code></a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#update-yaml"><i class="fa fa-check"></i>üö¶ Update YAML</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#add-text"><i class="fa fa-check"></i>üö¶ Add text</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#update-references"><i class="fa fa-check"></i>üö¶ Update references</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#update-math"><i class="fa fa-check"></i>üö¶ Update math</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#add-code"><i class="fa fa-check"></i>üö¶ Add code</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#render-final-document-to-pdf"><i class="fa fa-check"></i>Render final document to pdf</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#add-paper-dependencies"><i class="fa fa-check"></i>üö¶ Add paper dependencies</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html#final-compendium"><i class="fa fa-check"></i>Final compendium</a></li>
</ul></li>
<li class="part"><span><b>VII APPENDIX</b></span></li>
<li><a href="individual-r.html#individual.r"><code>individual.R</code></a><ul>
<li><a href="individual-r.html#data-rawindividual.r"><strong><code>data-raw/individual.R</code></strong></a></li>
</ul></li>
<li><a href="geolocate-r.html#geolocate.r"><code>geolocate.R</code></a><ul>
<li><a href="geolocate-r.html#rgeolocate.r"><strong><code>R/geolocate.R</code></strong></a></li>
</ul></li>
<li><a href="analysis-r-1.html#analysis.r-1"><code>analysis.R</code></a><ul>
<li><a href="analysis-r-1.html#analysis.r-2"><strong><code>analysis.R</code></strong></a></li>
</ul></li>
<li><a href="index-rmd.html#index.rmd"><code>index.Rmd</code></a><ul>
<li><a href="index-rmd.html#index.rmd-1"><strong><code>index.Rmd</code></strong></a></li>
</ul></li>
<li class="chapter" data-level="" data-path="about.html"><a href="about.html"><i class="fa fa-check"></i>About</a><ul>
<li class="chapter" data-level="" data-path="about.html"><a href="about.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i>Software Setup</a><ul>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html#software-requirements"><i class="fa fa-check"></i>Software Requirements</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i>Solutions</a><ul>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html#part-i"><i class="fa fa-check"></i>Part I</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://annakrystalli.me/rrreasearchACCE2020" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Research Data &amp; Project Management in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1">
<h1>Functions</h1>
<p>As we‚Äôve mentioned, functions, and especially user built custom functions, are a key feature of R and are a really powerful of reducing code repetition.</p>
<div class="alert alert-info">
<h2 id="function-basics">Function basics</h2>
<p><strong>Functions allow us to:</strong></p>
<ul>
<li>incorporate sets of instructions that we want to use repeatedly</li>
<li>contain complex code in a neat sub-program</li>
<li>reduce opportunity for errors</li>
<li>make code more readable</li>
</ul>
<p><strong>You can do anything with functions that you can do with vectors:</strong></p>
<ul>
<li>assign them to variables</li>
<li>store them in lists</li>
<li>pass them as arguments to other functions</li>
<li>create them inside functions</li>
<li>return them as the result of a function</li>
</ul>
<p><strong>In general, functions usually:</strong>
- accept parameters (arguments) &lt;- <code>INPUT</code>
- return value(s) &lt;- <code>OUTPUT</code></p>
</div>
<div id="elements-of-a-function" class="section level2">
<h2>Elements of a function</h2>
<p>Here‚Äôs a simple skeleton of a function.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb348-1" data-line-number="1">name &lt;-<span class="st"> </span><span class="cf">function</span>(variables) {</a>
<a class="sourceLine" id="cb348-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb348-3" data-line-number="3">}</a></code></pre></div>
<div id="function-name" class="section level3">
<h3>Function name</h3>
<p>This can be any valid variable name, but you should avoid using names that are used elsewhere in R, such as <code>dir</code>, <code>function</code>, <code>plot</code>, etc</p>
<ul>
<li>choose descriptive names</li>
<li>use verbs</li>
<li>check whether they are already in use: <code>? function.name</code></li>
</ul>
<p>(you can access a function from a specific package using <code>package.name::function.name</code>)</p>
<p><br></p>
</div>
<div id="arguments" class="section level3">
<h3>Arguments</h3>
<p>Functions can have <strong>any number of arguments</strong>. These can be <strong>any R object:</strong> numbers, strings, arrays, data frames, of even pointers to other functions; anything that is needed for the function to run.</p>
<ul>
<li>Again, use descriptive names for arguments.</li>
</ul>
</div>
<div id="body" class="section level3">
<h3>Body</h3>
<p>The function code between the <code>{}</code> brackets is run every time the function is called. Ideally functions are short and do just one thing.</p>
<p><strong>All inputs required for computation in the body must be supplied as arguments.</strong></p>
</div>
<div id="simple-example" class="section level3">
<h3>Simple example</h3>
<p>Let‚Äôs write a simple function that takes two arguments <code>x</code> and <code>y</code> and adds them together.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb349-1" data-line-number="1">add &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb349-2" data-line-number="2">    x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb349-3" data-line-number="3">}</a></code></pre></div>
<p>Let‚Äôs test it.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb350-1" data-line-number="1">x &lt;-<span class="st"> </span><span class="dv">4</span></a>
<a class="sourceLine" id="cb350-2" data-line-number="2">y &lt;-<span class="st"> </span><span class="dv">2</span></a>
<a class="sourceLine" id="cb350-3" data-line-number="3"><span class="kw">add</span>(x, y)</a></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>Cool it works!</p>
</div>
<div id="return-value" class="section level3">
<h3>Return value</h3>
<p>By default, the output of the last line of the code is evaluated is the value that will be returned by the function.</p>
<p>We can override that default by using <code>return</code> to explicitly specify what is returned.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb352-1" data-line-number="1">add &lt;-<span class="st"> </span><span class="cf">function</span>(x, y) {</a>
<a class="sourceLine" id="cb352-2" data-line-number="2">    x <span class="op">+</span><span class="st"> </span>y</a>
<a class="sourceLine" id="cb352-3" data-line-number="3">    <span class="kw">return</span>(<span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb352-4" data-line-number="4">}</a></code></pre></div>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb353-1" data-line-number="1"><span class="kw">add</span>(x, y)</a></code></pre></div>
<pre><code>## NULL</code></pre>
<p>It is not necessary that a function return anything, for example a function that makes a plot might not return anything, whereas a function that does a mathematical operation might return a number, or a list.</p>
</div>
<div id="function-environment" class="section level3">
<h3>Function Environment</h3>
<div class="alert alert-info">
<p><strong>Every time a function is called, a new environment is created to host execution.</strong></p>
<ul>
<li><p>Each invocation is <strong>completely independent of previous ones</strong></p></li>
<li><p>Variables used within are <strong><em>local</em></strong>, e.g.¬†their scope lies within - and is limited to - the function itself. They are therefore <strong>invisible outside the function body</strong></p></li>
</ul>
</div>
<p>Objects required by the function will be sought first in the <strong><em>local environment</em></strong>. If an argument specified in the function is missing, it will return an error, even if such an object exists in the global environment.</p>
<p>Objects required by computation but not specified as function arguments will be sought in the containing environment iteratively until it reaches the <strong><em>global environment</em></strong>. This can be a source of bugs when developing with an untidy global environment.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb355-1" data-line-number="1">b &lt;-<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb355-2" data-line-number="2">f2 &lt;-<span class="st"> </span><span class="cf">function</span>(a){a <span class="op">+</span><span class="st"> </span>b}</a>
<a class="sourceLine" id="cb355-3" data-line-number="3"><span class="kw">f2</span>(<span class="dt">a =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb357-1" data-line-number="1"><span class="kw">rm</span>(b) <span class="co"># remove object b</span></a>
<a class="sourceLine" id="cb357-2" data-line-number="2"><span class="kw">f2</span>(<span class="dt">a =</span> <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## Error in f2(a = 10): object &#39;b&#39; not found</code></pre>
<p>Solution: always make sure any required variables are passed as arguments to your functions.</p>
</div>
</div>
<div id="creating-our-user-built-functions" class="section level2">
<h2>Creating our user-built functions</h2>
<p>Now that we‚Äôve got all the information required, we can start building a function that will return our latitude and longitude for each individual.</p>
<p>We can use function <code>destPoint</code> form package <code>geosphere</code> to calculate the destination latitude and longitude from a given starting point, the distance travelled and the direction (bearing) travelled in.</p>
<p>I our case the distance travelled is equivalent to <code>stemDistance</code> and the direction or bearing is equivalent to <code>stemAzimuth</code>. The starting point is given by <code>decimalLatitude</code> and `<code>decimalLongitude.</code></p>
<p>Now, let‚Äôs write a function that takes these columns as inputs and returns the latitude and longitude of the location of our individuals.</p>
<div id="storing-functions-in-scripts." class="section level3">
<h3>Storing functions in scripts.</h3>
<p>It‚Äôs best to store functions in separate scripts in the <code>R/</code> directory.</p>
<p>We can use function <code>usethis::use_r()</code> to create scripts in <code>R/</code>. Let‚Äôs create a new one to start working on our function.</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb359-1" data-line-number="1">usethis<span class="op">::</span><span class="kw">use_r</span>(<span class="st">&quot;geolocate&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb360-1" data-line-number="1">‚úî Setting active project to <span class="st">&#39;/Users/Anna/Documents/workflows/workshops/books/rrresearchACCE20&#39;</span></a>
<a class="sourceLine" id="cb360-2" data-line-number="2">‚óè Modify <span class="st">&#39;R/geolocate.R&#39;</span></a></code></pre></div>
<p>This creates the required <code>R/</code> directory, creates a new R script named <code>geolocation.R</code> within it and launches it for editing all in one go! Nice.</p>
</div>
</div>
<div id="experimenting" class="section level2">
<h2>Experimenting</h2>
<p>Now before we begin writing our function, let‚Äôs test <code>destPoint</code> out. To do that, let‚Äôs subset a single row from <code>individual</code> and use it to test out the function. We need to supply a vector of length two, containing the starting longitude and latitude to argument <code>p</code>. We pass <code>stemAzimuth</code> to argument <code>b</code> (for bearing) and <code>stemDistance</code> to argument <code>d</code> (for distance).</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb361-1" data-line-number="1">x &lt;-<span class="st"> </span>individual[<span class="dv">1</span>,]</a>
<a class="sourceLine" id="cb361-2" data-line-number="2">geosphere<span class="op">::</span><span class="kw">destPoint</span>(<span class="dt">p =</span> <span class="kw">c</span>(x<span class="op">$</span>decimalLongitude, x<span class="op">$</span>decimalLatitude), </a>
<a class="sourceLine" id="cb361-3" data-line-number="3">                     <span class="dt">b =</span> x<span class="op">$</span>stemAzimuth, <span class="dt">d =</span> x<span class="op">$</span>stemDistance)</a></code></pre></div>
<pre><code>##            lon      lat
## [1,] -71.28333 44.06151</code></pre>
<p>This looks like it‚Äôs working nicely. Let‚Äôs also check that it vectorises easily, i.e.¬†that if we give it vectors of values instead of single ones that it works properly.</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb363-1" data-line-number="1">x &lt;-<span class="st"> </span>individual[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>,]</a>
<a class="sourceLine" id="cb363-2" data-line-number="2"></a>
<a class="sourceLine" id="cb363-3" data-line-number="3">geosphere<span class="op">::</span><span class="kw">destPoint</span>(<span class="dt">p =</span> <span class="kw">c</span>(x<span class="op">$</span>decimalLongitude, x<span class="op">$</span>decimalLatitude), </a>
<a class="sourceLine" id="cb363-4" data-line-number="4">                     <span class="dt">b =</span> x<span class="op">$</span>stemAzimuth, <span class="dt">d =</span> x<span class="op">$</span>stemDistance)</a></code></pre></div>
<pre><code>## Error in .pointsToMatrix(p): Wrong length for a vector, should be 2</code></pre>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb365-1" data-line-number="1">geosphere<span class="op">::</span><span class="kw">destPoint</span>(<span class="dt">p =</span> <span class="kw">cbind</span>(x<span class="op">$</span>decimalLongitude, x<span class="op">$</span>decimalLatitude), </a>
<a class="sourceLine" id="cb365-2" data-line-number="2">                     <span class="dt">b =</span> x<span class="op">$</span>stemAzimuth, <span class="dt">d =</span> x<span class="op">$</span>stemDistance)</a></code></pre></div>
<pre><code>##            lon      lat
## [1,] -71.28333 44.06151
## [2,] -71.28325 44.06165
## [3,] -71.28419 44.06109
## [4,] -71.28424 44.06096
## [5,] -71.28409 44.06103</code></pre>
<p>Excellent! I now get a two dimensional matrix of with two columns and a row for each input element! This is looking promising.</p>
<p>We‚Äôre ready to start writing our function.</p>
</div>
<div id="developing-our-function" class="section level2">
<h2>Developing our function</h2>
<p>Let‚Äôs start by using a handy feature in Rstudio, code snippets. Code snippets are text macros that are used for quickly inserting common snippets of code.</p>
<p>The fun snippet inserts an R function definition. To invoke it start typing <code>fun</code> until the auto-complete drop-down pops up.</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb367-1" data-line-number="1">fun</a></code></pre></div>
<p><img src="assets/snippet_fun.png" width="140" /></p>
<p>Select <code>fun</code> and hit Return / Enter.</p>
<p>You end up with this handy function skeleton. Now, let‚Äôs start populating it with our own function.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb368-1" data-line-number="1">name &lt;-<span class="st"> </span><span class="cf">function</span>(variables) {</a>
<a class="sourceLine" id="cb368-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb368-3" data-line-number="3">}</a></code></pre></div>
<p>First lets start with a descriptive name:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb369-1" data-line-number="1">get_stem_location &lt;-<span class="st"> </span><span class="cf">function</span>(variables) {</a>
<a class="sourceLine" id="cb369-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb369-3" data-line-number="3">}</a></code></pre></div>
<p>Let‚Äôs add our arguments:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb370-1" data-line-number="1">get_stem_location &lt;-<span class="st"> </span><span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</a>
<a class="sourceLine" id="cb370-2" data-line-number="2"></a>
<a class="sourceLine" id="cb370-3" data-line-number="3">}</a></code></pre></div>
<p>Finally, let‚Äôs populate the body our our function:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb371-1" data-line-number="1">get_stem_location &lt;-<span class="st"> </span><span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</a>
<a class="sourceLine" id="cb371-2" data-line-number="2">    geosphere<span class="op">::</span><span class="kw">destPoint</span>(<span class="dt">p =</span> <span class="kw">cbind</span>(decimalLongitude, decimalLatitude), </a>
<a class="sourceLine" id="cb371-3" data-line-number="3">                     <span class="dt">b =</span> stemAzimuth, <span class="dt">d =</span> stemDistance)</a>
<a class="sourceLine" id="cb371-4" data-line-number="4">}</a></code></pre></div>
<p>Let‚Äôs also convert the output to a tibble, for better printing.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb372-1" data-line-number="1">get_stem_location &lt;-<span class="st"> </span><span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</a>
<a class="sourceLine" id="cb372-2" data-line-number="2">    geosphere<span class="op">::</span><span class="kw">destPoint</span>(<span class="dt">p =</span> <span class="kw">cbind</span>(decimalLongitude, decimalLatitude), </a>
<a class="sourceLine" id="cb372-3" data-line-number="3">                         <span class="dt">b =</span> stemAzimuth, <span class="dt">d =</span> stemDistance) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb372-4" data-line-number="4"><span class="st">        </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb372-5" data-line-number="5">}</a></code></pre></div>
<p>Now let‚Äôs test it out with vectors from <code>individual</code>.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb373-1" data-line-number="1">test &lt;-<span class="st"> </span><span class="kw">get_stem_location</span>(x<span class="op">$</span>decimalLongitude, x<span class="op">$</span>decimalLatitude, </a>
<a class="sourceLine" id="cb373-2" data-line-number="2">                  x<span class="op">$</span>stemAzimuth, x<span class="op">$</span>stemDistance)</a>
<a class="sourceLine" id="cb373-3" data-line-number="3">test</a></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##     lon   lat
##   &lt;dbl&gt; &lt;dbl&gt;
## 1 -71.3  44.1
## 2 -71.3  44.1
## 3 -71.3  44.1
## 4 -71.3  44.1
## 5 -71.3  44.1</code></pre>
<p>Looks like it works nicely!</p>
<div id="defensive-programming-in-functions" class="section level3">
<h3>Defensive programming in functions</h3>
<p>Our function seems to be working correctly but it‚Äôs good to incorporate checks, especially on our inputs and outputs. For example, if we supply a character vector to our function by mistake, our function won‚Äôt work.</p>
<p>We can write smart checks using the suite of functions in package <code>checkmate</code>.</p>
<p>One such function is <code>assert_numeric()</code></p>
<p>This checks whether the the object we give it is numeric. If the check is not successful, it returns the object invisibly. If the check is not successful, it throws an error.</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb375-1" data-line-number="1">checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(x<span class="op">$</span>decimalLatitude)</a>
<a class="sourceLine" id="cb375-2" data-line-number="2">checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(x<span class="op">$</span>uid)</a></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): Assertion on &#39;x$uid&#39; failed: Must be of type &#39;numeric&#39;, not &#39;character&#39;.</code></pre>
<p>There are two other versions, <code>test_numeric</code> which returns <code>FALSE</code> if the check is not successful, and <code>check_numeric</code> which returns a string with the error message. We want to throw an error and stop execution so we use <code>assert_numeric</code>.</p>
<p>Let‚Äôs add a validation check for each argument in our function.</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb377-1" data-line-number="1">get_stem_location &lt;-<span class="st"> </span><span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</a>
<a class="sourceLine" id="cb377-2" data-line-number="2">    </a>
<a class="sourceLine" id="cb377-3" data-line-number="3">    <span class="co"># validation checks</span></a>
<a class="sourceLine" id="cb377-4" data-line-number="4">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(decimalLongitude)</a>
<a class="sourceLine" id="cb377-5" data-line-number="5">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(decimalLatitude)</a>
<a class="sourceLine" id="cb377-6" data-line-number="6">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(stemAzimuth)</a>
<a class="sourceLine" id="cb377-7" data-line-number="7">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(stemDistance)</a>
<a class="sourceLine" id="cb377-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb377-9" data-line-number="9">    </a>
<a class="sourceLine" id="cb377-10" data-line-number="10">    geosphere<span class="op">::</span><span class="kw">destPoint</span>(<span class="dt">p =</span> <span class="kw">cbind</span>(decimalLongitude, decimalLatitude), </a>
<a class="sourceLine" id="cb377-11" data-line-number="11">                         <span class="dt">b =</span> stemAzimuth, <span class="dt">d =</span> stemDistance) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb377-12" data-line-number="12"><span class="st">        </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb377-13" data-line-number="13">}</a></code></pre></div>
<p>Let‚Äôs also add a check to our output. Let‚Äôs throw a warning if there are any <code>NA</code> values in our output.</p>
<p>First we store our output so we can evaluate it.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb378-1" data-line-number="1">get_stem_location &lt;-<span class="st"> </span><span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</a>
<a class="sourceLine" id="cb378-2" data-line-number="2">    <span class="co"># validation checks</span></a>
<a class="sourceLine" id="cb378-3" data-line-number="3">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(decimalLongitude)</a>
<a class="sourceLine" id="cb378-4" data-line-number="4">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(decimalLatitude)</a>
<a class="sourceLine" id="cb378-5" data-line-number="5">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(stemAzimuth)</a>
<a class="sourceLine" id="cb378-6" data-line-number="6">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(stemDistance)</a>
<a class="sourceLine" id="cb378-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb378-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb378-9" data-line-number="9">    out &lt;-<span class="st"> </span>geosphere<span class="op">::</span><span class="kw">destPoint</span>(<span class="dt">p =</span> <span class="kw">cbind</span>(decimalLongitude, decimalLatitude), </a>
<a class="sourceLine" id="cb378-10" data-line-number="10">                                <span class="dt">b =</span> stemAzimuth, <span class="dt">d =</span> stemDistance) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb378-11" data-line-number="11"><span class="st">        </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb378-12" data-line-number="12">}</a></code></pre></div>
<p>Next we can add our check:</p>
<p>We can check the whole tibble for <code>NA</code>s in one go. We get a 2 dimensional matrix of logical values.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb379-1" data-line-number="1"><span class="kw">is.na</span>(test) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</a></code></pre></div>
<pre><code>##        lon   lat
## [1,] FALSE FALSE
## [2,] FALSE FALSE
## [3,] FALSE FALSE
## [4,] FALSE FALSE
## [5,] FALSE FALSE</code></pre>
<p>We can then wrap the output of that in <code>any()</code> which tests whether there are any <code>TRUE</code> values in a logical array.</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb381-1" data-line-number="1"><span class="kw">any</span>(<span class="kw">is.na</span>(test))</a></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Let‚Äôs apply that to our function.</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb383-1" data-line-number="1">get_stem_location &lt;-<span class="st"> </span><span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</a>
<a class="sourceLine" id="cb383-2" data-line-number="2">    <span class="co"># validation checks</span></a>
<a class="sourceLine" id="cb383-3" data-line-number="3">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(decimalLongitude)</a>
<a class="sourceLine" id="cb383-4" data-line-number="4">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(decimalLatitude)</a>
<a class="sourceLine" id="cb383-5" data-line-number="5">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(stemAzimuth)</a>
<a class="sourceLine" id="cb383-6" data-line-number="6">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(stemDistance)</a>
<a class="sourceLine" id="cb383-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb383-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb383-9" data-line-number="9">    out &lt;-<span class="st"> </span>geosphere<span class="op">::</span><span class="kw">destPoint</span>(<span class="dt">p =</span> <span class="kw">cbind</span>(decimalLongitude, decimalLatitude), </a>
<a class="sourceLine" id="cb383-10" data-line-number="10">                                <span class="dt">b =</span> stemAzimuth, <span class="dt">d =</span> stemDistance) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb383-11" data-line-number="11"><span class="st">        </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb383-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb383-13" data-line-number="13">    checkmate<span class="op">::</span><span class="kw">assert_false</span>(<span class="kw">any</span>(<span class="kw">is.na</span>(out)))</a>
<a class="sourceLine" id="cb383-14" data-line-number="14">}</a></code></pre></div>
<p>Lastly, we need to return our actual output!</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb384-1" data-line-number="1">get_stem_location &lt;-<span class="st"> </span><span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</a>
<a class="sourceLine" id="cb384-2" data-line-number="2">    <span class="co"># validation checks</span></a>
<a class="sourceLine" id="cb384-3" data-line-number="3">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(decimalLongitude)</a>
<a class="sourceLine" id="cb384-4" data-line-number="4">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(decimalLatitude)</a>
<a class="sourceLine" id="cb384-5" data-line-number="5">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(stemAzimuth)</a>
<a class="sourceLine" id="cb384-6" data-line-number="6">    checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(stemDistance)</a>
<a class="sourceLine" id="cb384-7" data-line-number="7">    </a>
<a class="sourceLine" id="cb384-8" data-line-number="8">    </a>
<a class="sourceLine" id="cb384-9" data-line-number="9">    out &lt;-<span class="st"> </span>geosphere<span class="op">::</span><span class="kw">destPoint</span>(<span class="dt">p =</span> <span class="kw">cbind</span>(decimalLongitude, decimalLatitude), </a>
<a class="sourceLine" id="cb384-10" data-line-number="10">                                <span class="dt">b =</span> stemAzimuth, <span class="dt">d =</span> stemDistance) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb384-11" data-line-number="11"><span class="st">        </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb384-12" data-line-number="12">    </a>
<a class="sourceLine" id="cb384-13" data-line-number="13">    checkmate<span class="op">::</span><span class="kw">assert_false</span>(<span class="kw">any</span>(<span class="kw">is.na</span>(out)))</a>
<a class="sourceLine" id="cb384-14" data-line-number="14">    </a>
<a class="sourceLine" id="cb384-15" data-line-number="15">    <span class="kw">return</span>(out)</a>
<a class="sourceLine" id="cb384-16" data-line-number="16">}</a></code></pre></div>
<p>Let‚Äôs test it again:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb385-1" data-line-number="1"><span class="kw">get_stem_location</span>(x<span class="op">$</span>decimalLongitude, x<span class="op">$</span>decimalLatitude, </a>
<a class="sourceLine" id="cb385-2" data-line-number="2">                  x<span class="op">$</span>stemAzimuth, x<span class="op">$</span>stemDistance)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##     lon   lat
##   &lt;dbl&gt; &lt;dbl&gt;
## 1 -71.3  44.1
## 2 -71.3  44.1
## 3 -71.3  44.1
## 4 -71.3  44.1
## 5 -71.3  44.1</code></pre>
<p>And now, remove any excess code form our script and save.</p>
<p>Our function is now ready to be sourced into our last preprocessing stage, adding the new <code>stemLat</code> and <code>stemLon</code> columns. üéâ.</p>
</div>
<div id="making-new-variables" class="section level3">
<h3>Making new variables</h3>
<p>Let‚Äôs move back to our <code>individual.R</code> script. At the top of our script, let‚Äôs add the code to source our function so it‚Äôs available during preprocessing:</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb387-1" data-line-number="1"><span class="kw">source</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;geolocation.R&quot;</span>))</a></code></pre></div>
<p>Now we want to use data in <code>individual</code> to geolocate our individulas while at the same time creating new columns <code>stemLat</code> and <code>stemLon</code></p>
<p>For this we use <code>dplyr::mutate()</code>:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb388-1" data-line-number="1">individual <span class="op">%&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">stemLat =</span> <span class="kw">get_stem_location</span>(decimalLongitude, decimalLatitude, </a>
<a class="sourceLine" id="cb388-2" data-line-number="2">                                                         stemAzimuth, stemDistance)<span class="op">$</span>lat, </a>
<a class="sourceLine" id="cb388-3" data-line-number="3">                             <span class="dt">stemLon =</span> <span class="kw">get_stem_location</span>(decimalLongitude, decimalLatitude, </a>
<a class="sourceLine" id="cb388-4" data-line-number="4">                                                         stemAzimuth, stemDistance)<span class="op">$</span>lon)</a></code></pre></div>
<pre><code>## # A tibble: 14,961 x 32
##    uid   namedLocation date       eventID domainID siteID plotID individualID
##    &lt;chr&gt; &lt;chr&gt;         &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a‚Ä¶ BART_037.bas‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  2 68dc‚Ä¶ BART_037.bas‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  3 a895‚Ä¶ BART_044.bas‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  4 eb34‚Ä¶ BART_044.bas‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  5 2a44‚Ä¶ BART_044.bas‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  6 e485‚Ä¶ BART_044.bas‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  7 280c‚Ä¶ BART_044.bas‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  8 0e50‚Ä¶ BART_044.bas‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  9 4918‚Ä¶ BART_044.bas‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
## 10 ef16‚Ä¶ BART_044.bas‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
## # ‚Ä¶ with 14,951 more rows, and 24 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;, uid_map &lt;chr&gt;,
## #   pointID &lt;dbl&gt;, stemDistance &lt;dbl&gt;, stemAzimuth &lt;dbl&gt;, taxonID &lt;chr&gt;,
## #   scientificName &lt;chr&gt;, taxonRank &lt;chr&gt;, uid_ppl &lt;chr&gt;, plotType &lt;chr&gt;,
## #   nlcdClass &lt;chr&gt;, decimalLatitude &lt;dbl&gt;, decimalLongitude &lt;dbl&gt;,
## #   geodeticDatum &lt;chr&gt;, easting &lt;dbl&gt;, northing &lt;dbl&gt;, utmZone &lt;chr&gt;,
## #   elevation &lt;dbl&gt;, elevationUncertainty &lt;dbl&gt;, stemLat &lt;dbl&gt;, stemLon &lt;dbl&gt;</code></pre>
<p>We also need to extract the appropriate coordinate for each column. We do that by using the <code>$</code> subsetting operation after we call <code>get_stem_location()</code>.</p>
<p>It works! We‚Äôre almost done with our data munging!</p>
<p>Lets use the assignment pipe again now that we are happy.</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb390-1" data-line-number="1">individual <span class="op">%&lt;&gt;%</span><span class="st"> </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">stemLat =</span> <span class="kw">get_stem_location</span>(decimalLongitude, decimalLatitude, </a>
<a class="sourceLine" id="cb390-2" data-line-number="2">                                                         stemAzimuth, stemDistance)<span class="op">$</span>lat, </a>
<a class="sourceLine" id="cb390-3" data-line-number="3">                             <span class="dt">stemLon =</span> <span class="kw">get_stem_location</span>(decimalLongitude, decimalLatitude, </a>
<a class="sourceLine" id="cb390-4" data-line-number="4">                                                         stemAzimuth, stemDistance)<span class="op">$</span>lon)</a></code></pre></div>
<p>Let‚Äôs do a couple last sanity checks:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb391-1" data-line-number="1"><span class="kw">View</span>(individual)</a></code></pre></div>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb392-1" data-line-number="1"><span class="kw">str</span>(individual)</a></code></pre></div>
<pre><code>## tibble [14,961 √ó 32] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##  $ uid                 : chr [1:14961] &quot;a36a162d-ed1f-4f80-ae45-88e973855c68&quot; &quot;68dc7adf-48e2-4f7a-9272-9a468fde6d55&quot; &quot;a8951ab9-4462-48dd-ab9e-7b89e24f2e03&quot; &quot;eb348eaf-3969-46a4-ac3b-523c3548efeb&quot; ...
##  $ namedLocation       : chr [1:14961] &quot;BART_037.basePlot.vst&quot; &quot;BART_037.basePlot.vst&quot; &quot;BART_044.basePlot.vst&quot; &quot;BART_044.basePlot.vst&quot; ...
##  $ date                : Date[1:14961], format: &quot;2015-08-26&quot; &quot;2015-08-26&quot; ...
##  $ eventID             : chr [1:14961] &quot;vst_BART_2015&quot; &quot;vst_BART_2015&quot; &quot;vst_BART_2015&quot; &quot;vst_BART_2015&quot; ...
##  $ domainID            : chr [1:14961] &quot;D01&quot; &quot;D01&quot; &quot;D01&quot; &quot;D01&quot; ...
##  $ siteID              : chr [1:14961] &quot;BART&quot; &quot;BART&quot; &quot;BART&quot; &quot;BART&quot; ...
##  $ plotID              : chr [1:14961] &quot;BART_037&quot; &quot;BART_037&quot; &quot;BART_044&quot; &quot;BART_044&quot; ...
##  $ individualID        : chr [1:14961] &quot;NEON.PLA.D01.BART.05285&quot; &quot;NEON.PLA.D01.BART.05279&quot; &quot;NEON.PLA.D01.BART.05419&quot; &quot;NEON.PLA.D01.BART.05092&quot; ...
##  $ growthForm          : chr [1:14961] &quot;single bole tree&quot; &quot;single bole tree&quot; &quot;single bole tree&quot; &quot;single bole tree&quot; ...
##  $ stemDiameter        : num [1:14961] 17.1 13.7 12.3 12.1 29.2 12.1 23.4 39.5 10 10.6 ...
##  $ measurementHeight   : num [1:14961] 130 130 130 130 130 130 130 130 130 130 ...
##  $ height              : num [1:14961] 15.2 9.8 7.7 15.2 16.7 10.6 18.4 19 5.7 8.7 ...
##  $ uid_map             : chr [1:14961] &quot;31c5ffdb-25cb-474c-b34b-c88ddf520dc2&quot; &quot;a59c6688-ef88-46bb-979d-ba23b6e84d1a&quot; &quot;64a921b6-ce50-442e-8811-40e6c086c99e&quot; &quot;f6cba56b-b14f-42e0-ab20-06e2bfa216d2&quot; ...
##  $ pointID             : num [1:14961] 61 41 23 57 57 23 57 41 57 57 ...
##  $ stemDistance        : num [1:14961] 11.3 6.1 12 11.5 19 7 7.4 6.4 12.7 15.1 ...
##  $ stemAzimuth         : num [1:14961] 212.1 4 62.1 140.8 93 ...
##  $ taxonID             : chr [1:14961] &quot;ACRU&quot; &quot;FAGR&quot; &quot;TSCA&quot; &quot;FAGR&quot; ...
##  $ scientificName      : chr [1:14961] &quot;Acer rubrum L.&quot; &quot;Fagus grandifolia Ehrh.&quot; &quot;Tsuga canadensis (L.) Carri√®re&quot; &quot;Fagus grandifolia Ehrh.&quot; ...
##  $ taxonRank           : chr [1:14961] &quot;species&quot; &quot;species&quot; &quot;species&quot; &quot;species&quot; ...
##  $ uid_ppl             : chr [1:14961] &quot;5ac133b6-1089-4f32-9c26-27c3fd6b2597&quot; &quot;5ac133b6-1089-4f32-9c26-27c3fd6b2597&quot; &quot;c4207c9a-028a-4a26-a4ee-5d1a70df1e66&quot; &quot;c4207c9a-028a-4a26-a4ee-5d1a70df1e66&quot; ...
##  $ plotType            : chr [1:14961] &quot;tower&quot; &quot;tower&quot; &quot;tower&quot; &quot;tower&quot; ...
##  $ nlcdClass           : chr [1:14961] &quot;deciduousForest&quot; &quot;deciduousForest&quot; &quot;deciduousForest&quot; &quot;deciduousForest&quot; ...
##  $ decimalLatitude     : num [1:14961] 44.1 44.1 44.1 44.1 44.1 ...
##  $ decimalLongitude    : num [1:14961] -71.3 -71.3 -71.3 -71.3 -71.3 ...
##  $ geodeticDatum       : chr [1:14961] &quot;WGS84&quot; &quot;WGS84&quot; &quot;WGS84&quot; &quot;WGS84&quot; ...
##  $ easting             : num [1:14961] 317130 317130 317042 317042 317042 ...
##  $ northing            : num [1:14961] 4881249 4881249 4881189 4881189 4881189 ...
##  $ utmZone             : chr [1:14961] &quot;19N&quot; &quot;19N&quot; &quot;19N&quot; &quot;19N&quot; ...
##  $ elevation           : num [1:14961] 292 292 303 303 303 ...
##  $ elevationUncertainty: num [1:14961] 0.2 0.2 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 ...
##  $ stemLat             : num [1:14961] 44.1 44.1 44.1 44.1 44.1 ...
##  $ stemLon             : num [1:14961] -71.3 -71.3 -71.3 -71.3 -71.3 ...</code></pre>
<p>And save our file.</p>
</div>
</div>
<div id="saving-analytical-data" class="section level2">
<h2>Saving analytical data</h2>
<p>At the bottom of <code>individual.R</code> there is some template code, <code>usethis::use_data(&quot;individual&quot;)</code>.</p>
<p>This functions invokes functionality to store an r object as an <code>.Rdata</code> object (ie as a tibble not a <code>csv</code>) in the <code>data</code> directory. This is the standard way to store exported data in packages but does not apply to our non-package project so won‚Äôt work.</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb394-1" data-line-number="1">usethis<span class="op">::</span><span class="kw">use_data</span>(<span class="st">&quot;individual&quot;</span>)</a></code></pre></div>
<pre><code>## ‚úî Setting active project to &#39;/Users/Anna/Documents/workflows/workshops/books/rrresearchACCE20&#39;</code></pre>
<pre><code>## Error: `use_data()` is designed to work with packages.
## Project &#39;rrresearchACCE20&#39; is not an R package.</code></pre>
<p>Let‚Äôs just get rid of it and instead, save our analytic data as a csv in our <code>data</code> directory.</p>
<p>Frist lets create a data directory (you can do this in the console)</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb397-1" data-line-number="1">fs<span class="op">::</span><span class="kw">dir_create</span>(<span class="st">&quot;data&quot;</span>)</a></code></pre></div>
<p>Now were ready to write or data out. Before we do so, I will add one last touch. Before I do so, I would like to get rid of a pet hate of mine, and thats camelCase variable names!</p>
<p>I use a handy function in package <code>janitor</code>, !</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb398-1" data-line-number="1">individual <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb398-2" data-line-number="2"><span class="st">    </span>janitor<span class="op">::</span><span class="kw">clean_names</span>()</a></code></pre></div>
<pre><code>## # A tibble: 14,961 x 32
##    uid   named_location date       event_id domain_id site_id plot_id
##    &lt;chr&gt; &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;    &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;  
##  1 a36a‚Ä¶ BART_037.base‚Ä¶ 2015-08-26 vst_BAR‚Ä¶ D01       BART    BART_0‚Ä¶
##  2 68dc‚Ä¶ BART_037.base‚Ä¶ 2015-08-26 vst_BAR‚Ä¶ D01       BART    BART_0‚Ä¶
##  3 a895‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BAR‚Ä¶ D01       BART    BART_0‚Ä¶
##  4 eb34‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BAR‚Ä¶ D01       BART    BART_0‚Ä¶
##  5 2a44‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BAR‚Ä¶ D01       BART    BART_0‚Ä¶
##  6 e485‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BAR‚Ä¶ D01       BART    BART_0‚Ä¶
##  7 280c‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BAR‚Ä¶ D01       BART    BART_0‚Ä¶
##  8 0e50‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BAR‚Ä¶ D01       BART    BART_0‚Ä¶
##  9 4918‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BAR‚Ä¶ D01       BART    BART_0‚Ä¶
## 10 ef16‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BAR‚Ä¶ D01       BART    BART_0‚Ä¶
## # ‚Ä¶ with 14,951 more rows, and 25 more variables: individual_id &lt;chr&gt;,
## #   growth_form &lt;chr&gt;, stem_diameter &lt;dbl&gt;, measurement_height &lt;dbl&gt;,
## #   height &lt;dbl&gt;, uid_map &lt;chr&gt;, point_id &lt;dbl&gt;, stem_distance &lt;dbl&gt;,
## #   stem_azimuth &lt;dbl&gt;, taxon_id &lt;chr&gt;, scientific_name &lt;chr&gt;,
## #   taxon_rank &lt;chr&gt;, uid_ppl &lt;chr&gt;, plot_type &lt;chr&gt;, nlcd_class &lt;chr&gt;,
## #   decimal_latitude &lt;dbl&gt;, decimal_longitude &lt;dbl&gt;, geodetic_datum &lt;chr&gt;,
## #   easting &lt;dbl&gt;, northing &lt;dbl&gt;, utm_zone &lt;chr&gt;, elevation &lt;dbl&gt;,
## #   elevation_uncertainty &lt;dbl&gt;, stem_lat &lt;dbl&gt;, stem_lon &lt;dbl&gt;</code></pre>
<p>This turns all the column names to my beloved snake case!</p>
<p>Now, with that final tweek, we are ready to save our data.</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb400-1" data-line-number="1">individual <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb400-2" data-line-number="2"><span class="st">    </span>janitor<span class="op">::</span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb400-3" data-line-number="3"><span class="st">    </span>readr<span class="op">::</span><span class="kw">write_csv</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;individual.csv&quot;</span>))</a></code></pre></div>
</div>
<div id="final-processing-script" class="section level2">
<h2>Final processing script:</h2>
<p><strong><code>data-raw/individual.R</code></strong></p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb401-1" data-line-number="1"><span class="co">## code to prepare `individual` dataset goes here</span></a>
<a class="sourceLine" id="cb401-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb401-3" data-line-number="3"><span class="kw">source</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;geolocate.R&quot;</span>))</a>
<a class="sourceLine" id="cb401-4" data-line-number="4"></a>
<a class="sourceLine" id="cb401-5" data-line-number="5"><span class="co"># Read in and compile all individual data</span></a>
<a class="sourceLine" id="cb401-6" data-line-number="6">raw_data_path &lt;-<span class="st"> </span>here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;wood-survey-data-master&quot;</span>)</a>
<a class="sourceLine" id="cb401-7" data-line-number="7">individual_path &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">path</span>(raw_data_path, <span class="st">&quot;individual&quot;</span>)</a>
<a class="sourceLine" id="cb401-8" data-line-number="8">individual_paths &lt;-<span class="st"> </span>fs<span class="op">::</span><span class="kw">dir_ls</span>(individual_path)</a>
<a class="sourceLine" id="cb401-9" data-line-number="9"></a>
<a class="sourceLine" id="cb401-10" data-line-number="10"><span class="co"># read in all tables into one</span></a>
<a class="sourceLine" id="cb401-11" data-line-number="11">individual &lt;-<span class="st"> </span>purrr<span class="op">::</span><span class="kw">map_df</span>(individual_paths,</a>
<a class="sourceLine" id="cb401-12" data-line-number="12">              <span class="op">~</span>readr<span class="op">::</span><span class="kw">read_csv</span>(<span class="dt">file =</span> .x,</a>
<a class="sourceLine" id="cb401-13" data-line-number="13">                               <span class="dt">col_types =</span> readr<span class="op">::</span><span class="kw">cols</span>(<span class="dt">.default =</span> <span class="st">&quot;c&quot;</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-14" data-line-number="14"><span class="st">  </span>readr<span class="op">::</span><span class="kw">type_convert</span>()</a>
<a class="sourceLine" id="cb401-15" data-line-number="15"></a>
<a class="sourceLine" id="cb401-16" data-line-number="16">individual <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-17" data-line-number="17"><span class="st">  </span>readr<span class="op">::</span><span class="kw">write_csv</span>(<span class="dt">path =</span> fs<span class="op">::</span><span class="kw">path</span>(raw_data_path, <span class="st">&quot;vst_individuals.csv&quot;</span>))</a>
<a class="sourceLine" id="cb401-18" data-line-number="18"></a>
<a class="sourceLine" id="cb401-19" data-line-number="19"></a>
<a class="sourceLine" id="cb401-20" data-line-number="20"></a>
<a class="sourceLine" id="cb401-21" data-line-number="21"><span class="co"># Combine NEON data tables</span></a>
<a class="sourceLine" id="cb401-22" data-line-number="22"><span class="co"># read in additonal table</span></a>
<a class="sourceLine" id="cb401-23" data-line-number="23">maptag &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(fs<span class="op">::</span><span class="kw">path</span>(raw_data_path, </a>
<a class="sourceLine" id="cb401-24" data-line-number="24">                                   <span class="st">&quot;vst_mappingandtagging.csv&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-25" data-line-number="25"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>eventID)</a>
<a class="sourceLine" id="cb401-26" data-line-number="26"></a>
<a class="sourceLine" id="cb401-27" data-line-number="27">perplot &lt;-<span class="st"> </span>readr<span class="op">::</span><span class="kw">read_csv</span>(fs<span class="op">::</span><span class="kw">path</span>(raw_data_path, </a>
<a class="sourceLine" id="cb401-28" data-line-number="28">                                    <span class="st">&quot;vst_perplotperyear.csv&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-29" data-line-number="29"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>eventID)</a>
<a class="sourceLine" id="cb401-30" data-line-number="30"></a>
<a class="sourceLine" id="cb401-31" data-line-number="31"></a>
<a class="sourceLine" id="cb401-32" data-line-number="32">individual <span class="op">%&lt;&gt;%</span></a>
<a class="sourceLine" id="cb401-33" data-line-number="33"><span class="st">  </span><span class="kw">left_join</span>(maptag, <span class="dt">by =</span> <span class="st">&quot;individualID&quot;</span>,</a>
<a class="sourceLine" id="cb401-34" data-line-number="34">            <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_map&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-35" data-line-number="35"><span class="st">  </span><span class="kw">left_join</span>(perplot, <span class="dt">by =</span> <span class="st">&quot;plotID&quot;</span>,</a>
<a class="sourceLine" id="cb401-36" data-line-number="36">            <span class="dt">suffix =</span> <span class="kw">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_ppl&quot;</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-37" data-line-number="37"><span class="st">  </span>assertr<span class="op">::</span><span class="kw">assert</span>(assertr<span class="op">::</span>not_na, stemDistance, stemAzimuth, pointID,</a>
<a class="sourceLine" id="cb401-38" data-line-number="38">                  decimalLongitude, decimalLatitude, plotID)</a>
<a class="sourceLine" id="cb401-39" data-line-number="39"></a>
<a class="sourceLine" id="cb401-40" data-line-number="40"><span class="co"># ---- Geolocate individuals_functions ----</span></a>
<a class="sourceLine" id="cb401-41" data-line-number="41">individual &lt;-<span class="st"> </span>individual <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-42" data-line-number="42"><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">stemLat =</span> <span class="kw">get_stem_location</span>(<span class="dt">decimalLongitude =</span> decimalLongitude,</a>
<a class="sourceLine" id="cb401-43" data-line-number="43">                                            <span class="dt">decimalLatitude =</span> decimalLatitude,</a>
<a class="sourceLine" id="cb401-44" data-line-number="44">                                            <span class="dt">stemAzimuth =</span> stemAzimuth,</a>
<a class="sourceLine" id="cb401-45" data-line-number="45">                                            <span class="dt">stemDistance =</span> stemDistance)<span class="op">$</span>lat,</a>
<a class="sourceLine" id="cb401-46" data-line-number="46">                <span class="dt">stemLon =</span> <span class="kw">get_stem_location</span>(<span class="dt">decimalLongitude =</span> decimalLongitude,</a>
<a class="sourceLine" id="cb401-47" data-line-number="47">                                            <span class="dt">decimalLatitude =</span> decimalLatitude,</a>
<a class="sourceLine" id="cb401-48" data-line-number="48">                                            <span class="dt">stemAzimuth =</span> stemAzimuth,</a>
<a class="sourceLine" id="cb401-49" data-line-number="49">                                            <span class="dt">stemDistance =</span> stemDistance)<span class="op">$</span>lon) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb401-50" data-line-number="50"><span class="st">  </span>janitor<span class="op">::</span><span class="kw">clean_names</span>()</a>
<a class="sourceLine" id="cb401-51" data-line-number="51"></a>
<a class="sourceLine" id="cb401-52" data-line-number="52"></a>
<a class="sourceLine" id="cb401-53" data-line-number="53"><span class="co"># write out analytic file</span></a>
<a class="sourceLine" id="cb401-54" data-line-number="54">readr<span class="op">::</span><span class="kw">write_csv</span>(individual, here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;individual.csv&quot;</span>))</a></code></pre></div>
</div>
<div id="final-function" class="section level2">
<h2>Final function</h2>
<p><strong><code>R/geolocate.R</code></strong></p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb402-1" data-line-number="1"><span class="co"># Function</span></a>
<a class="sourceLine" id="cb402-2" data-line-number="2">get_stem_location &lt;-<span class="st"> </span><span class="cf">function</span>(decimalLongitude, decimalLatitude,</a>
<a class="sourceLine" id="cb402-3" data-line-number="3">                              stemAzimuth, stemDistance) {</a>
<a class="sourceLine" id="cb402-4" data-line-number="4">  <span class="co"># check inputs are correct type (numeric)</span></a>
<a class="sourceLine" id="cb402-5" data-line-number="5">  checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(decimalLatitude)</a>
<a class="sourceLine" id="cb402-6" data-line-number="6">  checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(decimalLongitude)</a>
<a class="sourceLine" id="cb402-7" data-line-number="7">  checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(stemAzimuth)</a>
<a class="sourceLine" id="cb402-8" data-line-number="8">  checkmate<span class="op">::</span><span class="kw">assert_numeric</span>(stemDistance)</a>
<a class="sourceLine" id="cb402-9" data-line-number="9">  </a>
<a class="sourceLine" id="cb402-10" data-line-number="10">  </a>
<a class="sourceLine" id="cb402-11" data-line-number="11">  out &lt;-<span class="st"> </span>geosphere<span class="op">::</span><span class="kw">destPoint</span>(<span class="dt">p =</span> <span class="kw">cbind</span>(decimalLongitude, decimalLatitude),</a>
<a class="sourceLine" id="cb402-12" data-line-number="12">                       <span class="dt">b =</span> stemAzimuth, <span class="dt">d =</span> stemDistance) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb402-13" data-line-number="13"><span class="st">    </span>tibble<span class="op">::</span><span class="kw">as_tibble</span>()</a>
<a class="sourceLine" id="cb402-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb402-15" data-line-number="15">  <span class="co"># check output for NAs</span></a>
<a class="sourceLine" id="cb402-16" data-line-number="16">  checkmate<span class="op">::</span><span class="kw">assert_false</span>(<span class="kw">any</span>(<span class="kw">is.na</span>(out)))</a>
<a class="sourceLine" id="cb402-17" data-line-number="17">  </a>
<a class="sourceLine" id="cb402-18" data-line-number="18">  <span class="kw">return</span>(out)</a>
<a class="sourceLine" id="cb402-19" data-line-number="19">  }</a></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="combining-tables.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="metadata.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["rrresearchACCE20.pdf", "rrresearchACCE20.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
