<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Managing Dependencies | Reproducible Research Data and Project Management in R</title>
  <meta name="description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Managing Dependencies | Reproducible Research Data and Project Management in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://annakrystalli.me/rrresearchACCE20" />
  
  <meta property="og:description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  <meta name="github-repo" content="annakrystalli/rrresearchACCE20" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Managing Dependencies | Reproducible Research Data and Project Management in R" />
  
  <meta name="twitter:description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  

<meta name="author" content="Course Instructor: Dr Anna Krystalli" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="additional.html"/>
<link rel="next" href="packaging-functionality.html"/>
<script src="libs/header-attrs-2.8/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/jsoneditor-5.25.6/jsoneditor.min.css" rel="stylesheet" />
<script src="libs/jsoneditor-5.25.6/jsoneditor.min.js"></script>
<script src="libs/jsonedit-binding-3.0.0/jsonedit.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Reproducible Research Data & Project Management in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course description</a></li>
<li class="chapter" data-level="" data-path="welcome-slides.html"><a href="welcome-slides.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Basics</b></span></li>
<li class="chapter" data-level="" data-path="rstudio-basics.html"><a href="rstudio-basics.html"><i class="fa fa-check"></i>Intro to R &amp; Rstudio</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i>R Basics</a></li>
<li class="chapter" data-level="" data-path="data-types-structures-and-classes.html"><a href="data-types-structures-and-classes.html"><i class="fa fa-check"></i>Data types, structures and classes</a></li>
<li class="chapter" data-level="" data-path="indexing-and-subsetting.html"><a href="indexing-and-subsetting.html"><i class="fa fa-check"></i>Indexing and subsetting</a></li>
<li class="chapter" data-level="" data-path="the-tidyverse-way.html"><a href="the-tidyverse-way.html"><i class="fa fa-check"></i>The tidyverse way</a></li>
<li class="chapter" data-level="" data-path="rdm-intro-view.html"><a href="rdm-intro-view.html"><i class="fa fa-check"></i>Data management Basics</a></li>
<li class="part"><span><b>II Project Management</b></span></li>
<li class="chapter" data-level="" data-path="projects-in-rstudio.html"><a href="projects-in-rstudio.html"><i class="fa fa-check"></i>Projects in Rstudio</a></li>
<li class="chapter" data-level="" data-path="filenaming-view.html"><a href="filenaming-view.html"><i class="fa fa-check"></i>Good File Naming</a></li>
<li class="chapter" data-level="" data-path="path-proj-str.html"><a href="path-proj-str.html"><i class="fa fa-check"></i>Paths and Project structure</a></li>
<li class="part"><span><b>III Data Munging</b></span></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i>Iteration</a></li>
<li class="chapter" data-level="" data-path="data-merge.html"><a href="data-merge.html"><i class="fa fa-check"></i>Merging data</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i>Functions</a></li>
<li class="part"><span><b>IV Working with metadata</b></span></li>
<li class="chapter" data-level="" data-path="metadata-slides.html"><a href="metadata-slides.html"><i class="fa fa-check"></i>Metadata</a></li>
<li><a href="dataspice.html#dataspice">Creating metadata with <code>dataspice</code></a></li>
<li class="part"><span><b>V Analysing and presenting analyses</b></span></li>
<li class="chapter" data-level="" data-path="plotting-with-ggplot2.html"><a href="plotting-with-ggplot2.html"><i class="fa fa-check"></i>Plotting with ggplot2</a></li>
<li class="chapter" data-level="" data-path="literate-programming-in-rmarkdown.html"><a href="literate-programming-in-rmarkdown.html"><i class="fa fa-check"></i>Literate Programming in rmarkdown</a></li>
<li class="part"><span><b>VI Version Control</b></span></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html"><i class="fa fa-check"></i>Version Control with Git</a></li>
<li class="chapter" data-level="" data-path="collaborative-github.html"><a href="collaborative-github.html"><i class="fa fa-check"></i>Collaborative GitHub</a></li>
<li><a href="practical-github-rstudio-for-collaborative-coding.html#practical-github-rstudio-for-collaborative-coding">Practical: <code>GitHub</code> &amp; <code>Rstudio</code> for collaborative coding</a></li>
<li class="part"><span><b>VII Packaging Research Projects</b></span></li>
<li class="chapter" data-level="" data-path="managing-dependencies.html"><a href="managing-dependencies.html"><i class="fa fa-check"></i>Managing Dependencies</a></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html"><i class="fa fa-check"></i>Packaging functionality</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html"><i class="fa fa-check"></i>Creating a research compendium with rrtools</a></li>
<li class="part"><span><b>VIII Closing</b></span></li>
<li class="chapter" data-level="" data-path="closing-remarks.html"><a href="closing-remarks.html"><i class="fa fa-check"></i>Closing Remarks</a></li>
<li class="part"><span><b>IX APPENDIX</b></span></li>
<li><a href="individual-r.html#individual.r"><code>individual.R</code></a></li>
<li><a href="geolocate-r.html#geolocate.r"><code>geolocate.R</code></a></li>
<li><a href="analysis-r-1.html#analysis.r-1"><code>analysis.R</code></a></li>
<li><a href="index-rmd.html#index.rmd"><code>index.Rmd</code></a></li>
<li><a href="gitignore.html#gitignore"><code>.gitignore</code></a></li>
<li><a href="mypackage-hello-r.html#mypackage-hello.r"><code>mypackage</code> <code>hello.R</code></a></li>
<li><a href="mypackage-readme-rmd.html#mypackage-readme.rmd"><code>mypackage</code> <code>README.Rmd</code></a></li>
<li><a href="mypackage-description.html#mypackage-description"><code>mypackage</code> <code>DESCRIPTION</code></a></li>
<li><a href="rrcompendium-description.html#rrcompendium-description"><code>rrcompendium</code> <code>DESCRIPTION</code></a></li>
<li><a href="rrcompendium-readme-rmd.html#rrcompendium-readme.rmd"><code>rrcompendium</code> <code>README.Rmd</code></a></li>
<li><a href="rrcompendium-paper-rmd-yaml-header.html#rrcompendium-paper.rmd-yaml-header"><code>rrcompendium</code> <code>paper.Rmd</code> YAML header</a></li>
<li><a href="rrcompendium-paper-rmd.html#rrcompendium-paper.rmd"><code>rrcompendium</code> <code>paper.Rmd</code></a></li>
<li class="chapter" data-level="" data-path="about.html"><a href="about.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i>Software Setup</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i>Solutions</a></li>
<li class="divider"></li>
<li><a href="https://annakrystalli.me/rrreasearchACCE2020" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Research Data and Project Management in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="managing-dependencies" class="section level1">
<h1>Managing Dependencies</h1>
<blockquote>
<p>One of the most important aspects of reproducible research is managing dependencies.</p>
</blockquote>
<p>For your analysis to run, it interacts with:</p>
<ul>
<li><p><strong>Operating system:</strong> The operating system of your computer.</p></li>
<li><p><strong>System configurations</strong>: such as locations of libraries and the search path your computer uses to find files and libraries</p></li>
<li><p><strong>System Level libraries</strong>. These are non-R libraries that R or packages in R you might be using depend on. (for example libraries such as <code>GEOS</code>, <code>GDAL</code> and <code>PROJ4</code> that geospatial R packages like <code>sf</code> and <code>rgeos</code> depend on). Such external dependencies to R are listed as <code>System Requirements</code> in R package <code>DESCRIPTION</code> files (e.g have a look at the <a href="https://github.com/r-spatial/sf/blob/adf7410a5c55695b4c8db97a5258ec87c931320a/DESCRIPTION#L110">relevant line</a> in the <code>sf</code> package <code>DESCRIPTION</code>.</p></li>
<li><p><strong>R and the R packages your analysis depends on</strong>. For example, the version of R we’ve been using as well as packages <code>ggplot2</code> and <code>dplyr</code>.</p></li>
</ul>
<p>When someone else tries to reproduce your analysis on a different computer, if any of these elements differ from what existed on your own system when you last ran your analysis, e.g some of the dependencies are missing, different versions are available or code behaves differently on a different operating system, they may not be able to reproduce your work.</p>
<div id="managing-r-dependencies." class="section level2">
<h2>Managing R dependencies.</h2>
<p>Your first consideration should be to ensure you retain information and ideally a way of automatically installing any R package dependencies your code depends on.</p>
<p>As there is no way to automatically install external system dependencies, you should highlight any such dependencies in your README and ideally provide installation instructions (or links to them). Have a look at the <a href="https://r-spatial.github.io/sf/#installing">installation section</a> of the documentation for package <code>sf</code>.</p>
<iframe src="https://r-spatial.github.io/sf/#installing" width="672" height="400px">
</iframe>
<div id="minimal-approach" class="section level3">
<h3>Minimal approach</h3>
<div id="including-session-information" class="section level4">
<h4>Including Session Information</h4>
<p>At the very minimum you could list the packages used in an analysis using <code>sessionInfo()</code> at the bottom of an <code>.Rmd</code> file. This however is not so useful for <code>.R</code> scripts (unless you save the output of the function to a separate file). It also doesn’t provide executable code for someone else to install the requirements.</p>
</div>
<div id="including-an-install.r-script" class="section level4">
<h4>Including an <code>install.R</code> script</h4>
<p>A more convenient but still not very robust method of managing R dependencies would be to include an executable <code>install.R</code> script (like the one I’ve included for setting up the projects in this course on your local machine) which contains the commands to install all the required dependencies.</p>
<p>Here’s the example of <code>install.R</code> used to set up the <code>wood-survey</code> project</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb579-1"><a href="managing-dependencies.html#cb579-1" aria-hidden="true" tabindex="-1"></a>dependencies <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;assertr&quot;</span>, <span class="st">&quot;checkmate&quot;</span>, <span class="st">&quot;cowsay&quot;</span>, <span class="st">&quot;data.table&quot;</span>, </span>
<span id="cb579-2"><a href="managing-dependencies.html#cb579-2" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;dataspice&quot;</span>, <span class="st">&quot;devtools&quot;</span>, <span class="st">&quot;DT&quot;</span>, <span class="st">&quot;fs&quot;</span>, <span class="st">&quot;gapminder&quot;</span>, <span class="st">&quot;geosphere&quot;</span>, </span>
<span id="cb579-3"><a href="managing-dependencies.html#cb579-3" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;ggthemes&quot;</span>, <span class="st">&quot;gitcreds&quot;</span>, <span class="st">&quot;glue&quot;</span>, <span class="st">&quot;here&quot;</span>, <span class="st">&quot;janitor&quot;</span>, <span class="st">&quot;jsonlite&quot;</span>, </span>
<span id="cb579-4"><a href="managing-dependencies.html#cb579-4" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;knitr&quot;</span>, <span class="st">&quot;leaflet&quot;</span>, <span class="st">&quot;listviewer&quot;</span>, <span class="st">&quot;magrittr&quot;</span>, <span class="st">&quot;plotly&quot;</span>, <span class="st">&quot;raster&quot;</span>, </span>
<span id="cb579-5"><a href="managing-dependencies.html#cb579-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;reprex&quot;</span>, <span class="st">&quot;rmarkdown&quot;</span>, <span class="st">&quot;sf&quot;</span>, <span class="st">&quot;skimr&quot;</span>, <span class="st">&quot;sloop&quot;</span>, </span>
<span id="cb579-6"><a href="managing-dependencies.html#cb579-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;spData&quot;</span>, <span class="st">&quot;stringr&quot;</span>, <span class="st">&quot;testthat&quot;</span>, <span class="st">&quot;tidyr&quot;</span>, <span class="st">&quot;tidyverse&quot;</span>, <span class="st">&quot;tmap&quot;</span>, </span>
<span id="cb579-7"><a href="managing-dependencies.html#cb579-7" aria-hidden="true" tabindex="-1"></a>                  <span class="st">&quot;usethis&quot;</span>, <span class="st">&quot;vroom&quot;</span>)</span>
<span id="cb579-8"><a href="managing-dependencies.html#cb579-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb579-9"><a href="managing-dependencies.html#cb579-9" aria-hidden="true" tabindex="-1"></a><span class="co"># install CRAN dependencies</span></span>
<span id="cb579-10"><a href="managing-dependencies.html#cb579-10" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(dependencies)</span>
<span id="cb579-11"><a href="managing-dependencies.html#cb579-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb579-12"><a href="managing-dependencies.html#cb579-12" aria-hidden="true" tabindex="-1"></a><span class="co"># install github dependencies</span></span>
<span id="cb579-13"><a href="managing-dependencies.html#cb579-13" aria-hidden="true" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;hadley/emo&quot;</span>)</span></code></pre></div>
<p>The problem with this is that the versions of packages are nnot fixed. Instead, each time the script is run, the most up to date versions of packages are installed, and R also prompts you to update any packages already installed. Changes in packages annd a general mismatch of versions compared to those used to develop the original code, could cause problems in code execution.</p>
<p>In the case of this book, I want the materials to work with up to date versions of packages. If there are problems with newer versions, I can correct the materials before I run the course. However, for a published analysis, using code you don’t plan to further develop (and therefore do not require that it tracks the evolution of packages in the R ecosystem), it would be better to be able to pin exact versions of packages. That way you can ensure another user will be working with the exact same versions of your dependencies.</p>
</div>
</div>
<div id="robust-approach" class="section level3">
<h3>Robust approach</h3>
<div id="managing-r-dependencies-with-renv" class="section level4">
<h4>Managing R dependencies with <code>renv</code></h4>
<p>The <code>renv</code> package is a new effort to bring project-local R dependency
management to your projects.</p>
<p>Underlying the philosophy of <code>renv</code> is that any of your existing workflows
should just work as they did before – <code>renv</code> helps manage library paths (and
other project-specific state) to help isolate your project’s R dependencies.</p>
<div id="renv-workflow" class="section level5">
<h5><code>renv</code> Workflow</h5>
<p>The general workflow when working with <code>renv</code> is:</p>
<ol style="list-style-type: decimal">
<li><p>Call <code>renv::init()</code> to initialize a new project-local environment with a
<strong>private R library</strong>,</p></li>
<li><p>Work in the project as normal, installing and removing new R packages as
they are needed in the project,</p></li>
<li><p>Call <code>renv::snapshot()</code> to save the state of the project library to the
lockfile (called <code>renv.lock</code>),</p></li>
<li><p>Continue working on your project, installing and updating R packages as
needed.</p></li>
<li><p>Call <code>renv::snapshot()</code> again to save the state of your project library if
your attempts to update R packages were successful, or call <code>renv::restore()</code>
to revert to the previous state as encoded in the lockfile if your attempts
to update packages introduced some new problems.</p></li>
</ol>
<p>The <code>renv::init()</code> function attempts to ensure the newly-created project
library includes all R packages currently used by the project. It does this
by crawling R files within the project for dependencies with the
<code>renv::dependencies()</code> function. The discovered packages are then installed
into the project library with the <code>renv::hydrate()</code> function, which will also
attempt to save time by copying packages from your user library (rather than
re-installing from CRAN) as appropriate.</p>
<p>Calling <code>renv::init()</code> will also write out the infrastructure necessary to
automatically load and use the private library for new R sessions launched
from the project root directory. This is accomplished by creating (or amending)
a project-local <code>.Rprofile</code> with the necessary code to load the project when
the R session is started.</p>
<p>The following files are written to and used by projects using <code>renv</code>:</p>
<table>
<colgroup>
<col width="17%" />
<col width="83%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>File</strong></th>
<th><strong>Usage</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>.Rprofile</code></td>
<td>Used to activate <code>renv</code> for new R sessions launched in the project.</td>
</tr>
<tr class="even">
<td><code>renv.lock</code></td>
<td>The lockfile, describing the state of your project’s library at some point in time.</td>
</tr>
<tr class="odd">
<td><code>renv/activate.R</code></td>
<td>The activation script run by the project <code>.Rprofile</code>.</td>
</tr>
<tr class="even">
<td><code>renv/library</code></td>
<td>The private project library.</td>
</tr>
</tbody>
</table>
</div>
<div id="reproducibility-with-renv" class="section level5">
<h5>Reproducibility with <code>renv</code></h5>
<p>Using <code>renv</code>, it’s possible to “save” and “load” the state of your project
library. More specifically, you can use:</p>
<ul>
<li><p><code>renv::snapshot()</code> to save the state of your project to <code>renv.lock</code>; and</p></li>
<li><p><code>renv::restore()</code> to restore the state of your project from <code>renv.lock</code>.</p></li>
</ul>
<p>For each package used in your project, <code>renv</code> will record the package version,
and (if known) the external source from which that package can be retrieved.
<code>renv::restore()</code> uses that information to retrieve and re-install those
packages in your project.</p>
</div>
</div>
<div id="using-renv-in-our-wood-survey-project" class="section level4">
<h4>Using <code>renv</code> in our <code>wood-survey</code> project</h4>
<p>Let’s go back into our <code>wood-survey</code> project and capture our dependencies into a project level R package library. We do this by first initialising <code>renv</code></p>
<div class="sourceCode" id="cb580"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb580-1"><a href="managing-dependencies.html#cb580-1" aria-hidden="true" tabindex="-1"></a>renv<span class="sc">::</span><span class="fu">init</span>()</span></code></pre></div>
<pre><code>* Initializing project ...
* Discovering package dependencies ... Done!
* Copying packages into the cache ... [99/99] Done!
The following package(s) will be updated in the lockfile:

# CRAN ===============================
- MASS            [* -&gt; 7.3-53]
- Matrix          [* -&gt; 1.2-18]
- lattice         [* -&gt; 0.20-41]
- mgcv            [* -&gt; 1.8-33]
- nlme            [* -&gt; 3.1-149]

# RSPM ===============================
- BH              [* -&gt; 1.75.0-0]
- DT              [* -&gt; 0.18]
- EML             [* -&gt; 2.0.5]
- R6              [* -&gt; 2.5.0]
- RColorBrewer    [* -&gt; 1.1-2]
- Rcpp            [* -&gt; 1.0.6]
- V8              [* -&gt; 3.4.1]
- assertr         [* -&gt; 2.8]
- backports       [* -&gt; 1.2.1]
- base64enc       [* -&gt; 0.1-3]
- broom           [* -&gt; 0.7.6]
- bslib           [* -&gt; 0.2.4]
- cachem          [* -&gt; 1.0.4]
- checkmate       [* -&gt; 2.0.0]
- cli             [* -&gt; 2.5.0]
- clipr           [* -&gt; 0.7.1]
- colorspace      [* -&gt; 2.0-0]
- commonmark      [* -&gt; 1.7]
- cpp11           [* -&gt; 0.2.7]
- crayon          [* -&gt; 1.4.1]
- crosstalk       [* -&gt; 1.1.1]
- curl            [* -&gt; 4.3]
- dataspice       [* -&gt; 1.0.0]
- digest          [* -&gt; 0.6.27]
- dplyr           [* -&gt; 1.0.5]
- ellipsis        [* -&gt; 0.3.1]
- emld            [* -&gt; 0.5.1]
- evaluate        [* -&gt; 0.14]
- fansi           [* -&gt; 0.4.2]
- farver          [* -&gt; 2.1.0]
- fastmap         [* -&gt; 1.1.0]
- fs              [* -&gt; 1.5.0]
- generics        [* -&gt; 0.1.0]
- geosphere       [* -&gt; 1.5-10]
- ggplot2         [* -&gt; 3.3.3]
- glue            [* -&gt; 1.4.2]
- gtable          [* -&gt; 0.3.0]
- here            [* -&gt; 1.0.1]
- highr           [* -&gt; 0.9]
- hms             [* -&gt; 1.0.0]
- htmltools       [* -&gt; 0.5.1.1]
- htmlwidgets     [* -&gt; 1.5.3]
- httpuv          [* -&gt; 1.6.0]
- isoband         [* -&gt; 0.2.4]
- janitor         [* -&gt; 2.1.0]
- jqr             [* -&gt; 1.2.0]
- jquerylib       [* -&gt; 0.1.4]
- jsonld          [* -&gt; 2.2]
- jsonlite        [* -&gt; 1.7.2]
- knitr           [* -&gt; 1.33]
- labeling        [* -&gt; 0.4.2]
- later           [* -&gt; 1.2.0]
- lazyeval        [* -&gt; 0.2.2]
- lifecycle       [* -&gt; 1.0.0]
- listviewer      [* -&gt; 3.0.0]
- lubridate       [* -&gt; 1.7.10]
- magrittr        [* -&gt; 2.0.1]
- markdown        [* -&gt; 1.1]
- mime            [* -&gt; 0.10]
- munsell         [* -&gt; 0.5.0]
- pillar          [* -&gt; 1.6.0]
- pkgconfig       [* -&gt; 2.0.3]
- promises        [* -&gt; 1.2.0.1]
- purrr           [* -&gt; 0.3.4]
- rappdirs        [* -&gt; 0.3.3]
- readr           [* -&gt; 1.4.0]
- renv            [* -&gt; 0.13.2]
- repr            [* -&gt; 1.1.3]
- rhandsontable   [* -&gt; 0.3.7]
- rlang           [* -&gt; 0.4.10]
- rmarkdown       [* -&gt; 2.7]
- rprojroot       [* -&gt; 2.0.2]
- sass            [* -&gt; 0.3.1]
- scales          [* -&gt; 1.1.1]
- shiny           [* -&gt; 1.6.0]
- skimr           [* -&gt; 2.1.3]
- snakecase       [* -&gt; 0.11.0]
- sourcetools     [* -&gt; 0.1.7]
- sp              [* -&gt; 1.4-5]
- stringi         [* -&gt; 1.5.3]
- stringr         [* -&gt; 1.4.0]
- tibble          [* -&gt; 3.1.1]
- tidyr           [* -&gt; 1.1.3]
- tidyselect      [* -&gt; 1.1.0]
- tinytex         [* -&gt; 0.31]
- utf8            [* -&gt; 1.2.1]
- uuid            [* -&gt; 0.1-4]
- vctrs           [* -&gt; 0.3.7]
- viridisLite     [* -&gt; 0.4.0]
- whisker         [* -&gt; 0.4]
- withr           [* -&gt; 2.4.2]
- xfun            [* -&gt; 0.22]
- xml2            [* -&gt; 1.3.2]
- xtable          [* -&gt; 1.8-4]
- yaml            [* -&gt; 2.2.1]

* Lockfile written to &#39;/cloud/project/renv.lock&#39;.

Restarting R session...

* Project &#39;/cloud/project&#39; loaded. [renv 0.13.2]</code></pre>
<p>Our project now also contains the infrastructure that powers <code>renv</code> dependency management:</p>
<pre><code>.
├── .Rprofile
├── renv
│   ├── .gitignore
│   ├── activate.R
│   ├── library
│   │   └── R-4.0
│   ├── local
│   └── settings.dcf
└── renv.lock</code></pre>
<p>The <code>renv.lock</code> contains a list of names and versions of packages used in our project.</p>
<p>The folder <code>renv/library/R-4.0</code> contains the project specific library of installed packages for the R version the analysis is currently being performed on. This is never committed to git (it is by default ignored). Rather, we commit the rest of the files (<code>renv.lock</code> file, the <code>.Rprofile</code> file and the <code>renv/activate.R</code>). Making these available means others users of your code will have the appropriate packages installed in their own local library when the download and use your code.</p>
<p><strong>So let’s commit all the files <code>renv::init()</code> created</strong></p>
<p>Finally, if you carry on working on your analysis and install new packages, call <code>renv::snapshot()</code> to save the state of the project library.</p>
</div>
</div>
</div>
<div id="advanced---capturing-computational-environments" class="section level2">
<h2>Advanced - Capturing computational environments</h2>
<p>What we’ve discussed above only relates to managing R package dependencies. As mentioned though, problems can also arise form differences in the wider computational environment (operating system, system libraries, system configurations, version of R).</p>
<p>More robust ways of capturing computational environments can be achieved through using technologies like <strong>Docker containers</strong> or services like <strong>Binder</strong>.</p>
<div id="docker" class="section level3">
<h3>Docker</h3>
<blockquote>
<h4 id="standardized-units-of-software-that-package-up-everything-needed-to-run-an-application-code-runtime-system-tools-system-libraries-and-settings-in-a-lightweight-standalone-executable-package">standardized units of software that <strong>package up everything needed to run an application:</strong> <em>code, runtime, system tools, system libraries</em> and settings in a lightweight, standalone, executable package</h4>
</blockquote>
<p>Docker containers allow a researcher to package up a project with all of the parts it needs - such as libraries, dependencies, and system settings - and ship it all out as one package.</p>
<p><img src="assets/docker_workflow.png" /><!-- --></p>
<ul>
<li><h4 id="dockerfile-text-file-containing-recipe-for-setting-up-computation-environment."><strong>Dockerfile</strong>: Text file containing recipe for setting up computation environment.</h4></li>
<li><h4 id="docker-image-executable-built-from-the-dockerfile-with-all-required-dependencies-installed.-can-have-many-images-from-the-same-dockerfile."><strong>Docker Image</strong>: Executable <strong>built</strong> from the <strong>Dockerfile</strong> with all required dependencies installed. Can have many images from the same <code>Dockerfile</code>.</h4></li>
<li><h4 id="docker-container-docker-images-become-containers-at-runtime"><strong>Docker Container</strong>: <strong>Docker Images</strong> become containers at <strong>runtime</strong></h4></li>
</ul>
<p>For a detailed discussion of the elements of a reproducible analysis and a more advanced example of how to use docker to capture them, have a look at the <a href="https://rr-mrc-bsu.github.io/reproducible-research/dependency-management.html">dependency chapter</a> in the <a href="https://rr-mrc-bsu.github.io/reproducible-research/">A Reproducible Research Compendium ebook</a> or the <a href="https://the-turing-way.netlify.app/reproducible-research/renv/renv-containers.html">Containers</a> chapter in the Turing Way. There’s also a paper on <a href="https://ieeexplore.ieee.org/document/7883438">Using Docker Containers to Improve Reproducibility in Software Engineering Research</a></p>
<div id="package-containerit" class="section level4">
<h4>package <code>containerit</code></h4>
<p>Also, check out package <code>containerit</code> which relies on Docker and automatically generates a container Dockerfile, or “recipe”, with setup instructions to recreate a runtime environment based on a given R session, R script, R Markdown file or workspace directory.</p>
<iframe src="https://o2r.info/containerit/articles/containerit.html" width="672" height="400px">
</iframe>
</div>
</div>
<div id="binder" class="section level3">
<h3>Binder</h3>
<p>The <a href="https://mybinder.org/">mybinder</a> service turn a Git repo into a collection of interactive notebooks or can even launch Rstudio in the cloud! Check out this <a href="https://www.youtube.com/watch?v=a5i42lSj-L4">video</a> to find out more about how it works.</p>
<div class="figure"><span id="fig:unnamed-chunk-407"></span>
<img src="assets/binder_comic.png" alt="**Fig. 23** Figure credit: [Juliette Taka, Logilab and the OpenDreamKit project](https://opendreamkit.org/2017/11/02/use-case-publishing-reproducible-notebooks/)"  />
<p class="caption">
Figure 2: <strong>Fig. 23</strong> Figure credit: <a href="https://opendreamkit.org/2017/11/02/use-case-publishing-reproducible-notebooks/">Juliette Taka, Logilab and the OpenDreamKit project</a>
</p>
</div>
<p>To learn more about binder and how to prepare projects to run on the service, have a look at the Turing Way <a href="https://the-turing-way.netlify.app/reproducible-research/renv/renv-binder.html">chapter on Binder</a> and the <a href="https://github.com/alan-turing-institute/the-turing-way/blob/master/workshops/boost-research-reproducibility-binder/workshop-presentations/zero-to-binder-r.md">From Zero to Binder in R!</a> tutorial.</p>
<p>ALso, check out package <a href="https://github.com/karthik/holepunch"><code>holepunch</code> on GitHub</a> for making your projects Binder ready.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="additional.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="packaging-functionality.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["rrresearchACCE20.pdf", "rrresearchACCE20.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
