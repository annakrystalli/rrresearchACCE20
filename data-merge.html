<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Merging data | Reproducible Research Data and Project Management in R</title>
  <meta name="description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Merging data | Reproducible Research Data and Project Management in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://annakrystalli.me/rrresearchACCE20" />
  
  <meta property="og:description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  <meta name="github-repo" content="https://github.com/annakrystalli/rrresearchACCE20" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Merging data | Reproducible Research Data and Project Management in R" />
  
  <meta name="twitter:description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  

<meta name="author" content="Course Instructor: Dr Anna Krystalli" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="iteration.html"/>
<link rel="next" href="functions.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/jsoneditor-5.25.6/jsoneditor.min.css" rel="stylesheet" />
<script src="libs/jsoneditor-5.25.6/jsoneditor.min.js"></script>
<script src="libs/jsonedit-binding-3.0.0/jsonedit.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Reproducible Research Data & Project Management in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course description</a></li>
<li class="chapter" data-level="" data-path="welcome-slides.html"><a href="welcome-slides.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Basics</b></span></li>
<li class="chapter" data-level="" data-path="rstudio-basics.html"><a href="rstudio-basics.html"><i class="fa fa-check"></i>Intro to R &amp; Rstudio</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i>R Basics</a></li>
<li class="chapter" data-level="" data-path="data-types-structures-and-classes.html"><a href="data-types-structures-and-classes.html"><i class="fa fa-check"></i>Data types, structures and classes</a></li>
<li class="chapter" data-level="" data-path="indexing-and-subsetting.html"><a href="indexing-and-subsetting.html"><i class="fa fa-check"></i>Indexing and subsetting</a></li>
<li class="chapter" data-level="" data-path="the-tidyverse-way.html"><a href="the-tidyverse-way.html"><i class="fa fa-check"></i>The tidyverse way</a></li>
<li class="chapter" data-level="" data-path="rdm-intro-view.html"><a href="rdm-intro-view.html"><i class="fa fa-check"></i>Data management Basics</a></li>
<li class="part"><span><b>II Project Management</b></span></li>
<li class="chapter" data-level="" data-path="projects-in-rstudio.html"><a href="projects-in-rstudio.html"><i class="fa fa-check"></i>Projects in Rstudio</a></li>
<li class="chapter" data-level="" data-path="filenaming-view.html"><a href="filenaming-view.html"><i class="fa fa-check"></i>Good File Naming</a></li>
<li class="chapter" data-level="" data-path="path-proj-str.html"><a href="path-proj-str.html"><i class="fa fa-check"></i>Paths and Project structure</a></li>
<li class="part"><span><b>III Data Munging</b></span></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i>Iteration</a></li>
<li class="chapter" data-level="" data-path="data-merge.html"><a href="data-merge.html"><i class="fa fa-check"></i>Merging data</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i>Functions</a></li>
<li class="part"><span><b>IV Working with metadata</b></span></li>
<li class="chapter" data-level="" data-path="metadata-slides.html"><a href="metadata-slides.html"><i class="fa fa-check"></i>Metadata</a></li>
<li><a href="dataspice.html#dataspice">Creating metadata with <code>dataspice</code></a></li>
<li class="part"><span><b>V Analysing and presenting analyses</b></span></li>
<li class="chapter" data-level="" data-path="plotting-with-ggplot2.html"><a href="plotting-with-ggplot2.html"><i class="fa fa-check"></i>Plotting with ggplot2</a></li>
<li class="chapter" data-level="" data-path="literate-programming-in-rmarkdown.html"><a href="literate-programming-in-rmarkdown.html"><i class="fa fa-check"></i>Literate Programming in rmarkdown</a></li>
<li class="part"><span><b>VI Version Control</b></span></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html"><i class="fa fa-check"></i>Version Control with Git</a></li>
<li class="chapter" data-level="" data-path="collaborative-github.html"><a href="collaborative-github.html"><i class="fa fa-check"></i>Collaborative GitHub</a></li>
<li><a href="practical-github-rstudio-for-collaborative-coding.html#practical-github-rstudio-for-collaborative-coding">Practical: <code>GitHub</code> &amp; <code>Rstudio</code> for collaborative coding</a></li>
<li class="part"><span><b>VII Closing</b></span></li>
<li class="chapter" data-level="" data-path="closing-remarks.html"><a href="closing-remarks.html"><i class="fa fa-check"></i>Closing Remarks</a></li>
<li class="part"><span><b>VIII Additonal materials</b></span></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html"><i class="fa fa-check"></i>Packaging functionality</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html"><i class="fa fa-check"></i>Creating a research compendium with rrtools</a></li>
<li class="part"><span><b>IX APPENDIX</b></span></li>
<li><a href="geolocate-r.html#geolocate.r"><code>geolocate.R</code></a></li>
<li><a href="analysis-r-1.html#analysis.r-1"><code>analysis.R</code></a></li>
<li><a href="index-rmd.html#index.rmd"><code>index.Rmd</code></a></li>
<li><a href="gitignore.html#gitignore"><code>.gitignore</code></a></li>
<li><a href="mypackage-hello-r.html#mypackage-hello.r"><code>mypackage</code> <code>hello.R</code></a></li>
<li><a href="mypackage-readme-rmd.html#mypackage-readme.rmd"><code>mypackage</code> <code>README.Rmd</code></a></li>
<li><a href="mypackage-description.html#mypackage-description"><code>mypackage</code> <code>DESCRIPTION</code></a></li>
<li><a href="rrcompendium-description.html#rrcompendium-description"><code>rrcompendium</code> <code>DESCRIPTION</code></a></li>
<li><a href="rrcompendium-readme-rmd.html#rrcompendium-readme.rmd"><code>rrcompendium</code> <code>README.Rmd</code></a></li>
<li><a href="rrcompendium-paper-rmd-yaml-header.html#rrcompendium-paper.rmd-yaml-header"><code>rrcompendium</code> <code>paper.Rmd</code> YAML header</a></li>
<li><a href="rrcompendium-paper-rmd.html#rrcompendium-paper.rmd"><code>rrcompendium</code> <code>paper.Rmd</code></a></li>
<li class="chapter" data-level="" data-path="about.html"><a href="about.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i>Software Setup</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i>Solutions</a></li>
<li class="divider"></li>
<li><a href="https://annakrystalli.me/rrreasearchACCE2020" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Research Data and Project Management in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-merge" class="section level1">
<h1>Merging data</h1>
<p>Let’s say we want to geolocate every individual in our analytic data.</p>
<p>As we’ve discussed, the various tables we downloaded hold different information collected during the various survey events.</p>
<ul>
<li>plot level metadata</li>
<li>individual level tagging metadata</li>
<li>individual level repeated measurement data (although we only have a single measurement event per individual in our data set).</li>
</ul>
<p>Currently, only the plot is geolocated, the data being contained in <code>vst_perplotperyear.csv</code> columns <code>decimalLatitude</code> and <code>decimalLongitude</code>.</p>
<p>The location of each individual stem is defined in <code>vst_mappingandtagging.csv</code>.</p>
<p>A number of variables are involved, including <code>pointID</code> which identifies a point on a 10m cell grid centred around <code>decimalLatitude</code> and <code>decimalLongitude</code>, and <code>stemDistance</code> and <code>stemAzimuth</code> which define the location of a stem, relative to the location of <code>pointID</code>. The full method used to locate individual stems is detailed in <code>methods/NEON_vegStructure_userGuide_vA.pdf</code>.</p>
<p><img src="assets/NEON_point_grid.png" /><!-- --></p>
<p>So to geolocate our individuals, we need to join information from <code>vst_perplotperyear.csv</code> and <code>vst_mappingandtagging.csv</code> into our <code>individuals</code> tibble.</p>
<p>We use the family of <code>*_join</code> function in <code>dplyr</code> to merge columns from different tibbles.</p>
<iframe src="assets/cheatsheets/data-transformation.pdf" width="672" height="400px">
</iframe>
<div id="join-basics" class="section level2">
<h2>Join Basics</h2>
<p>There are a number of joins we can perform with <code>dplyr</code>.</p>
<p>Let’s have a look at a few of them with a simple example using some <code>dplyr</code> in-built data:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="data-merge.html#cb310-1" aria-hidden="true" tabindex="-1"></a>band_members</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  band   
##   &lt;chr&gt; &lt;chr&gt;  
## 1 Mick  Stones 
## 2 John  Beatles
## 3 Paul  Beatles</code></pre>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="data-merge.html#cb312-1" aria-hidden="true" tabindex="-1"></a>band_instruments</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   name  plays 
##   &lt;chr&gt; &lt;chr&gt; 
## 1 John  guitar
## 2 Paul  bass  
## 3 Keith guitar</code></pre>
<p>The only variable shared between the two tables is <code>name</code> so this is the only variable we can perform joins over. By default, any <code>*_join</code> function will try to merge on the values of any matched columns in the tables being merged.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="data-merge.html#cb314-1" aria-hidden="true" tabindex="-1"></a>band_members <span class="sc">%&gt;%</span> <span class="fu">inner_join</span>(band_instruments)</span></code></pre></div>
<pre><code>## Joining, by = &quot;name&quot;</code></pre>
<pre><code>## # A tibble: 2 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass</code></pre>
<p><code>inner_join</code> has merged all three unique columns across the two tables into a single tibble.
It has only kept the rows in which <code>name</code> values had a match in both tables. In this case only data about <code>John</code> and <code>Paul</code> was contained in both tables.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="data-merge.html#cb317-1" aria-hidden="true" tabindex="-1"></a>band_members <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(band_instruments)</span></code></pre></div>
<pre><code>## Joining, by = &quot;name&quot;</code></pre>
<pre><code>## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass</code></pre>
<p><code>left_join</code> joins on the <code>names</code> in the left hand table and appends any rows from the right hand table in which <code>name</code> match. In this case, there is no data for <code>Keith</code> in <code>band_members</code> so he is ignored completely. There is also no match for <code>Mick</code> in <code>band_instruments</code> so <code>NA</code> is returned for <code>plays</code> instead.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="data-merge.html#cb320-1" aria-hidden="true" tabindex="-1"></a>band_members <span class="sc">%&gt;%</span> <span class="fu">right_join</span>(band_instruments)</span></code></pre></div>
<pre><code>## Joining, by = &quot;name&quot;</code></pre>
<pre><code>## # A tibble: 3 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 John  Beatles guitar
## 2 Paul  Beatles bass  
## 3 Keith &lt;NA&gt;    guitar</code></pre>
<p><code>right_join</code> on the other hand joins on the <code>name</code> in the right hand table. In this case, <code>Mick</code> is dropped completely <code>Keith</code> gets <code>NA</code> for band.</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="data-merge.html#cb323-1" aria-hidden="true" tabindex="-1"></a>band_members <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(band_instruments)</span></code></pre></div>
<pre><code>## Joining, by = &quot;name&quot;</code></pre>
<pre><code>## # A tibble: 4 x 3
##   name  band    plays 
##   &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; 
## 1 Mick  Stones  &lt;NA&gt;  
## 2 John  Beatles guitar
## 3 Paul  Beatles bass  
## 4 Keith &lt;NA&gt;    guitar</code></pre>
<p>Finally, a <code>full_join</code> joins on all unique values of <code>name</code> found across the two tables, returning <code>NA</code> where there are no matches between the two tables.</p>
</div>
<div id="joining-our-tables-with-dplyr" class="section level2">
<h2>Joining our tables with <code>dplyr</code></h2>
<div id="join-vst_mappingandtagging.csv-data" class="section level3">
<h3>Join <code>vst_mappingandtagging.csv</code> data</h3>
<p>Let’s start by merging data from <code>vst_mappingandtagging.csv</code>. Let’s read the data in.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="data-merge.html#cb326-1" aria-hidden="true" tabindex="-1"></a>maptag <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(fs<span class="sc">::</span><span class="fu">path</span>(raw_data_path, <span class="st">&quot;vst_mappingandtagging.csv&quot;</span>))</span></code></pre></div>
<p>This data set contains taxonomic and within-plot location metadata on individuals collected during mapping and tagging. There is one row per individual in the data set.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="data-merge.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(maptag)</span></code></pre></div>
<pre><code>## [1] &quot;uid&quot;            &quot;eventID&quot;        &quot;pointID&quot;        &quot;stemDistance&quot;  
## [5] &quot;stemAzimuth&quot;    &quot;individualID&quot;   &quot;taxonID&quot;        &quot;scientificName&quot;
## [9] &quot;taxonRank&quot;</code></pre>
<p>Let’s see how many matches in column names we have between the two datasets</p>
<div id="challenge-finding-column-name-matches-in-two-tables" class="section level5">
<h5>Challenge: Finding column name matches in two tables</h5>
<p>Given the two tables we are trying to join, can you write some code that checks which column names in <code>individual</code> have matches in <code>maptag</code> column names?</p>
<p><em>Hint: This is the correct answer.</em></p>
<pre><code>## [1] &quot;uid&quot;          &quot;eventID&quot;      &quot;individualID&quot;</code></pre>
<div id="solution" class="section level6">
<h6><a href="solutions.html#csol-col-matches" id="chlg-col-matches">Solution</a></h6>
</div>
</div>
<div id="default-left_join" class="section level4">
<h4>Default <code>left_join</code></h4>
<p>Because we want to match the rest of the tables to our individual data, we use <code>left_join()</code> and supply <code>individual</code> as the first argument and <code>maptag</code> as the second.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="data-merge.html#cb330-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb330-2"><a href="data-merge.html#cb330-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(maptag) </span></code></pre></div>
<pre><code>## Joining, by = c(&quot;uid&quot;, &quot;eventID&quot;, &quot;individualID&quot;)</code></pre>
<pre><code>## # A tibble: 14,961 x 18
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7a… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951a… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348e… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 2a4478… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 e48520… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 280c90… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 0e5060… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 4918ca… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16cb… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 14,951 more rows, and 10 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;, pointID &lt;dbl&gt;,
## #   stemDistance &lt;dbl&gt;, stemAzimuth &lt;dbl&gt;, taxonID &lt;chr&gt;, scientificName &lt;chr&gt;,
## #   taxonRank &lt;chr&gt;</code></pre>
<p>Great we have a merge!</p>
<p>Looks successful right? How do we really know nothing has gone wrong though? Remember, to successfully merge the tables, the data in the columns the tables are being joined on need to have corresponding values across all columns to be linked successfully, otherwise it will return <code>NA</code>s. So, although our code ran successfully, it may well not have found any matching rows in <code>maptag</code> to merge into <code>individual</code>.</p>
<p>To check whether things have worked, we can start with inspecting the output for the columns of interest, in this case the <code>maptag</code> columns we are trying to join into <code>individual</code>.</p>
<p>When working interactively and testing out pipes, you can pipe objects into <code>View()</code> for quick inspection. If you provide a character string as an argument, it is used as a name for the data view tab it launches</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="data-merge.html#cb333-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb333-2"><a href="data-merge.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(maptag) <span class="sc">%&gt;%</span></span>
<span id="cb333-3"><a href="data-merge.html#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">View</span>(<span class="st">&quot;default&quot;</span>)</span></code></pre></div>
<p><img src="assets/view_default_join.png" /><!-- --></p>
<p>Clearly this has not worked! We need to start digging into why but we don’t want to have to keep manually checking whether it worked or not. Enter <strong>DEFENSIVE PROGRAMMING</strong>.</p>
</div>
<div id="defensive-programming-with-data" class="section level4">
<h4>Defensive programming with data</h4>
<p>As I mentioned in the Data Management Basics slides, <a href="https://github.com/ropensci/assertr"><code>assertr</code></a> is a useful package for including validation checks in our data pipelines.</p>
<p>In our case, we can use <code>assertr</code> function <code>assert</code> to check that certain columns of interest (<code>stemDistance</code>, <code>stemAzimuth</code>, <code>pointID</code>) are joined successfully (i.e. there re no <code>NA</code> values). Note that this only works because I know for a fact that there is data avaliable for all individuals.</p>
<p>There may be situations in which <code>NA</code>s are valid missing data, in which case this would not be an appropriate test.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="data-merge.html#cb334-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb334-2"><a href="data-merge.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(maptag) <span class="sc">%&gt;%</span></span>
<span id="cb334-3"><a href="data-merge.html#cb334-3" aria-hidden="true" tabindex="-1"></a>  assertr<span class="sc">::</span><span class="fu">assert</span>(assertr<span class="sc">::</span>not_na,  stemDistance, stemAzimuth, pointID)</span></code></pre></div>
<pre><code>## Joining, by = c(&quot;uid&quot;, &quot;eventID&quot;, &quot;individualID&quot;)</code></pre>
<pre><code>## Column &#39;stemDistance&#39; violates assertion &#39;not_na&#39; 14961 times
##     verb redux_fn predicate       column index value
## 1 assert       NA    not_na stemDistance     1    NA
## 2 assert       NA    not_na stemDistance     2    NA
## 3 assert       NA    not_na stemDistance     3    NA
## 4 assert       NA    not_na stemDistance     4    NA
## 5 assert       NA    not_na stemDistance     5    NA
##   [omitted 14956 rows]
## 
## 
## Column &#39;stemAzimuth&#39; violates assertion &#39;not_na&#39; 14961 times
##     verb redux_fn predicate      column index value
## 1 assert       NA    not_na stemAzimuth     1    NA
## 2 assert       NA    not_na stemAzimuth     2    NA
## 3 assert       NA    not_na stemAzimuth     3    NA
## 4 assert       NA    not_na stemAzimuth     4    NA
## 5 assert       NA    not_na stemAzimuth     5    NA
##   [omitted 14956 rows]
## 
## 
## Column &#39;pointID&#39; violates assertion &#39;not_na&#39; 14961 times
##     verb redux_fn predicate  column index value
## 1 assert       NA    not_na pointID     1    NA
## 2 assert       NA    not_na pointID     2    NA
## 3 assert       NA    not_na pointID     3    NA
## 4 assert       NA    not_na pointID     4    NA
## 5 assert       NA    not_na pointID     5    NA
##   [omitted 14956 rows]</code></pre>
<pre><code>## Error: assertr stopped execution</code></pre>
<p>By including this check, I don’t have to guess or manually check whether the merge has been successful. The code will just error if it hasn’t 🙌.</p>
</div>
<div id="debugging-hidden-mismatches" class="section level4">
<h4>Debugging hidden mismatches:</h4>
<p>I’ve shown the most minimal implementation in which <code>dplyr</code> does a lot of the guessing for us and tries to join on all matched columns. But often, that can generate table mismatches</p>
<p>We know that the only column we are interested in matching on is <code>individualID</code>. We want to get the mapping associated with each individual, regardless of when the mapping was collected. We can be specific about which variables we want to join on through argument <code>by</code>.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="data-merge.html#cb338-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb338-2"><a href="data-merge.html#cb338-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(maptag, </span>
<span id="cb338-3"><a href="data-merge.html#cb338-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="st">&quot;individualID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb338-4"><a href="data-merge.html#cb338-4" aria-hidden="true" tabindex="-1"></a>  assertr<span class="sc">::</span><span class="fu">assert</span>(assertr<span class="sc">::</span>not_na, stemDistance, stemAzimuth, pointID)</span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 20
##    uid.x  namedLocation date       eventID.x domainID siteID plotID individualID
##    &lt;chr&gt;  &lt;chr&gt;         &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a1… BART_037.bas… 2015-08-26 vst_BART… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7… BART_037.bas… 2015-08-26 vst_BART… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951… BART_044.bas… 2015-08-26 vst_BART… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348… BART_044.bas… 2015-08-26 vst_BART… D01      BART   BART_… NEON.PLA.D0…
##  5 2a447… BART_044.bas… 2015-08-26 vst_BART… D01      BART   BART_… NEON.PLA.D0…
##  6 e4852… BART_044.bas… 2015-08-26 vst_BART… D01      BART   BART_… NEON.PLA.D0…
##  7 280c9… BART_044.bas… 2015-08-26 vst_BART… D01      BART   BART_… NEON.PLA.D0…
##  8 0e506… BART_044.bas… 2015-08-26 vst_BART… D01      BART   BART_… NEON.PLA.D0…
##  9 4918c… BART_044.bas… 2015-08-26 vst_BART… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16c… BART_044.bas… 2015-08-26 vst_BART… D01      BART   BART_… NEON.PLA.D0…
## # … with 14,951 more rows, and 12 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;, uid.y &lt;chr&gt;,
## #   eventID.y &lt;chr&gt;, pointID &lt;dbl&gt;, stemDistance &lt;dbl&gt;, stemAzimuth &lt;dbl&gt;,
## #   taxonID &lt;chr&gt;, scientificName &lt;chr&gt;, taxonRank &lt;chr&gt;</code></pre>
<p>Excellent! Our code runs and our resulting merged tibble contains data for all the variables we are interested in!</p>
<p>However, on closer inspection, we’ve ended up with some odd new columns, <code>uid.x</code> and <code>uid.y</code> and <code>eventID.x</code> and <code>eventID.y</code>!</p>
<p>That’s because those columns are also present in both our tables but we are not explicitly joining them. They are retained and each suffixed with <code>.x</code> &amp; <code>.y</code> by default, to make them unique.</p>
<p>So, what about these duplicate columns. Do we need them?</p>
<p>With respect to <code>eventID</code>, we’re not really interested in the mapping <code>eventID</code>s so we can just drop that column from <code>maptag</code>.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="data-merge.html#cb340-1" aria-hidden="true" tabindex="-1"></a>maptag <span class="ot">&lt;-</span> <span class="fu">select</span>(maptag, <span class="sc">-</span>eventID)</span>
<span id="cb340-2"><a href="data-merge.html#cb340-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb340-3"><a href="data-merge.html#cb340-3" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb340-4"><a href="data-merge.html#cb340-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(maptag, </span>
<span id="cb340-5"><a href="data-merge.html#cb340-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="st">&quot;individualID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb340-6"><a href="data-merge.html#cb340-6" aria-hidden="true" tabindex="-1"></a>  assertr<span class="sc">::</span><span class="fu">assert</span>(assertr<span class="sc">::</span>not_na, stemDistance, stemAzimuth, pointID)</span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 19
##    uid.x   namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7a… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951a… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348e… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 2a4478… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 e48520… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 280c90… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 0e5060… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 4918ca… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16cb… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 14,951 more rows, and 11 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;, uid.y &lt;chr&gt;,
## #   pointID &lt;dbl&gt;, stemDistance &lt;dbl&gt;, stemAzimuth &lt;dbl&gt;, taxonID &lt;chr&gt;,
## #   scientificName &lt;chr&gt;, taxonRank &lt;chr&gt;</code></pre>
<p>On the other hand, <code>"uid</code> contains unique identifiers for each observation in their respective table and could be useful metadata to store, enabling us to trace the provenance of individual values to the original data. So rather than remove them, let’s retain both <code>uid</code>, one for each table.</p>
<p>We can give more informative suffixes using argument <code>suffix</code>. In our case, I want the <code>individual</code> column to stay as <code>uid</code> and the <code>maptag</code> column to get the suffix <code>_map</code>.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="data-merge.html#cb342-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb342-2"><a href="data-merge.html#cb342-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(maptag, </span>
<span id="cb342-3"><a href="data-merge.html#cb342-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="st">&quot;individualID&quot;</span>,</span>
<span id="cb342-4"><a href="data-merge.html#cb342-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_map&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb342-5"><a href="data-merge.html#cb342-5" aria-hidden="true" tabindex="-1"></a>  assertr<span class="sc">::</span><span class="fu">assert</span>(assertr<span class="sc">::</span>not_na, stemDistance, stemAzimuth, pointID)</span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 19
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7a… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951a… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348e… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 2a4478… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 e48520… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 280c90… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 0e5060… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 4918ca… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16cb… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 14,951 more rows, and 11 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;, uid_map &lt;chr&gt;,
## #   pointID &lt;dbl&gt;, stemDistance &lt;dbl&gt;, stemAzimuth &lt;dbl&gt;, taxonID &lt;chr&gt;,
## #   scientificName &lt;chr&gt;, taxonRank &lt;chr&gt;</code></pre>
<p>Nice!</p>
</div>
<div id="join-vst_perplotperyear.csv" class="section level4">
<h4>Join <code>vst_perplotperyear.csv</code></h4>
<p>Now let’s carry on and join the perplot data. First let’s read it in.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="data-merge.html#cb344-1" aria-hidden="true" tabindex="-1"></a>perplot <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(fs<span class="sc">::</span><span class="fu">path</span>(raw_data_path, <span class="st">&quot;vst_perplotperyear.csv&quot;</span>))</span>
<span id="cb344-2"><a href="data-merge.html#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(perplot)</span></code></pre></div>
<pre><code>##  [1] &quot;uid&quot;                  &quot;plotID&quot;               &quot;plotType&quot;            
##  [4] &quot;nlcdClass&quot;            &quot;decimalLatitude&quot;      &quot;decimalLongitude&quot;    
##  [7] &quot;geodeticDatum&quot;        &quot;easting&quot;              &quot;northing&quot;            
## [10] &quot;utmZone&quot;              &quot;elevation&quot;            &quot;elevationUncertainty&quot;
## [13] &quot;eventID&quot;</code></pre>
<p>Similarly to <code>maptag</code>, we want to exclude <code>eventID</code> and suffix the <code>uid</code> column. This time, however, we will be joining by <code>plotID</code></p>
<p>Let’s also move our validation test to the end and add the new columns we want to check to it, i.e. <code>stemDistance</code>, <code>stemAzimuth</code>, <code>pointID</code>.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="data-merge.html#cb346-1" aria-hidden="true" tabindex="-1"></a>perplot <span class="ot">&lt;-</span> perplot <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>eventID)</span>
<span id="cb346-2"><a href="data-merge.html#cb346-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-3"><a href="data-merge.html#cb346-3" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb346-4"><a href="data-merge.html#cb346-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(maptag, </span>
<span id="cb346-5"><a href="data-merge.html#cb346-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="st">&quot;individualID&quot;</span>,</span>
<span id="cb346-6"><a href="data-merge.html#cb346-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_map&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb346-7"><a href="data-merge.html#cb346-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(perplot, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;plotID&quot;</span>), </span>
<span id="cb346-8"><a href="data-merge.html#cb346-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_ppl&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb346-9"><a href="data-merge.html#cb346-9" aria-hidden="true" tabindex="-1"></a>  assertr<span class="sc">::</span><span class="fu">assert</span>(assertr<span class="sc">::</span>not_na,  decimalLatitude,</span>
<span id="cb346-10"><a href="data-merge.html#cb346-10" aria-hidden="true" tabindex="-1"></a>                  decimalLongitude, plotID, stemDistance, stemAzimuth, pointID)</span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 30
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  2 68dc7a… BART_037.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  3 a8951a… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  4 eb348e… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  5 2a4478… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  6 e48520… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  7 280c90… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  8 0e5060… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
##  9 4918ca… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## 10 ef16cb… BART_044.base… 2015-08-26 vst_BA… D01      BART   BART_… NEON.PLA.D0…
## # … with 14,951 more rows, and 22 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;, uid_map &lt;chr&gt;,
## #   pointID &lt;dbl&gt;, stemDistance &lt;dbl&gt;, stemAzimuth &lt;dbl&gt;, taxonID &lt;chr&gt;,
## #   scientificName &lt;chr&gt;, taxonRank &lt;chr&gt;, uid_ppl &lt;chr&gt;, plotType &lt;chr&gt;,
## #   nlcdClass &lt;chr&gt;, decimalLatitude &lt;dbl&gt;, decimalLongitude &lt;dbl&gt;,
## #   geodeticDatum &lt;chr&gt;, easting &lt;dbl&gt;, northing &lt;dbl&gt;, utmZone &lt;chr&gt;,
## #   elevation &lt;dbl&gt;, elevationUncertainty &lt;dbl&gt;</code></pre>
<p>Awesome!! It’s worked!</p>
<p>Now that we are happy with our data we can use a new operator, the <strong>assignment pipe (<code>%&lt;&gt;%</code>)</strong>.</p>
<p>This allows us to both pipe an object forward into an expression and also update it with the resulting value.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="data-merge.html#cb348-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&lt;&gt;%</span></span>
<span id="cb348-2"><a href="data-merge.html#cb348-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(maptag, </span>
<span id="cb348-3"><a href="data-merge.html#cb348-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">by =</span> <span class="st">&quot;individualID&quot;</span>,</span>
<span id="cb348-4"><a href="data-merge.html#cb348-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_map&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb348-5"><a href="data-merge.html#cb348-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(perplot, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;plotID&quot;</span>), </span>
<span id="cb348-6"><a href="data-merge.html#cb348-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_ppl&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb348-7"><a href="data-merge.html#cb348-7" aria-hidden="true" tabindex="-1"></a>  assertr<span class="sc">::</span><span class="fu">assert</span>(assertr<span class="sc">::</span>not_na,  decimalLatitude,</span>
<span id="cb348-8"><a href="data-merge.html#cb348-8" aria-hidden="true" tabindex="-1"></a>                  decimalLongitude, plotID, stemDistance, stemAzimuth, pointID)</span></code></pre></div>
<p>We can now move on to geolocate our individuals!</p>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="iteration.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="functions.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["rrresearchACCE20.pdf", "rrresearchACCE20.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
