<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Functions | Reproducible Research Data and Project Management in R</title>
  <meta name="description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Functions | Reproducible Research Data and Project Management in R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://annakrystalli.me/rrresearchACCE20" />
  
  <meta property="og:description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  <meta name="github-repo" content="https://github.com/annakrystalli/rrresearchACCE20" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Functions | Reproducible Research Data and Project Management in R" />
  
  <meta name="twitter:description" content="This course focuses on data and project management through R and Rstudio, will introduce students to best practice and equip them with modern tools and techniques for managing data and computational workflows to their full potential." />
  

<meta name="author" content="Course Instructor: Dr Anna Krystalli" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-merge.html"/>
<link rel="next" href="metadata.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/jsoneditor-5.25.6/jsoneditor.min.css" rel="stylesheet" />
<script src="libs/jsoneditor-5.25.6/jsoneditor.min.js"></script>
<script src="libs/jsonedit-binding-3.0.0/jsonedit.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Reproducible Research Data & Project Management in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Course description</a></li>
<li class="chapter" data-level="" data-path="welcome-slides.html"><a href="welcome-slides.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Basics</b></span></li>
<li class="chapter" data-level="" data-path="rstudio-basics.html"><a href="rstudio-basics.html"><i class="fa fa-check"></i>Intro to R &amp; Rstudio</a></li>
<li class="chapter" data-level="" data-path="r-basics.html"><a href="r-basics.html"><i class="fa fa-check"></i>R Basics</a></li>
<li class="chapter" data-level="" data-path="data-types-structures-and-classes.html"><a href="data-types-structures-and-classes.html"><i class="fa fa-check"></i>Data types, structures and classes</a></li>
<li class="chapter" data-level="" data-path="indexing-and-subsetting.html"><a href="indexing-and-subsetting.html"><i class="fa fa-check"></i>Indexing and subsetting</a></li>
<li class="chapter" data-level="" data-path="the-tidyverse-way.html"><a href="the-tidyverse-way.html"><i class="fa fa-check"></i>The tidyverse way</a></li>
<li class="chapter" data-level="" data-path="rdm-intro-view.html"><a href="rdm-intro-view.html"><i class="fa fa-check"></i>Data management Basics</a></li>
<li class="part"><span><b>II Project Management</b></span></li>
<li class="chapter" data-level="" data-path="projects-in-rstudio.html"><a href="projects-in-rstudio.html"><i class="fa fa-check"></i>Projects in Rstudio</a></li>
<li class="chapter" data-level="" data-path="filenaming-view.html"><a href="filenaming-view.html"><i class="fa fa-check"></i>Good File Naming</a></li>
<li class="chapter" data-level="" data-path="path-proj-str.html"><a href="path-proj-str.html"><i class="fa fa-check"></i>Paths and Project structure</a></li>
<li class="part"><span><b>III Data Munging</b></span></li>
<li class="chapter" data-level="" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i>Iteration</a></li>
<li class="chapter" data-level="" data-path="data-merge.html"><a href="data-merge.html"><i class="fa fa-check"></i>Merging data</a></li>
<li class="chapter" data-level="" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i>Functions</a></li>
<li class="part"><span><b>IV Working with metadata</b></span></li>
<li class="chapter" data-level="" data-path="metadata-slides.html"><a href="metadata-slides.html"><i class="fa fa-check"></i>Metadata</a></li>
<li><a href="dataspice.html#dataspice">Creating metadata with <code>dataspice</code></a></li>
<li class="part"><span><b>V Analysing and presenting analyses</b></span></li>
<li class="chapter" data-level="" data-path="plotting-with-ggplot2.html"><a href="plotting-with-ggplot2.html"><i class="fa fa-check"></i>Plotting with ggplot2</a></li>
<li class="chapter" data-level="" data-path="literate-programming-in-rmarkdown.html"><a href="literate-programming-in-rmarkdown.html"><i class="fa fa-check"></i>Literate Programming in rmarkdown</a></li>
<li class="part"><span><b>VI Version Control</b></span></li>
<li class="chapter" data-level="" data-path="version-control-with-git.html"><a href="version-control-with-git.html"><i class="fa fa-check"></i>Version Control with Git</a></li>
<li class="chapter" data-level="" data-path="collaborative-github.html"><a href="collaborative-github.html"><i class="fa fa-check"></i>Collaborative GitHub</a></li>
<li><a href="practical-github-rstudio-for-collaborative-coding.html#practical-github-rstudio-for-collaborative-coding">Practical: <code>GitHub</code> &amp; <code>Rstudio</code> for collaborative coding</a></li>
<li class="part"><span><b>VII Closing</b></span></li>
<li class="chapter" data-level="" data-path="closing-remarks.html"><a href="closing-remarks.html"><i class="fa fa-check"></i>Closing Remarks</a></li>
<li class="part"><span><b>VIII Additonal materials</b></span></li>
<li class="chapter" data-level="" data-path="packaging-functionality.html"><a href="packaging-functionality.html"><i class="fa fa-check"></i>Packaging functionality</a></li>
<li class="chapter" data-level="" data-path="creating-a-research-compendium-with-rrtools.html"><a href="creating-a-research-compendium-with-rrtools.html"><i class="fa fa-check"></i>Creating a research compendium with rrtools</a></li>
<li class="part"><span><b>IX APPENDIX</b></span></li>
<li><a href="geolocate-r.html#geolocate.r"><code>geolocate.R</code></a></li>
<li><a href="analysis-r-1.html#analysis.r-1"><code>analysis.R</code></a></li>
<li><a href="index-rmd.html#index.rmd"><code>index.Rmd</code></a></li>
<li><a href="gitignore.html#gitignore"><code>.gitignore</code></a></li>
<li><a href="mypackage-readme-rmd.html#mypackage-readme.rmd"><code>mypackage</code> <code>README.Rmd</code></a></li>
<li class="chapter" data-level="" data-path="about.html"><a href="about.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="setup.html"><a href="setup.html"><i class="fa fa-check"></i>Software Setup</a></li>
<li class="chapter" data-level="" data-path="solutions.html"><a href="solutions.html"><i class="fa fa-check"></i>Solutions</a></li>
<li class="divider"></li>
<li><a href="https://annakrystalli.me/rrreasearchACCE2020" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Reproducible Research Data and Project Management in R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="functions" class="section level1">
<h1>Functions</h1>
<p>As we‚Äôve mentioned, functions, and especially user built custom functions, are a key feature of R and are a really powerful of reducing code repetition.</p>
<div id="function-basics" class="section level2 alert alert-info">
<h2>Function basics</h2>
<p><strong>Functions allow us to:</strong></p>
<ul>
<li>incorporate sets of instructions that we want to use repeatedly</li>
<li>contain complex code in a neat sub-program</li>
<li>reduce opportunity for errors</li>
<li>make code more readable</li>
</ul>
<p><strong>You can do anything with functions that you can do with vectors:</strong></p>
<ul>
<li>assign them to variables</li>
<li>store them in lists</li>
<li>pass them as arguments to other functions</li>
<li>create them inside functions</li>
<li>return them as the result of a function</li>
</ul>
<p><strong>In general, functions usually:</strong>
- accept parameters (arguments) &lt;- <code>INPUT</code>
- return value(s) &lt;- <code>OUTPUT</code></p>
</div>
<div id="elements-of-a-function" class="section level2">
<h2>Elements of a function</h2>
<p>Here‚Äôs a simple skeleton of a function.</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="functions.html#cb349-1" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="cf">function</span>(variables) {</span>
<span id="cb349-2"><a href="functions.html#cb349-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb349-3"><a href="functions.html#cb349-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="function-name" class="section level3">
<h3>Function name</h3>
<p>This can be any valid variable name, but you should avoid using names that are used elsewhere in R, such as <code>dir</code>, <code>function</code>, <code>plot</code>, etc</p>
<ul>
<li>choose descriptive names</li>
<li>use verbs</li>
<li>check whether they are already in use: <code>? function.name</code></li>
</ul>
<p>(you can access a function from a specific package using <code>package.name::function.name</code>)</p>
<p><br></p>
</div>
<div id="arguments" class="section level3">
<h3>Arguments</h3>
<p>Functions can have <strong>any number of arguments</strong>. These can be <strong>any R object:</strong> numbers, strings, arrays, data frames, of even pointers to other functions; anything that is needed for the function to run.</p>
<ul>
<li>Again, use descriptive names for arguments.</li>
</ul>
</div>
<div id="body" class="section level3">
<h3>Body</h3>
<p>The function code between the <code>{}</code> brackets is run every time the function is called. Ideally functions are short and do just one thing.</p>
<p><strong>All inputs required for computation in the body must be supplied as arguments.</strong></p>
</div>
<div id="simple-example" class="section level3">
<h3>Simple example</h3>
<p>Let‚Äôs write a simple function that takes two arguments <code>x</code> and <code>y</code> and adds them together.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="functions.html#cb350-1" aria-hidden="true" tabindex="-1"></a>add <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb350-2"><a href="functions.html#cb350-2" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">+</span> y</span>
<span id="cb350-3"><a href="functions.html#cb350-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let‚Äôs test it.</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="functions.html#cb351-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb351-2"><a href="functions.html#cb351-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb351-3"><a href="functions.html#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="fu">add</span>(x, y)</span></code></pre></div>
<pre><code>## [1] 6</code></pre>
<p>Cool it works!</p>
</div>
<div id="return-value" class="section level3">
<h3>Return value</h3>
<p>By default, the output of the last line of the code is evaluated is the value that will be returned by the function.</p>
<p>We can override that default by using <code>return</code> to explicitly specify what is returned.</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="functions.html#cb353-1" aria-hidden="true" tabindex="-1"></a>add <span class="ot">&lt;-</span> <span class="cf">function</span>(x, y) {</span>
<span id="cb353-2"><a href="functions.html#cb353-2" aria-hidden="true" tabindex="-1"></a>    x <span class="sc">+</span> y</span>
<span id="cb353-3"><a href="functions.html#cb353-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb353-4"><a href="functions.html#cb353-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="functions.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="fu">add</span>(x, y)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<p>It is not necessary that a function return anything, for example a function that makes a plot might not return anything, whereas a function that does a mathematical operation might return a number, or a list.</p>
</div>
<div id="function-environment" class="section level3">
<h3>Function Environment</h3>
<div class="alert alert-info">
<p><strong>Every time a function is called, a new environment is created to host execution.</strong></p>
<ul>
<li><p>Each invocation is <strong>completely independent of previous ones</strong></p></li>
<li><p>Variables used within are <strong><em>local</em></strong>, e.g.¬†their scope lies within - and is limited to - the function itself. They are therefore <strong>invisible outside the function body</strong></p></li>
</ul>
</div>
<p>Objects required by the function will be sought first in the <strong><em>local environment</em></strong>. If an argument specified in the function is missing, it will return an error, even if such an object exists in the global environment.</p>
<p>Objects required by computation but not specified as function arguments will be sought in the containing environment iteratively until it reaches the <strong><em>global environment</em></strong>. This can be a source of bugs when developing with an untidy global environment.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="functions.html#cb356-1" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb356-2"><a href="functions.html#cb356-2" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="cf">function</span>(a){a <span class="sc">+</span> b}</span>
<span id="cb356-3"><a href="functions.html#cb356-3" aria-hidden="true" tabindex="-1"></a><span class="fu">f2</span>(<span class="at">a =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 20</code></pre>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="functions.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(b) <span class="co"># remove object b</span></span>
<span id="cb358-2"><a href="functions.html#cb358-2" aria-hidden="true" tabindex="-1"></a><span class="fu">f2</span>(<span class="at">a =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## Error in f2(a = 10): object &#39;b&#39; not found</code></pre>
<p>Solution: always make sure any required variables are passed as arguments to your functions.</p>
</div>
</div>
<div id="creating-our-user-built-functions" class="section level2">
<h2>Creating our user-built functions</h2>
<p>Now that we‚Äôve got all the information required, we can start building a function that will return our latitude and longitude for each individual.</p>
<p>We can use function <code>destPoint</code> form package <code>geosphere</code> to calculate the destination latitude and longitude from a given starting point, the distance travelled and the direction (bearing) travelled in.</p>
<p>I our case the distance travelled is equivalent to <code>stemDistance</code> and the direction or bearing is equivalent to <code>stemAzimuth</code>. The starting point is given by <code>decimalLatitude</code> and `<code>decimalLongitude.</code></p>
<p>Now, let‚Äôs write a function that takes these columns as inputs and returns the latitude and longitude of the location of our individuals.</p>
<div id="storing-functions-in-scripts." class="section level3">
<h3>Storing functions in scripts.</h3>
<p>It‚Äôs best to store functions in separate scripts in the <code>R/</code> directory.</p>
<p>We can use function <code>usethis::use_r()</code> to create scripts in <code>R/</code>. Let‚Äôs create a new one to start working on our function.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="functions.html#cb360-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_r</span>(<span class="st">&quot;geolocate&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="functions.html#cb361-1" aria-hidden="true" tabindex="-1"></a>‚úî Setting active project to <span class="st">&#39;/Users/Anna/Documents/workflows/workshops/books/rrresearchACCE20&#39;</span></span>
<span id="cb361-2"><a href="functions.html#cb361-2" aria-hidden="true" tabindex="-1"></a>‚óè Modify <span class="st">&#39;R/geolocate.R&#39;</span></span></code></pre></div>
<p>This creates the required <code>R/</code> directory, creates a new R script named <code>geolocation.R</code> within it and launches it for editing all in one go! Nice.</p>
</div>
</div>
<div id="experimenting" class="section level2">
<h2>Experimenting</h2>
<p>Now before we begin writing our function, let‚Äôs test <code>destPoint</code> out. To do that, let‚Äôs subset a single row from <code>individual</code> and use it to test out the function. We need to supply a vector of length two, containing the starting longitude and latitude to argument <code>p</code>. We pass <code>stemAzimuth</code> to argument <code>b</code> (for bearing) and <code>stemDistance</code> to argument <code>d</code> (for distance).</p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="functions.html#cb362-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> individual[<span class="dv">1</span>,]</span>
<span id="cb362-2"><a href="functions.html#cb362-2" aria-hidden="true" tabindex="-1"></a>geosphere<span class="sc">::</span><span class="fu">destPoint</span>(<span class="at">p =</span> <span class="fu">c</span>(x<span class="sc">$</span>decimalLongitude, x<span class="sc">$</span>decimalLatitude), </span>
<span id="cb362-3"><a href="functions.html#cb362-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">b =</span> x<span class="sc">$</span>stemAzimuth, <span class="at">d =</span> x<span class="sc">$</span>stemDistance)</span></code></pre></div>
<pre><code>##            lon      lat
## [1,] -71.28333 44.06151</code></pre>
<p>This looks like it‚Äôs working nicely. Let‚Äôs also check that it vectorises easily, i.e.¬†that if we give it vectors of values instead of single ones that it works properly.</p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="functions.html#cb364-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> individual[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,]</span>
<span id="cb364-2"><a href="functions.html#cb364-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-3"><a href="functions.html#cb364-3" aria-hidden="true" tabindex="-1"></a>geosphere<span class="sc">::</span><span class="fu">destPoint</span>(<span class="at">p =</span> <span class="fu">c</span>(x<span class="sc">$</span>decimalLongitude, x<span class="sc">$</span>decimalLatitude), </span>
<span id="cb364-4"><a href="functions.html#cb364-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">b =</span> x<span class="sc">$</span>stemAzimuth, <span class="at">d =</span> x<span class="sc">$</span>stemDistance)</span></code></pre></div>
<pre><code>## Error in .pointsToMatrix(p): Wrong length for a vector, should be 2</code></pre>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="functions.html#cb366-1" aria-hidden="true" tabindex="-1"></a>geosphere<span class="sc">::</span><span class="fu">destPoint</span>(<span class="at">p =</span> <span class="fu">cbind</span>(x<span class="sc">$</span>decimalLongitude, x<span class="sc">$</span>decimalLatitude), </span>
<span id="cb366-2"><a href="functions.html#cb366-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">b =</span> x<span class="sc">$</span>stemAzimuth, <span class="at">d =</span> x<span class="sc">$</span>stemDistance)</span></code></pre></div>
<pre><code>##            lon      lat
## [1,] -71.28333 44.06151
## [2,] -71.28325 44.06165
## [3,] -71.28419 44.06109
## [4,] -71.28424 44.06096
## [5,] -71.28409 44.06103</code></pre>
<p>Excellent! I now get a two dimensional matrix of with two columns and a row for each input element! This is looking promising.</p>
<p>We‚Äôre ready to start writing our function.</p>
</div>
<div id="developing-our-function" class="section level2">
<h2>Developing our function</h2>
<p>Let‚Äôs start by using a handy feature in Rstudio, code snippets. Code snippets are text macros that are used for quickly inserting common snippets of code.</p>
<p>The fun snippet inserts an R function definition. To invoke it start typing <code>fun</code> until the auto-complete drop-down pops up.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="functions.html#cb368-1" aria-hidden="true" tabindex="-1"></a>fun</span></code></pre></div>
<p><img src="assets/snippet_fun.png" /><!-- --></p>
<p>Select <code>fun</code> and hit Return / Enter.</p>
<p>You end up with this handy function skeleton. Now, let‚Äôs start populating it with our own function.</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="functions.html#cb369-1" aria-hidden="true" tabindex="-1"></a>name <span class="ot">&lt;-</span> <span class="cf">function</span>(variables) {</span>
<span id="cb369-2"><a href="functions.html#cb369-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb369-3"><a href="functions.html#cb369-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>First lets start with a descriptive name:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="functions.html#cb370-1" aria-hidden="true" tabindex="-1"></a>get_stem_location <span class="ot">&lt;-</span> <span class="cf">function</span>(variables) {</span>
<span id="cb370-2"><a href="functions.html#cb370-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb370-3"><a href="functions.html#cb370-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let‚Äôs add our arguments:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="functions.html#cb371-1" aria-hidden="true" tabindex="-1"></a>get_stem_location <span class="ot">&lt;-</span> <span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</span>
<span id="cb371-2"><a href="functions.html#cb371-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-3"><a href="functions.html#cb371-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Finally, let‚Äôs populate the body our our function:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="functions.html#cb372-1" aria-hidden="true" tabindex="-1"></a>get_stem_location <span class="ot">&lt;-</span> <span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</span>
<span id="cb372-2"><a href="functions.html#cb372-2" aria-hidden="true" tabindex="-1"></a>    geosphere<span class="sc">::</span><span class="fu">destPoint</span>(<span class="at">p =</span> <span class="fu">cbind</span>(decimalLongitude, decimalLatitude), </span>
<span id="cb372-3"><a href="functions.html#cb372-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">b =</span> stemAzimuth, <span class="at">d =</span> stemDistance)</span>
<span id="cb372-4"><a href="functions.html#cb372-4" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let‚Äôs also convert the output to a tibble, for better printing.</p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="functions.html#cb373-1" aria-hidden="true" tabindex="-1"></a>get_stem_location <span class="ot">&lt;-</span> <span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</span>
<span id="cb373-2"><a href="functions.html#cb373-2" aria-hidden="true" tabindex="-1"></a>    geosphere<span class="sc">::</span><span class="fu">destPoint</span>(<span class="at">p =</span> <span class="fu">cbind</span>(decimalLongitude, decimalLatitude), </span>
<span id="cb373-3"><a href="functions.html#cb373-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">b =</span> stemAzimuth, <span class="at">d =</span> stemDistance) <span class="sc">%&gt;%</span></span>
<span id="cb373-4"><a href="functions.html#cb373-4" aria-hidden="true" tabindex="-1"></a>        tibble<span class="sc">::</span><span class="fu">as_tibble</span>()</span>
<span id="cb373-5"><a href="functions.html#cb373-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now let‚Äôs test it out with vectors from <code>individual</code>.</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="functions.html#cb374-1" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">get_stem_location</span>(x<span class="sc">$</span>decimalLongitude, x<span class="sc">$</span>decimalLatitude, </span>
<span id="cb374-2"><a href="functions.html#cb374-2" aria-hidden="true" tabindex="-1"></a>                  x<span class="sc">$</span>stemAzimuth, x<span class="sc">$</span>stemDistance)</span>
<span id="cb374-3"><a href="functions.html#cb374-3" aria-hidden="true" tabindex="-1"></a>test</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##     lon   lat
##   &lt;dbl&gt; &lt;dbl&gt;
## 1 -71.3  44.1
## 2 -71.3  44.1
## 3 -71.3  44.1
## 4 -71.3  44.1
## 5 -71.3  44.1</code></pre>
<p>Looks like it works nicely!</p>
<div id="defensive-programming-in-functions" class="section level3">
<h3>Defensive programming in functions</h3>
<p>Our function seems to be working correctly but it‚Äôs good to incorporate checks, especially on our inputs and outputs. For example, if we supply a character vector to our function by mistake, our function won‚Äôt work.</p>
<p>We can write smart checks using the suite of functions in package <code>checkmate</code>.</p>
<p>One such function is <code>assert_numeric()</code></p>
<p>This checks whether the the object we give it is numeric. If the check is not successful, it returns the object invisibly. If the check is not successful, it throws an error.</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="functions.html#cb376-1" aria-hidden="true" tabindex="-1"></a>checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(x<span class="sc">$</span>decimalLatitude)</span>
<span id="cb376-2"><a href="functions.html#cb376-2" aria-hidden="true" tabindex="-1"></a>checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(x<span class="sc">$</span>uid)</span></code></pre></div>
<pre><code>## Error in eval(expr, envir, enclos): Assertion on &#39;x$uid&#39; failed: Must be of type &#39;numeric&#39;, not &#39;character&#39;.</code></pre>
<p>There are two other versions, <code>test_numeric</code> which returns <code>FALSE</code> if the check is not successful, and <code>check_numeric</code> which returns a string with the error message. We want to throw an error and stop execution so we use <code>assert_numeric</code>.</p>
<p>Let‚Äôs add a validation check for each argument in our function.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="functions.html#cb378-1" aria-hidden="true" tabindex="-1"></a>get_stem_location <span class="ot">&lt;-</span> <span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</span>
<span id="cb378-2"><a href="functions.html#cb378-2" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb378-3"><a href="functions.html#cb378-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># validation checks</span></span>
<span id="cb378-4"><a href="functions.html#cb378-4" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(decimalLongitude)</span>
<span id="cb378-5"><a href="functions.html#cb378-5" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(decimalLatitude)</span>
<span id="cb378-6"><a href="functions.html#cb378-6" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(stemAzimuth)</span>
<span id="cb378-7"><a href="functions.html#cb378-7" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(stemDistance)</span>
<span id="cb378-8"><a href="functions.html#cb378-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb378-9"><a href="functions.html#cb378-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb378-10"><a href="functions.html#cb378-10" aria-hidden="true" tabindex="-1"></a>    geosphere<span class="sc">::</span><span class="fu">destPoint</span>(<span class="at">p =</span> <span class="fu">cbind</span>(decimalLongitude, decimalLatitude), </span>
<span id="cb378-11"><a href="functions.html#cb378-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">b =</span> stemAzimuth, <span class="at">d =</span> stemDistance) <span class="sc">%&gt;%</span></span>
<span id="cb378-12"><a href="functions.html#cb378-12" aria-hidden="true" tabindex="-1"></a>        tibble<span class="sc">::</span><span class="fu">as_tibble</span>()</span>
<span id="cb378-13"><a href="functions.html#cb378-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let‚Äôs also add a check to our output. Let‚Äôs throw a warning if there are any <code>NA</code> values in our output.</p>
<p>First we store our output so we can evaluate it.</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="functions.html#cb379-1" aria-hidden="true" tabindex="-1"></a>get_stem_location <span class="ot">&lt;-</span> <span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</span>
<span id="cb379-2"><a href="functions.html#cb379-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># validation checks</span></span>
<span id="cb379-3"><a href="functions.html#cb379-3" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(decimalLongitude)</span>
<span id="cb379-4"><a href="functions.html#cb379-4" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(decimalLatitude)</span>
<span id="cb379-5"><a href="functions.html#cb379-5" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(stemAzimuth)</span>
<span id="cb379-6"><a href="functions.html#cb379-6" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(stemDistance)</span>
<span id="cb379-7"><a href="functions.html#cb379-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb379-8"><a href="functions.html#cb379-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb379-9"><a href="functions.html#cb379-9" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> geosphere<span class="sc">::</span><span class="fu">destPoint</span>(<span class="at">p =</span> <span class="fu">cbind</span>(decimalLongitude, decimalLatitude), </span>
<span id="cb379-10"><a href="functions.html#cb379-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">b =</span> stemAzimuth, <span class="at">d =</span> stemDistance) <span class="sc">%&gt;%</span></span>
<span id="cb379-11"><a href="functions.html#cb379-11" aria-hidden="true" tabindex="-1"></a>        tibble<span class="sc">::</span><span class="fu">as_tibble</span>()</span>
<span id="cb379-12"><a href="functions.html#cb379-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Next we can add our check:</p>
<p>We can check the whole tibble for <code>NA</code>s in one go. We get a 2 dimensional matrix of logical values.</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="functions.html#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="fu">is.na</span>(test) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##        lon   lat
## [1,] FALSE FALSE
## [2,] FALSE FALSE
## [3,] FALSE FALSE
## [4,] FALSE FALSE
## [5,] FALSE FALSE</code></pre>
<p>We can then wrap the output of that in <code>any()</code> which tests whether there are any <code>TRUE</code> values in a logical array.</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="functions.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="fu">any</span>(<span class="fu">is.na</span>(test))</span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<p>Let‚Äôs apply that to our function.</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="functions.html#cb384-1" aria-hidden="true" tabindex="-1"></a>get_stem_location <span class="ot">&lt;-</span> <span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</span>
<span id="cb384-2"><a href="functions.html#cb384-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># validation checks</span></span>
<span id="cb384-3"><a href="functions.html#cb384-3" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(decimalLongitude)</span>
<span id="cb384-4"><a href="functions.html#cb384-4" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(decimalLatitude)</span>
<span id="cb384-5"><a href="functions.html#cb384-5" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(stemAzimuth)</span>
<span id="cb384-6"><a href="functions.html#cb384-6" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(stemDistance)</span>
<span id="cb384-7"><a href="functions.html#cb384-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb384-8"><a href="functions.html#cb384-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb384-9"><a href="functions.html#cb384-9" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> geosphere<span class="sc">::</span><span class="fu">destPoint</span>(<span class="at">p =</span> <span class="fu">cbind</span>(decimalLongitude, decimalLatitude), </span>
<span id="cb384-10"><a href="functions.html#cb384-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">b =</span> stemAzimuth, <span class="at">d =</span> stemDistance) <span class="sc">%&gt;%</span></span>
<span id="cb384-11"><a href="functions.html#cb384-11" aria-hidden="true" tabindex="-1"></a>        tibble<span class="sc">::</span><span class="fu">as_tibble</span>()</span>
<span id="cb384-12"><a href="functions.html#cb384-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb384-13"><a href="functions.html#cb384-13" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_false</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(out)))</span>
<span id="cb384-14"><a href="functions.html#cb384-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Lastly, we need to return our actual output!</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="functions.html#cb385-1" aria-hidden="true" tabindex="-1"></a>get_stem_location <span class="ot">&lt;-</span> <span class="cf">function</span>(decimalLongitude, decimalLatitude, stemAzimuth, stemDistance){</span>
<span id="cb385-2"><a href="functions.html#cb385-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># validation checks</span></span>
<span id="cb385-3"><a href="functions.html#cb385-3" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(decimalLongitude)</span>
<span id="cb385-4"><a href="functions.html#cb385-4" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(decimalLatitude)</span>
<span id="cb385-5"><a href="functions.html#cb385-5" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(stemAzimuth)</span>
<span id="cb385-6"><a href="functions.html#cb385-6" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(stemDistance)</span>
<span id="cb385-7"><a href="functions.html#cb385-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-8"><a href="functions.html#cb385-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-9"><a href="functions.html#cb385-9" aria-hidden="true" tabindex="-1"></a>    out <span class="ot">&lt;-</span> geosphere<span class="sc">::</span><span class="fu">destPoint</span>(<span class="at">p =</span> <span class="fu">cbind</span>(decimalLongitude, decimalLatitude), </span>
<span id="cb385-10"><a href="functions.html#cb385-10" aria-hidden="true" tabindex="-1"></a>                                <span class="at">b =</span> stemAzimuth, <span class="at">d =</span> stemDistance) <span class="sc">%&gt;%</span></span>
<span id="cb385-11"><a href="functions.html#cb385-11" aria-hidden="true" tabindex="-1"></a>        tibble<span class="sc">::</span><span class="fu">as_tibble</span>()</span>
<span id="cb385-12"><a href="functions.html#cb385-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-13"><a href="functions.html#cb385-13" aria-hidden="true" tabindex="-1"></a>    checkmate<span class="sc">::</span><span class="fu">assert_false</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(out)))</span>
<span id="cb385-14"><a href="functions.html#cb385-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb385-15"><a href="functions.html#cb385-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(out)</span>
<span id="cb385-16"><a href="functions.html#cb385-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let‚Äôs test it again:</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="functions.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_stem_location</span>(x<span class="sc">$</span>decimalLongitude, x<span class="sc">$</span>decimalLatitude, </span>
<span id="cb386-2"><a href="functions.html#cb386-2" aria-hidden="true" tabindex="-1"></a>                  x<span class="sc">$</span>stemAzimuth, x<span class="sc">$</span>stemDistance)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 2
##     lon   lat
##   &lt;dbl&gt; &lt;dbl&gt;
## 1 -71.3  44.1
## 2 -71.3  44.1
## 3 -71.3  44.1
## 4 -71.3  44.1
## 5 -71.3  44.1</code></pre>
<p>And now, remove any excess code form our script and save.</p>
<p>Our function is now ready to be sourced into our last preprocessing stage, adding the new <code>stemLat</code> and <code>stemLon</code> columns. üéâ.</p>
</div>
<div id="making-new-variables" class="section level3">
<h3>Making new variables</h3>
<p>Let‚Äôs move back to our <code>individual.R</code> script. At the top of our script, let‚Äôs add the code to source our function so it‚Äôs available during preprocessing:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="functions.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;geolocation.R&quot;</span>))</span></code></pre></div>
<p>Now we want to use data in <code>individual</code> to geolocate our individulas while at the same time creating new columns <code>stemLat</code> and <code>stemLon</code></p>
<p>For this we use <code>dplyr::mutate()</code>:</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="functions.html#cb389-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">stemLat =</span> <span class="fu">get_stem_location</span>(decimalLongitude, decimalLatitude, </span>
<span id="cb389-2"><a href="functions.html#cb389-2" aria-hidden="true" tabindex="-1"></a>                                                         stemAzimuth, stemDistance)<span class="sc">$</span>lat, </span>
<span id="cb389-3"><a href="functions.html#cb389-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">stemLon =</span> <span class="fu">get_stem_location</span>(decimalLongitude, decimalLatitude, </span>
<span id="cb389-4"><a href="functions.html#cb389-4" aria-hidden="true" tabindex="-1"></a>                                                         stemAzimuth, stemDistance)<span class="sc">$</span>lon)</span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 32
##    uid     namedLocation  date       eventID domainID siteID plotID individualID
##    &lt;chr&gt;   &lt;chr&gt;          &lt;date&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;  &lt;chr&gt;       
##  1 a36a16‚Ä¶ BART_037.base‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  2 68dc7a‚Ä¶ BART_037.base‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  3 a8951a‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  4 eb348e‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  5 2a4478‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  6 e48520‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  7 280c90‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  8 0e5060‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
##  9 4918ca‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
## 10 ef16cb‚Ä¶ BART_044.base‚Ä¶ 2015-08-26 vst_BA‚Ä¶ D01      BART   BART_‚Ä¶ NEON.PLA.D0‚Ä¶
## # ‚Ä¶ with 14,951 more rows, and 24 more variables: growthForm &lt;chr&gt;,
## #   stemDiameter &lt;dbl&gt;, measurementHeight &lt;dbl&gt;, height &lt;dbl&gt;, uid_map &lt;chr&gt;,
## #   pointID &lt;dbl&gt;, stemDistance &lt;dbl&gt;, stemAzimuth &lt;dbl&gt;, taxonID &lt;chr&gt;,
## #   scientificName &lt;chr&gt;, taxonRank &lt;chr&gt;, uid_ppl &lt;chr&gt;, plotType &lt;chr&gt;,
## #   nlcdClass &lt;chr&gt;, decimalLatitude &lt;dbl&gt;, decimalLongitude &lt;dbl&gt;,
## #   geodeticDatum &lt;chr&gt;, easting &lt;dbl&gt;, northing &lt;dbl&gt;, utmZone &lt;chr&gt;,
## #   elevation &lt;dbl&gt;, elevationUncertainty &lt;dbl&gt;, stemLat &lt;dbl&gt;, stemLon &lt;dbl&gt;</code></pre>
<p>We also need to extract the appropriate coordinate for each column. We do that by using the <code>$</code> subsetting operation after we call <code>get_stem_location()</code>.</p>
<p>It works! We‚Äôre almost done with our data munging!</p>
<p>Lets use the assignment pipe again now that we are happy.</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="functions.html#cb391-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&lt;&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">stemLat =</span> <span class="fu">get_stem_location</span>(decimalLongitude, decimalLatitude, </span>
<span id="cb391-2"><a href="functions.html#cb391-2" aria-hidden="true" tabindex="-1"></a>                                                         stemAzimuth, stemDistance)<span class="sc">$</span>lat, </span>
<span id="cb391-3"><a href="functions.html#cb391-3" aria-hidden="true" tabindex="-1"></a>                             <span class="at">stemLon =</span> <span class="fu">get_stem_location</span>(decimalLongitude, decimalLatitude, </span>
<span id="cb391-4"><a href="functions.html#cb391-4" aria-hidden="true" tabindex="-1"></a>                                                         stemAzimuth, stemDistance)<span class="sc">$</span>lon)</span></code></pre></div>
<p>Let‚Äôs do a couple last sanity checks:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="functions.html#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(individual)</span></code></pre></div>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="functions.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(individual)</span></code></pre></div>
<pre><code>## spec_tbl_df[,32] [14,961 √ó 32] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
##  $ uid                 : chr [1:14961] &quot;a36a162d-ed1f-4f80-ae45-88e973855c68&quot; &quot;68dc7adf-48e2-4f7a-9272-9a468fde6d55&quot; &quot;a8951ab9-4462-48dd-ab9e-7b89e24f2e03&quot; &quot;eb348eaf-3969-46a4-ac3b-523c3548efeb&quot; ...
##  $ namedLocation       : chr [1:14961] &quot;BART_037.basePlot.vst&quot; &quot;BART_037.basePlot.vst&quot; &quot;BART_044.basePlot.vst&quot; &quot;BART_044.basePlot.vst&quot; ...
##  $ date                : Date[1:14961], format: &quot;2015-08-26&quot; &quot;2015-08-26&quot; ...
##  $ eventID             : chr [1:14961] &quot;vst_BART_2015&quot; &quot;vst_BART_2015&quot; &quot;vst_BART_2015&quot; &quot;vst_BART_2015&quot; ...
##  $ domainID            : chr [1:14961] &quot;D01&quot; &quot;D01&quot; &quot;D01&quot; &quot;D01&quot; ...
##  $ siteID              : chr [1:14961] &quot;BART&quot; &quot;BART&quot; &quot;BART&quot; &quot;BART&quot; ...
##  $ plotID              : chr [1:14961] &quot;BART_037&quot; &quot;BART_037&quot; &quot;BART_044&quot; &quot;BART_044&quot; ...
##  $ individualID        : chr [1:14961] &quot;NEON.PLA.D01.BART.05285&quot; &quot;NEON.PLA.D01.BART.05279&quot; &quot;NEON.PLA.D01.BART.05419&quot; &quot;NEON.PLA.D01.BART.05092&quot; ...
##  $ growthForm          : chr [1:14961] &quot;single bole tree&quot; &quot;single bole tree&quot; &quot;single bole tree&quot; &quot;single bole tree&quot; ...
##  $ stemDiameter        : num [1:14961] 17.1 13.7 12.3 12.1 29.2 12.1 23.4 39.5 10 10.6 ...
##  $ measurementHeight   : num [1:14961] 130 130 130 130 130 130 130 130 130 130 ...
##  $ height              : num [1:14961] 15.2 9.8 7.7 15.2 16.7 10.6 18.4 19 5.7 8.7 ...
##  $ uid_map             : chr [1:14961] &quot;31c5ffdb-25cb-474c-b34b-c88ddf520dc2&quot; &quot;a59c6688-ef88-46bb-979d-ba23b6e84d1a&quot; &quot;64a921b6-ce50-442e-8811-40e6c086c99e&quot; &quot;f6cba56b-b14f-42e0-ab20-06e2bfa216d2&quot; ...
##  $ pointID             : num [1:14961] 61 41 23 57 57 23 57 41 57 57 ...
##  $ stemDistance        : num [1:14961] 11.3 6.1 12 11.5 19 7 7.4 6.4 12.7 15.1 ...
##  $ stemAzimuth         : num [1:14961] 212.1 4 62.1 140.8 93 ...
##  $ taxonID             : chr [1:14961] &quot;ACRU&quot; &quot;FAGR&quot; &quot;TSCA&quot; &quot;FAGR&quot; ...
##  $ scientificName      : chr [1:14961] &quot;Acer rubrum L.&quot; &quot;Fagus grandifolia Ehrh.&quot; &quot;Tsuga canadensis (L.) Carri√®re&quot; &quot;Fagus grandifolia Ehrh.&quot; ...
##  $ taxonRank           : chr [1:14961] &quot;species&quot; &quot;species&quot; &quot;species&quot; &quot;species&quot; ...
##  $ uid_ppl             : chr [1:14961] &quot;5ac133b6-1089-4f32-9c26-27c3fd6b2597&quot; &quot;5ac133b6-1089-4f32-9c26-27c3fd6b2597&quot; &quot;c4207c9a-028a-4a26-a4ee-5d1a70df1e66&quot; &quot;c4207c9a-028a-4a26-a4ee-5d1a70df1e66&quot; ...
##  $ plotType            : chr [1:14961] &quot;tower&quot; &quot;tower&quot; &quot;tower&quot; &quot;tower&quot; ...
##  $ nlcdClass           : chr [1:14961] &quot;deciduousForest&quot; &quot;deciduousForest&quot; &quot;deciduousForest&quot; &quot;deciduousForest&quot; ...
##  $ decimalLatitude     : num [1:14961] 44.1 44.1 44.1 44.1 44.1 ...
##  $ decimalLongitude    : num [1:14961] -71.3 -71.3 -71.3 -71.3 -71.3 ...
##  $ geodeticDatum       : chr [1:14961] &quot;WGS84&quot; &quot;WGS84&quot; &quot;WGS84&quot; &quot;WGS84&quot; ...
##  $ easting             : num [1:14961] 317130 317130 317042 317042 317042 ...
##  $ northing            : num [1:14961] 4881249 4881249 4881189 4881189 4881189 ...
##  $ utmZone             : chr [1:14961] &quot;19N&quot; &quot;19N&quot; &quot;19N&quot; &quot;19N&quot; ...
##  $ elevation           : num [1:14961] 292 292 303 303 303 ...
##  $ elevationUncertainty: num [1:14961] 0.2 0.2 0.3 0.3 0.3 0.3 0.3 0.3 0.3 0.3 ...
##  $ stemLat             : num [1:14961] 44.1 44.1 44.1 44.1 44.1 ...
##  $ stemLon             : num [1:14961] -71.3 -71.3 -71.3 -71.3 -71.3 ...</code></pre>
<p>And save our file.</p>
</div>
</div>
<div id="saving-analytical-data" class="section level2">
<h2>Saving analytical data</h2>
<p>At the bottom of <code>individual.R</code> there is some template code, <code>usethis::use_data("individual")</code>.</p>
<p>This functions invokes functionality to store an r object as an <code>.Rdata</code> object (ie as a tibble not a <code>csv</code>) in the <code>data</code> directory. This is the standard way to store exported data in packages but does not apply to our non-package project so won‚Äôt work.</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="functions.html#cb395-1" aria-hidden="true" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">use_data</span>(<span class="st">&quot;individual&quot;</span>)</span></code></pre></div>
<pre><code>## ‚úî Setting active project to &#39;/Users/runner/work/rrresearchACCE20/rrresearchACCE20&#39;</code></pre>
<pre><code>## Error: Can only save existing named objects.</code></pre>
<p>Let‚Äôs just get rid of it and instead, save our analytic data as a csv in our <code>data</code> directory.</p>
<p>Frist lets create a data directory (you can do this in the console)</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="functions.html#cb398-1" aria-hidden="true" tabindex="-1"></a>fs<span class="sc">::</span><span class="fu">dir_create</span>(<span class="st">&quot;data&quot;</span>)</span></code></pre></div>
<p>Now were ready to write or data out. Before we do so, I will add one last touch. Before I do so, I would like to get rid of a pet hate of mine, and thats camelCase variable names!</p>
<p>I use a handy function in package <code>janitor</code>, !</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="functions.html#cb399-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb399-2"><a href="functions.html#cb399-2" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code></pre></div>
<pre><code>## # A tibble: 14,961 x 32
##    uid           named_location   date       event_id  domain_id site_id plot_id
##    &lt;chr&gt;         &lt;chr&gt;            &lt;date&gt;     &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;   &lt;chr&gt;  
##  1 a36a162d-ed1‚Ä¶ BART_037.basePl‚Ä¶ 2015-08-26 vst_BART‚Ä¶ D01       BART    BART_0‚Ä¶
##  2 68dc7adf-48e‚Ä¶ BART_037.basePl‚Ä¶ 2015-08-26 vst_BART‚Ä¶ D01       BART    BART_0‚Ä¶
##  3 a8951ab9-446‚Ä¶ BART_044.basePl‚Ä¶ 2015-08-26 vst_BART‚Ä¶ D01       BART    BART_0‚Ä¶
##  4 eb348eaf-396‚Ä¶ BART_044.basePl‚Ä¶ 2015-08-26 vst_BART‚Ä¶ D01       BART    BART_0‚Ä¶
##  5 2a4478ef-597‚Ä¶ BART_044.basePl‚Ä¶ 2015-08-26 vst_BART‚Ä¶ D01       BART    BART_0‚Ä¶
##  6 e485203e-879‚Ä¶ BART_044.basePl‚Ä¶ 2015-08-26 vst_BART‚Ä¶ D01       BART    BART_0‚Ä¶
##  7 280c9049-191‚Ä¶ BART_044.basePl‚Ä¶ 2015-08-26 vst_BART‚Ä¶ D01       BART    BART_0‚Ä¶
##  8 0e5060ec-a6d‚Ä¶ BART_044.basePl‚Ä¶ 2015-08-26 vst_BART‚Ä¶ D01       BART    BART_0‚Ä¶
##  9 4918cac0-62f‚Ä¶ BART_044.basePl‚Ä¶ 2015-08-26 vst_BART‚Ä¶ D01       BART    BART_0‚Ä¶
## 10 ef16cb9c-0b6‚Ä¶ BART_044.basePl‚Ä¶ 2015-08-26 vst_BART‚Ä¶ D01       BART    BART_0‚Ä¶
## # ‚Ä¶ with 14,951 more rows, and 25 more variables: individual_id &lt;chr&gt;,
## #   growth_form &lt;chr&gt;, stem_diameter &lt;dbl&gt;, measurement_height &lt;dbl&gt;,
## #   height &lt;dbl&gt;, uid_map &lt;chr&gt;, point_id &lt;dbl&gt;, stem_distance &lt;dbl&gt;,
## #   stem_azimuth &lt;dbl&gt;, taxon_id &lt;chr&gt;, scientific_name &lt;chr&gt;,
## #   taxon_rank &lt;chr&gt;, uid_ppl &lt;chr&gt;, plot_type &lt;chr&gt;, nlcd_class &lt;chr&gt;,
## #   decimal_latitude &lt;dbl&gt;, decimal_longitude &lt;dbl&gt;, geodetic_datum &lt;chr&gt;,
## #   easting &lt;dbl&gt;, northing &lt;dbl&gt;, utm_zone &lt;chr&gt;, elevation &lt;dbl&gt;,
## #   elevation_uncertainty &lt;dbl&gt;, stem_lat &lt;dbl&gt;, stem_lon &lt;dbl&gt;</code></pre>
<p>This turns all the column names to my beloved snake case!</p>
<p>Now, with that final tweek, we are ready to save our data.</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="functions.html#cb401-1" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb401-2"><a href="functions.html#cb401-2" aria-hidden="true" tabindex="-1"></a>    janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span></span>
<span id="cb401-3"><a href="functions.html#cb401-3" aria-hidden="true" tabindex="-1"></a>    readr<span class="sc">::</span><span class="fu">write_csv</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;individual.csv&quot;</span>))</span></code></pre></div>
</div>
<div id="final-processing-script" class="section level2">
<h2>Final processing script:</h2>
<p><strong><code>data-raw/individual.R</code></strong></p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="functions.html#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="do">## code to prepare `individual` dataset goes here</span></span>
<span id="cb402-2"><a href="functions.html#cb402-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb402-3"><a href="functions.html#cb402-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;R&quot;</span>, <span class="st">&quot;geolocate.R&quot;</span>))</span>
<span id="cb402-4"><a href="functions.html#cb402-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-5"><a href="functions.html#cb402-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Read in and compile all individual data</span></span>
<span id="cb402-6"><a href="functions.html#cb402-6" aria-hidden="true" tabindex="-1"></a>raw_data_path <span class="ot">&lt;-</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;wood-survey-data-master&quot;</span>)</span>
<span id="cb402-7"><a href="functions.html#cb402-7" aria-hidden="true" tabindex="-1"></a>individual_path <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">path</span>(raw_data_path, <span class="st">&quot;individual&quot;</span>)</span>
<span id="cb402-8"><a href="functions.html#cb402-8" aria-hidden="true" tabindex="-1"></a>individual_paths <span class="ot">&lt;-</span> fs<span class="sc">::</span><span class="fu">dir_ls</span>(individual_path)</span>
<span id="cb402-9"><a href="functions.html#cb402-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-10"><a href="functions.html#cb402-10" aria-hidden="true" tabindex="-1"></a><span class="co"># read in all tables into one</span></span>
<span id="cb402-11"><a href="functions.html#cb402-11" aria-hidden="true" tabindex="-1"></a>individual <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">map_df</span>(individual_paths,</span>
<span id="cb402-12"><a href="functions.html#cb402-12" aria-hidden="true" tabindex="-1"></a>              <span class="sc">~</span>readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> .x,</span>
<span id="cb402-13"><a href="functions.html#cb402-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">col_types =</span> readr<span class="sc">::</span><span class="fu">cols</span>(<span class="at">.default =</span> <span class="st">&quot;c&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb402-14"><a href="functions.html#cb402-14" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">type_convert</span>()</span>
<span id="cb402-15"><a href="functions.html#cb402-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-16"><a href="functions.html#cb402-16" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&gt;%</span></span>
<span id="cb402-17"><a href="functions.html#cb402-17" aria-hidden="true" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">write_csv</span>(<span class="at">path =</span> fs<span class="sc">::</span><span class="fu">path</span>(raw_data_path, <span class="st">&quot;vst_individuals.csv&quot;</span>))</span>
<span id="cb402-18"><a href="functions.html#cb402-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-19"><a href="functions.html#cb402-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-20"><a href="functions.html#cb402-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-21"><a href="functions.html#cb402-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine NEON data tables</span></span>
<span id="cb402-22"><a href="functions.html#cb402-22" aria-hidden="true" tabindex="-1"></a><span class="co"># read in additonal table</span></span>
<span id="cb402-23"><a href="functions.html#cb402-23" aria-hidden="true" tabindex="-1"></a>maptag <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(fs<span class="sc">::</span><span class="fu">path</span>(raw_data_path, </span>
<span id="cb402-24"><a href="functions.html#cb402-24" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">&quot;vst_mappingandtagging.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb402-25"><a href="functions.html#cb402-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>eventID)</span>
<span id="cb402-26"><a href="functions.html#cb402-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-27"><a href="functions.html#cb402-27" aria-hidden="true" tabindex="-1"></a>perplot <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(fs<span class="sc">::</span><span class="fu">path</span>(raw_data_path, </span>
<span id="cb402-28"><a href="functions.html#cb402-28" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;vst_perplotperyear.csv&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb402-29"><a href="functions.html#cb402-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>eventID)</span>
<span id="cb402-30"><a href="functions.html#cb402-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-31"><a href="functions.html#cb402-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-32"><a href="functions.html#cb402-32" aria-hidden="true" tabindex="-1"></a>individual <span class="sc">%&lt;&gt;%</span></span>
<span id="cb402-33"><a href="functions.html#cb402-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(maptag, <span class="at">by =</span> <span class="st">&quot;individualID&quot;</span>,</span>
<span id="cb402-34"><a href="functions.html#cb402-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_map&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb402-35"><a href="functions.html#cb402-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(perplot, <span class="at">by =</span> <span class="st">&quot;plotID&quot;</span>,</span>
<span id="cb402-36"><a href="functions.html#cb402-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;_ppl&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb402-37"><a href="functions.html#cb402-37" aria-hidden="true" tabindex="-1"></a>  assertr<span class="sc">::</span><span class="fu">assert</span>(assertr<span class="sc">::</span>not_na, stemDistance, stemAzimuth, pointID,</span>
<span id="cb402-38"><a href="functions.html#cb402-38" aria-hidden="true" tabindex="-1"></a>                  decimalLongitude, decimalLatitude, plotID)</span>
<span id="cb402-39"><a href="functions.html#cb402-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-40"><a href="functions.html#cb402-40" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Geolocate individuals_functions ----</span></span>
<span id="cb402-41"><a href="functions.html#cb402-41" aria-hidden="true" tabindex="-1"></a>individual <span class="ot">&lt;-</span> individual <span class="sc">%&gt;%</span></span>
<span id="cb402-42"><a href="functions.html#cb402-42" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">stemLat =</span> <span class="fu">get_stem_location</span>(<span class="at">decimalLongitude =</span> decimalLongitude,</span>
<span id="cb402-43"><a href="functions.html#cb402-43" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">decimalLatitude =</span> decimalLatitude,</span>
<span id="cb402-44"><a href="functions.html#cb402-44" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">stemAzimuth =</span> stemAzimuth,</span>
<span id="cb402-45"><a href="functions.html#cb402-45" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">stemDistance =</span> stemDistance)<span class="sc">$</span>lat,</span>
<span id="cb402-46"><a href="functions.html#cb402-46" aria-hidden="true" tabindex="-1"></a>                <span class="at">stemLon =</span> <span class="fu">get_stem_location</span>(<span class="at">decimalLongitude =</span> decimalLongitude,</span>
<span id="cb402-47"><a href="functions.html#cb402-47" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">decimalLatitude =</span> decimalLatitude,</span>
<span id="cb402-48"><a href="functions.html#cb402-48" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">stemAzimuth =</span> stemAzimuth,</span>
<span id="cb402-49"><a href="functions.html#cb402-49" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">stemDistance =</span> stemDistance)<span class="sc">$</span>lon) <span class="sc">%&gt;%</span></span>
<span id="cb402-50"><a href="functions.html#cb402-50" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb402-51"><a href="functions.html#cb402-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-52"><a href="functions.html#cb402-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-53"><a href="functions.html#cb402-53" aria-hidden="true" tabindex="-1"></a><span class="co"># write out analytic file</span></span>
<span id="cb402-54"><a href="functions.html#cb402-54" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(individual, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;individual.csv&quot;</span>))</span></code></pre></div>
</div>
<div id="final-function" class="section level2">
<h2>Final function</h2>
<p><strong><code>R/geolocate.R</code></strong></p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="functions.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function</span></span>
<span id="cb403-2"><a href="functions.html#cb403-2" aria-hidden="true" tabindex="-1"></a>get_stem_location <span class="ot">&lt;-</span> <span class="cf">function</span>(decimalLongitude, decimalLatitude,</span>
<span id="cb403-3"><a href="functions.html#cb403-3" aria-hidden="true" tabindex="-1"></a>                              stemAzimuth, stemDistance) {</span>
<span id="cb403-4"><a href="functions.html#cb403-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check inputs are correct type (numeric)</span></span>
<span id="cb403-5"><a href="functions.html#cb403-5" aria-hidden="true" tabindex="-1"></a>  checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(decimalLatitude)</span>
<span id="cb403-6"><a href="functions.html#cb403-6" aria-hidden="true" tabindex="-1"></a>  checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(decimalLongitude)</span>
<span id="cb403-7"><a href="functions.html#cb403-7" aria-hidden="true" tabindex="-1"></a>  checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(stemAzimuth)</span>
<span id="cb403-8"><a href="functions.html#cb403-8" aria-hidden="true" tabindex="-1"></a>  checkmate<span class="sc">::</span><span class="fu">assert_numeric</span>(stemDistance)</span>
<span id="cb403-9"><a href="functions.html#cb403-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb403-10"><a href="functions.html#cb403-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb403-11"><a href="functions.html#cb403-11" aria-hidden="true" tabindex="-1"></a>  out <span class="ot">&lt;-</span> geosphere<span class="sc">::</span><span class="fu">destPoint</span>(<span class="at">p =</span> <span class="fu">cbind</span>(decimalLongitude, decimalLatitude),</span>
<span id="cb403-12"><a href="functions.html#cb403-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">b =</span> stemAzimuth, <span class="at">d =</span> stemDistance) <span class="sc">%&gt;%</span></span>
<span id="cb403-13"><a href="functions.html#cb403-13" aria-hidden="true" tabindex="-1"></a>    tibble<span class="sc">::</span><span class="fu">as_tibble</span>()</span>
<span id="cb403-14"><a href="functions.html#cb403-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb403-15"><a href="functions.html#cb403-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check output for NAs</span></span>
<span id="cb403-16"><a href="functions.html#cb403-16" aria-hidden="true" tabindex="-1"></a>  checkmate<span class="sc">::</span><span class="fu">assert_false</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(out)))</span>
<span id="cb403-17"><a href="functions.html#cb403-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb403-18"><a href="functions.html#cb403-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out)</span>
<span id="cb403-19"><a href="functions.html#cb403-19" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-merge.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="metadata.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["rrresearchACCE20.pdf", "rrresearchACCE20.epub"],
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
